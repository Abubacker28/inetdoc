<?xml version='1.0'?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V5.0//EN"
	"/usr/share/xml/docbook/schema/dtd/5.0/docbook.dtd"[

<!ENTITY author		SYSTEM "author.xml">
<!ENTITY legal		SYSTEM "legal.xml">

<!-- inetdoc -->
<!ENTITY % inetdoc_urls SYSTEM 'inetdoc.urls.xml'>
%inetdoc_urls;

<!ENTITY url.cisco-ospf
	'<link xmlns="http://docbook.org/ns/docbook"
	xlink:href="http://www.cisco.com/en/US/tech/tk365/tk480/tsd_technology_support_sub-protocol_home.html">
	<citetitle>Open Shortest Path First (OSPF)</citetitle></link>'>

<!-- openvswitch -->
<!ENTITY url.ovs
	"<link xmlns='http://docbook.org/ns/docbook'
	xlink:href='http://openvswitch.org'>Open vSwitch</link>">

<!ENTITY url.cam
	'<link xmlns="http://docbook.org/ns/docbook" xlink:href="https://en.wikipedia.org/wiki/Content-addressable_memory">
	<citetitle>Content-addressable memory</citetitle></link>'>
]>

<article xml:id='interco.ospf' xml:lang='fr'>

<info>
	<title>Introduction au routage dynamique avec OSPF</title>

	&author;
	<abstract>
	<para>
	<informaltable frame='none' pgwide='1'>
	<tgroup cols='2' align='left' colsep='0' rowsep='0'>
	<colspec colwidth='5*'/>
	<colspec colwidth='220px'/>
	<tbody>
    <row>
    <entry valign='top'>
	<para>L'objectif de ce support de travaux pratiques est de mettre en
	évidence les caractéristiques de fonctionnement du protocole de routage
	<acronym>OSPF</acronym>. Cette illustration s'appuie sur des liens de type
	Ethernet et sur l'utilisation des <acronym>VLAN</acronym>s. Les questions
	sont présentées comme une introduction pas à pas au protocole de routage
	<acronym>OSPF</acronym>. On débute avec la mise en place d'une topologie
	réseau type basée sur le routage inter-VLAN, puis on implante les instances
	de démons de routage.</para>
	</entry>
	<entry>
	<inlinemediaobject>
	<imageobject role='html'>
		<imagedata fileref='images/interco.ospf.physical-topology.png' format='PNG' width='220px' scalefit='1'/>
	</imageobject>
	<imageobject role='fo'>
		<imagedata fileref='images/interco.ospf.physical-topology.png' format='PNG' width='4.5cm' scalefit='1'/>
	</imageobject>
	</inlinemediaobject>
	</entry>
	</row>
	</tbody>
	</tgroup>
	</informaltable>
	</para>
	</abstract>

	<keywordset>
	<keyword>kvm</keyword>
	<keyword>openvswitch</keyword>
	<keyword>ospf</keyword>
	<keyword>qemu</keyword>
	<keyword>quagga</keyword>
	<keyword>routage</keyword>
	<keyword>trunk</keyword>
	<keyword>vlan</keyword>
	<keyword>zebra</keyword>
	</keywordset>
</info>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf.legal.meta'>
	&legal;

	<sect2 xml:id='interco.ospf.meta'>
		<title>Méta-information</title>
    
	<para>Ce document est écrit avec <link
	xlink:href="http://www.docbook.org"><citetitle>DocBook</citetitle></link>
	XML sur un système <link
	xlink:href="https://www.debian.org"><citetitle>Debian
	GNU/Linux</citetitle></link>. Il est disponible en version imprimable au
	format PDF : <link
	xlink:href="https://www.inetdoc.net/pdf/__printbasename__"><literal>__printbasename__</literal></link>.</para>

	<para>Toutes les commandes utilisées dans ce document ne sont pas
	spécifiques à une version particulière des systèmes UNIX ou GNU/Linux.
	C'est la distribution <citetitle>Debian GNU/Linux</citetitle> qui est
	utilisée pour les tests présentés. Voici une liste des paquets contenant
	les commandes :</para>

	<itemizedlist>
	<listitem>
		<para><application>procps</application> - Utilitaires pour le système
		de fichiers /proc</para>
	</listitem>
	<listitem>
		<para><application>iproute2</application> - Outils de contrôle du
		trafic et	du réseau</para>
	</listitem>
	<listitem>
		<para><application>ifupdown</application> - Outils de haut niveau pour
		configurer les interfaces réseau</para>
	</listitem>
	<listitem>
		<para><application>iputils-ping</application> - Outils pour tester
		l'accessibilité de noeuds réseaux</para>
	</listitem>
	<listitem>
		<para><application>quagga</application> - BGP/OSPF/RIP routing
		daemon</para>
	</listitem>
	</itemizedlist>
	</sect2>

	<sect2 xml:id='interco.ospf.convtypo'>
		<title>Conventions typographiques</title>

	<para>Tous les exemples d'exécution des commandes sont précédés d'une
	invite utilisateur ou <wordasword>prompt</wordasword> spécifique au niveau
	des droits utilisateurs nécessaires sur le système.</para>

	<itemizedlist>
	<listitem>
		<para>Toute commande précédée de l'invite <prompt>$</prompt> ne
		nécessite aucun privilège particulier et peut être utilisée au niveau
		utilisateur simple.</para>
	</listitem>
	<listitem>
		<para>Toute commande précédée de l'invite <prompt>#</prompt> nécessite
		les privilèges du super-utilisateur.</para>
	</listitem>
	</itemizedlist>
	</sect2>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf.archi'>
	<title>Architecture réseau étudiée</title>

	<sect2 xml:id='interco.ospf.archi.topologie'>
		<title>Topologie type</title>

	<para>La topologie réseau étudiée peut être présentée sous deux formes
	distinctes : logique et physique.</para>
 
	<variablelist>
	<varlistentry xml:id='interco.ospf.topologie.logique'>
		<term>Topologie logique</term>
	<listitem>
		<para>On retrouve un grand classique dans l'introduction aux protocoles
		de routage dynamiques : le triangle. Tous les liens sont de type
		<acronym>LAN</acronym>.</para>
	</listitem>
	</varlistentry>
	<varlistentry xml:id='interco.ospf.topologie.physique'>
		<term>Topologie physique</term>
	<listitem>
		<para>On s'appuie sur le support &url.inter-vlan-routing; pour
		constituer une topologie physique à base de réseaux locaux virtuels ou
		<acronym>VLAN</acronym>s. On fait correspondre à chaque lien de la
		topologie logique en triangle un numéro de <acronym>VLAN</acronym>
		défini.</para>
	</listitem>
	</varlistentry>
	</variablelist>

	<table xml:id='interco.ospf.archi.topologie.table' frame='all' pgwide='1'>
		<title>Topologie type étudiée</title>
	<tgroup cols='2'>
		<colspec colnum='1' colwidth='1*'/>
		<colspec colnum='2' colwidth='1*'/>
	<thead>
	<row>
	<entry>Topologie logique</entry>
	<entry>Topologie physique</entry>
	</row>
	</thead>
	<tbody>
	<row>
		<entry valign='middle' align='center'>
		<mediaobject>
		<imageobject role='fo'>
			<imagedata format='PNG' fileref='images/interco.ospf.logical-topology.png' width='7cm' scalefit='1' />
		</imageobject>
		<imageobject role='html'>
			<imagedata format='PNG' fileref='images/interco.ospf.logical-topology.png' width='320px' scalefit='1' />
		</imageobject>
		<textobject>
			<phrase>Topologie logique triangle</phrase>
		</textobject>
		</mediaobject>
		</entry>
		<entry valign='middle' align='center'>
		<mediaobject>
		<imageobject role='fo'>
			<imagedata format='PNG' fileref='images/interco.ospf.physical-topology.png' width='7cm' scalefit='1' />
		</imageobject>
		<imageobject role='html'>
			<imagedata format='PNG' fileref='images/interco.ospf.physical-topology.png' width='320px' scalefit='1' />
		</imageobject>
		<textobject>
			<phrase>Topologie physique étoile</phrase>
		</textobject>
		</mediaobject>
		</entry>
	</row>
	</tbody>
	</tgroup>
	</table>

	<para>Après avoir mis en œuvre la topologie physique en s'appuyant sur le
	support de la séance de travaux pratiques précédente :
	&url.inter-vlan-routing;, on implante les démons de routage
	<acronym>OSPF</acronym> sur les trois routeurs R1, R2 et R3.</para>

	<para>Cette séance se limite à l'étude du routage dynamique à l'intérieur
	d'une aire unique. La seule «frontière» de communication inter-aires
	visible est constituée par le lien vers l'Internet. Cette route par défaut
	sera redistribuée via <acronym>OSPF</acronym> par le routeur R1 aux autres
	routeurs. On verra alors un exemple de route externe dans les bases de
	données <acronym>OSPF</acronym>.</para>

	<para>On profite aussi de cette introduction pour employer une technique
	très répandue pour ajouter «artificiellement» des entrées de tables de
	routage en s'appuyant sur des interfaces virtuelles de type
	<wordasword>dummy</wordasword> équivalentes à des interfaces de boucle
	locale.</para>

	<para>Pour les besoins de rédaction des questions et réponses de ce
	support, la topologie a été mise en œuvre sur machines virtuelles
	<acronym>KVM</acronym> avec le commutateur <citetitle>Open
	vSwitch</citetitle> fourni avec le paquet
	<application>openvswitch-switch</application>. Les éléments de réponse aux
	questions dépendent donc de cette mise en œuvre. Pour la séance de travaux
	pratiques «réelle», il convient donc de se conformer strictement au plan
	d'adressage fourni ci-après.</para>
	</sect2>

<?custom-pagebreak?>
	<sect2 xml:id='interco.ospf.archi.adressage'>
		<title>Plan d'adressage</title>

	<para>Comme dans le support sur l'introduction au routage inter-VLAN, le
	seul point de configuration imposé est le raccordement au réseau
	d'interconnexion avec les routeurs de l'infrastructure de travaux
	pratiques.</para>
  
	<itemizedlist>
	<listitem>
		<para><systemitem>dsw2.infra.stri</systemitem> en salle 211</para>
	</listitem>
	<listitem>
		<para><systemitem>dsw1.infra.stri</systemitem> en salle 213</para>
	</listitem>
	</itemizedlist>

	<para>Le raccordement au commutateur de la couche distribution utilise le
	port «de numéro le plus élevé» de chaque commutateur de couche accès ;
	<systemitem>gi0/2</systemitem> normalement. Ces liens montants doivent être
	configurés en mode <wordasword>trunk</wordasword> en utilisant le
	<acronym>VLAN</acronym> natif numéro 1. Le réseau <acronym>IP</acronym>
	correspondant au <acronym>VLAN</acronym> numéro 1 a pour adresse :
	<systemitem class='ipaddress'>172.16.0.0/20</systemitem></para>

	<para>Point important, la lecture de la section «Plan d'adressage» du
	document &url.infra.tp; donne l'adresse des deux routeurs connectés à
	l'Internet.</para>

	<table xml:id='lab.addressing' frame='all' pgwide='1'>
		<title>Affectation des rôles, des numéros de VLANs et des adresses
		IP</title>
	<tgroup cols='8' align='left' colsep='1' rowsep='1'>
		<colspec colnum='1' colwidth='1*'/>
		<colspec colnum='2' colwidth='2*'/>
		<colspec colnum='3' colwidth='1*'/>
		<colspec colnum='4' colwidth='1*'/>
		<colspec colnum='5' colwidth='1*'/>
		<colspec colnum='6' colwidth='1*'/>
		<colspec colnum='7' colwidth='1*'/>
		<colspec colnum='8' colwidth='2*'/>
	<thead>
	<row>
		<entry>Groupe</entry>
		<entry>Commutateur</entry>
		<entry>Poste</entry>
		<entry>Rôle</entry>
		<entry>router-id</entry>
		<entry>VLAN</entry>
		<entry>Interface</entry>
		<entry>Réseau</entry>
	</row>
	</thead>
	<tbody>
	<row>
		<entry morerows='6' valign='middle'>1</entry>
		<entry morerows='6' valign='middle'><systemitem class='systemname'>sw5.infra.stri</systemitem></entry>
		<entry morerows='2' valign='middle'>alderaan</entry>
		<entry morerows='2' valign='middle'>R10</entry>
		<entry morerows='2' valign='middle'>0.0.0.10</entry>
		<entry align='right'>1 (natif)</entry>
		<entry>eth0</entry>
		<entry><systemitem class='ipaddress'>172.16.1.1/20</systemitem></entry>
	</row>
	<row>
		<entry align='right'>221</entry>
		<entry>eth0.221</entry>
		<entry><systemitem class='ipaddress'>10.1.21.1/26</systemitem></entry>
	</row>
	<row>
		<entry align='right'>231</entry>
		<entry>eth0.231</entry>
		<entry><systemitem class='ipaddress'>10.1.31.1/26</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle'>bespin</entry>
		<entry morerows='1' valign='middle'>R20</entry>
		<entry morerows='1' valign='middle'>0.0.0.20</entry>
		<entry align='right'>221</entry>
		<entry>eth0.221</entry>
		<entry><systemitem class='ipaddress'>10.1.21.2/26</systemitem></entry>
	</row>
	<row>
		<entry align='right'>232</entry>
		<entry>eth0.232</entry>
		<entry><systemitem class='ipaddress'>10.1.32.2/26</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle'>centares</entry>
		<entry morerows='1' valign='middle'>R30</entry>
		<entry morerows='1' valign='middle'>0.0.0.30</entry>
		<entry align='right'>231</entry>
		<entry>eth0.231</entry>
		<entry><systemitem class='ipaddress'>10.1.31.3/26</systemitem></entry>
	</row>
	<row>
		<entry align='right'>232</entry>
		<entry>eth0.232</entry>
		<entry><systemitem class='ipaddress'>10.1.32.3/26</systemitem></entry>
	</row>
	<row>
		<entry morerows='6' valign='middle'>2</entry>
		<entry morerows='6' valign='middle'><systemitem class='systemname'>sw6.infra.stri</systemitem></entry>
		<entry morerows='2' valign='middle'>coruscant</entry>
		<entry morerows='2' valign='middle'>R40</entry>
		<entry morerows='2' valign='middle'>0.0.0.40</entry>
		<entry align='right'>1 (natif)</entry>
		<entry>eth0</entry>
		<entry><systemitem class='ipaddress'>172.16.2.1/20</systemitem></entry>
	</row>
	<row>
		<entry align='right'>241</entry>
		<entry>eth0.241</entry>
		<entry><systemitem class='ipaddress'>10.2.41.1/26</systemitem></entry>
	</row>
	<row>
		<entry align='right'>251</entry>
		<entry>eth0.251</entry>
		<entry><systemitem class='ipaddress'>10.2.51.1/26</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle'>dagobah</entry>
		<entry morerows='1' valign='middle'>R50</entry>
		<entry morerows='1' valign='middle'>0.0.0.50</entry>
		<entry align='right'>241</entry>
		<entry>eth0.241</entry>
		<entry><systemitem class='ipaddress'>10.2.41.4/26</systemitem></entry>
	</row>
	<row>
		<entry align='right'>254</entry>
		<entry>eth0.254</entry>
		<entry><systemitem class='ipaddress'>10.2.54.4/26</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle'>endor</entry>
		<entry morerows='1' valign='middle'>R60</entry>
		<entry morerows='1' valign='middle'>0.0.0.60</entry>
		<entry align='right'>251</entry>
		<entry>eth0.251</entry>
		<entry><systemitem class='ipaddress'>10.2.51.5/26</systemitem></entry>
	</row>
	<row>
		<entry align='right'>254</entry>
		<entry>eth0.254</entry>
		<entry><systemitem class='ipaddress'>10.2.54.5/26</systemitem></entry>
	</row>
	<row>
		<entry morerows='6' valign='middle'>1</entry>
		<entry morerows='6' valign='middle'><systemitem class='systemname'>sw7.infra.stri</systemitem></entry>
		<entry morerows='2' valign='middle'>felucia</entry>
		<entry morerows='2' valign='middle'>R70</entry>
		<entry morerows='2' valign='middle'>0.0.0.70</entry>
		<entry align='right'>1 (natif)</entry>
		<entry>eth0</entry>
		<entry><systemitem class='ipaddress'>172.16.3.1/20</systemitem></entry>
	</row>
	<row>
		<entry align='right'>261</entry>
		<entry>eth0.261</entry>
		<entry><systemitem class='ipaddress'>10.3.61.1/26</systemitem></entry>
	</row>
	<row>
		<entry align='right'>271</entry>
		<entry>eth0.271</entry>
		<entry><systemitem class='ipaddress'>10.3.71.1/26</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle'>geonosis</entry>
		<entry morerows='1' valign='middle'>R80</entry>
		<entry morerows='1' valign='middle'>0.0.0.80</entry>
		<entry align='right'>261</entry>
		<entry>eth0.261</entry>
		<entry><systemitem class='ipaddress'>10.3.61.6/26</systemitem></entry>
	</row>
	<row>
		<entry align='right'>276</entry>
		<entry>eth0.276</entry>
		<entry><systemitem class='ipaddress'>10.3.76.6/26</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle'>hoth</entry>
		<entry morerows='1' valign='middle'>R90</entry>
		<entry morerows='1' valign='middle'>0.0.0.90</entry>
		<entry align='right'>271</entry>
		<entry>eth0.271</entry>
		<entry><systemitem class='ipaddress'>10.3.71.7/26</systemitem></entry>
	</row>
	<row>
		<entry align='right'>276</entry>
		<entry>eth0.276</entry>
		<entry><systemitem class='ipaddress'>10.3.76.7/26</systemitem></entry>
	</row>
	<row>
		<entry morerows='6' valign='middle'>4</entry>
		<entry morerows='6' valign='middle'><systemitem class='systemname'>sw8.infra.stri</systemitem></entry>
		<entry morerows='2' valign='middle'>mustafar</entry>
		<entry morerows='2' valign='middle'>R100</entry>
		<entry morerows='2' valign='middle'>0.0.0.100</entry>
		<entry align='right'>1 (natif)</entry>
		<entry>eth0</entry>
		<entry><systemitem class='ipaddress'>172.16.4.1/20</systemitem></entry>
	</row>
	<row>
		<entry align='right'>281</entry>
		<entry>eth0.281</entry>
		<entry><systemitem class='ipaddress'>10.4.81.1/26</systemitem></entry>
	</row>
	<row>
		<entry align='right'>291</entry>
		<entry>eth0.291</entry>
		<entry><systemitem class='ipaddress'>10.4.91.1/26</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle'>naboo</entry>
		<entry morerows='1' valign='middle'>R110</entry>
		<entry morerows='1' valign='middle'>0.0.0.110</entry>
		<entry align='right'>281</entry>
		<entry>eth0.281</entry>
		<entry><systemitem class='ipaddress'>10.4.81.8/26</systemitem></entry>
	</row>
	<row>
		<entry align='right'>298</entry>
		<entry>eth0.298</entry>
		<entry><systemitem class='ipaddress'>10.4.98.8/26</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle'>tatooine</entry>
		<entry morerows='1' valign='middle'>R120</entry>
		<entry morerows='1' valign='middle'>0.0.0.120</entry>
		<entry align='right'>291</entry>
		<entry>eth0.291</entry>
		<entry><systemitem class='ipaddress'>10.4.91.9/26</systemitem></entry>
	</row>
	<row>
		<entry align='right'>298</entry>
		<entry>eth0.298</entry>
		<entry><systemitem class='ipaddress'>10.4.98.9/26</systemitem></entry>
	</row>
	</tbody>
	</tgroup>
	</table>

	<para>Le positionnement des 4 commutateurs est référencé dans le support
	&url.infra.tp;.</para>
	</sect2> 
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf.prepare-config'>
	<title>Préparation des routeurs</title>

	<para>La première étape consiste à mettre en place la topologie
	physique.</para>

	<itemizedlist>
	<listitem>
		<para>Vérifier l'installation du paquet
		<application>quagga</application> avant de brasser les postes sur les
		commutateurs non programmés.</para>

<screen><prompt>$</prompt> aptitude search ~iquagga
i   quagga              - BGP/OSPF/RIP routing daemon</screen>
	</listitem>

	<listitem xml:id='interco.ospf.prepare-config.routing'>
		<para>Vérifier que la fonction de routage des paquets
		<acronym>IPv4</acronym> est active au niveau noyau.</para>

<screen><prompt>$</prompt> cat /proc/sys/net/ipv4/ip_forward
1</screen>

		<para>Si ce n'est pas le cas, il est possible d'éditer le fichier
		<filename>/etc/sysctl.conf</filename> pour fixer les valeurs des
		paramètres de configuration des protocoles de la pile
		<acronym>TCP/IP</acronym> dans	le noyau Linux. Voir la section
		<citetitle>Fonctions réseau d'une interface</citetitle> du support
		&url.config.interface.lan;.</para>

<screen><prompt>#</prompt> sysctl -p
net.ipv4.conf.default.rp_filter = 1
net.ipv4.conf.all.rp_filter = 1
net.ipv4.ip_forward = 1
net.ipv6.conf.all.forwarding = 1
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.all.proxy_arp = 0</screen>
	</listitem>

	<listitem xml:id='interco.ospf.prepare-config.subinterfaces'>
		<para>Créer les sous-interfaces associées aux <acronym>VLAN</acronym>s
		sur chacun des routeurs R1, R2 et R3 à l'aide du script suivant
		:</para>

<screen><?dbfo keep-together="auto" ?><xi:include href='files/subinterfaces.sh'
parse='text' xmlns:xi='http://www.w3.org/2001/XInclude'/></screen>

		<para>Sur le routeur R1, on utilise le script avec les numéros de
		<acronym>VLAN</acronym>s 12 et 13 par exemple.</para>

<screen>r1:~# sh ./subinterfaces.sh 12 13</screen>

		<para>On adapte l'utilisation du même script aux routeurs R2 et R3 avec
		les numéros de <acronym>VLAN</acronym>s concernés.</para>
	</listitem>

	<listitem>
		<para>Activer les démons <systemitem class='daemon'>zebra</systemitem>
		et <systemitem class='daemon'>ospfd</systemitem> sur chaque routeur en
		éditant le fichier <filename>/etc/quagga/daemons</filename> et en
		remplaçant <option>no</option> par <option>yes</option>.</para>

<screen><prompt>r1:~#</prompt> grep -v '^#' /etc/quagga/daemons
zebra=yes
bgpd=no
ospfd=yes
ospf6d=no
ripd=no
ripngd=no
isisd=no</screen>
	</listitem>

	<listitem>
		<para>Créer les fichiers de configuration de base pour les deux démons
		<systemitem class='daemon'>zebra</systemitem> et <systemitem
		class='daemon'>ospfd</systemitem> sur chaque routeur en utilisant les
		patrons livrés avec le paquet <application>quagga</application>.</para>

<screen><prompt>r1:/etc/quagga#</prompt> cp /usr/share/doc/quagga/examples/zebra.conf.sample zebra.conf
<prompt>r1:/etc/quagga#</prompt> cp /usr/share/doc/quagga/examples/ospfd.conf.sample ospfd.conf
<prompt>r1:/etc/quagga#</prompt> chown quagga zebra.conf ospfd.conf</screen>
	</listitem>

	<listitem>
		<para>Éditer le patron du fichier de configuration du démon <systemitem
		class='daemon'>zebra</systemitem> en fixant les paramètres de connexion
		à utiliser pour y accéder.</para>

<screen><prompt>#</prompt> cat zebra.conf
! -*- zebra -*-
!
hostname R1-zebra
password zebra
enable password zebra
!
log file /var/log/quagga/zebra.log</screen>
	</listitem>

	<listitem>
		<para>Éditer le patron du fichier de configuration du démon <systemitem
		class='daemon'>ospfd</systemitem> en fixant les paramètres de connexion
		à utiliser pour y accéder.</para>

<screen><prompt>#</prompt> cat ospfd.conf
! -*- ospf -*-
!
hostname R1-ospfd
password zebra
enable password zebra
!
log file /var/log/quagga/ospfd.log</screen>
	</listitem>

	<listitem>
		<para>Compléter la configuration des interfaces dans le démon
		<systemitem class='daemon'>zebra</systemitem> de façon à fixer la bande
		passante de chaque interface active.</para>

<screen><prompt>r1:/etc/quagga#</prompt> grep -1 bandwidth zebra.conf
interface eth0
 bandwidth 100000
 ipv6 nd suppress-ra
--
interface eth0.12
 bandwidth 100000
 ipv6 nd suppress-ra
--
interface eth0.13
 bandwidth 100000
 ipv6 nd suppress-ra</screen>

		<note>
		<para>Contrairement à un routeur «intégré» avec un système
		d'exploitation dédié, le démon de routage statique n'a pas directement
		accès aux interfaces matérielles. Or, sur un système GNU/Linux, le
		débit d'une interface nommée <option>eth0</option> peut aller de 10Mbps
		à 10Gbps. Sans information spécifique du noyau, l'application «service
		de routage» n'a aucun moyen de connaître le débit exact de l'interface
		<option>eth0</option>. C'est la raison pour laquelle il est nécessaire
		de paramétrer manuellement les débits de chaque interface dans la
		configuration du démon <systemitem
		class='daemon'>zebra</systemitem>.</para> 
		</note>
	</listitem>
	</itemizedlist>

	<warning>
	<para>Ce dernier paramétrage est essentiel dans le <link
	linkend='interco.ospf.auto-cost'>calcul des métriques</link> et le
	fonctionnement du protocole de routage <acronym>OSPF</acronym>. Si les
	calculs de métriques pour les liens actifs sont erronés, le choix des
	routes à emprunter pour faire transiter le trafic utilisateur entre deux
	routeurs peut lui aussi être erroné.</para>
	</warning>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf.pointopoint'>
	<title>Communications entre routeurs</title>

	<para>Avant d'aborder le déploiement du protocole de routage dynamique, il
	est nécessaire de valider les communications <acronym>IP</acronym> entre
	chaque routeur et de visualiser les tables de routage déjà connues.</para>

	<qandaset>
	<qandaentry>
	<question>
		<para><phrase>Quelles sont les opérations à effectuer pour implanter
		les adresses <acronym>IP</acronym> des interfaces correspondant à
		chacun des <acronym>VLAN</acronym>s routés ?</phrase></para>

		<para>Au niveau liaison, les sous-interfaces ont déjà été configurées
		avec le script <link
		linkend='interco.ospf.prepare-config.subinterfaces'>subinterfaces.sh</link>.
		Il reste à paramétrer les adresses <acronym>IP</acronym> de ces
		sous-interfaces.</para>
	</question>
	<answer>
		<variablelist>
		<varlistentry>
			<term>Routeur R1</term>
		<listitem>
<screen><prompt>r1:~#</prompt> ip addr add 10.1.12.1/26 brd + dev eth0.12
<prompt>r1:~#</prompt> ip addr add 10.1.13.1/26 brd + dev eth0.13</screen>
		</listitem>
		</varlistentry>
		<varlistentry>
			<term>Routeur R2</term>
		<listitem>
<screen><prompt>r2:~#</prompt> ip addr add 10.1.12.2/26 brd + dev eth0.12
<prompt>r2:~#</prompt> ip addr add 10.1.23.2/26 brd + dev eth0.23</screen>
		</listitem>
		</varlistentry>
		<varlistentry>
			<term>Routeur R3</term>
		<listitem>
<screen><prompt>r3:~#</prompt> ip addr add 10.1.23.3/26 brd + dev eth0.23
<prompt>r3:~#</prompt> ip addr add 10.1.13.3/26 brd + dev eth0.13</screen>
		</listitem>
		</varlistentry>
		</variablelist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les opérations à effectuer pour valider les
		communications <acronym>IP</acronym> entre routeurs ?</phrase></para>

		<para>Lancer les tests <acronym>ICMP</acronym> usuels entre chaque
		routeur sur chaque lien actif.</para>
	</question>
	<answer>
		<variablelist>
		<varlistentry>
			<term>Exemple entre R1 et R2</term>
		<listitem>
<screen><prompt>r1:~$</prompt> ping -c2 10.1.12.2
PING 10.1.12.2 (10.1.12.2) 56(84) bytes of data.
64 bytes from 10.1.12.2: icmp_seq=1 ttl=64 time=0.810 ms
64 bytes from 10.1.12.2: icmp_seq=2 ttl=64 time=0.715 ms

--- 10.1.12.2 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 0.715/0.762/0.810/0.054 ms</screen>
		</listitem>
		</varlistentry>
		</variablelist>

		<para>L'opération est à répéter sur chaque lien entre deux routeurs
		reliés sur le même <acronym>VLAN</acronym>.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les opérations à effectuer pour visualiser
		la table de routage existante d'un routeur au niveau système et au
		niveau du démon de routage statique <application>zebra</application>
		?</phrase></para>

		<para>Utiliser la commande <command>ip</command> pour visualiser la
		table de routage puis afficher la même table de routage à partir de la
		connexion au démon <application>zebra</application> avec la commande
		usuelle du système <trademark>Cisco</trademark>
		<acronym>IOS</acronym>.</para>
	</question>
	<answer>
		<variablelist>
		<varlistentry>
			<term>Routeur R1 - niveau système</term>
		<listitem>
<screen><prompt>r1:~$</prompt> ip route ls
default via 192.0.2.1 dev eth0 
10.1.12.0/26 dev eth0.12  proto kernel  scope link  src 10.1.12.1 
10.1.13.0/26 dev eth0.13  proto kernel  scope link  src 10.1.13.1 
192.0.2.0/26 dev eth0  proto kernel  scope link  src 192.0.2.10</screen>

		<para>Toutes les routes affichées correspondent à des réseaux
		<acronym>IPv4</acronym> sur lesquels le routeur est directement
		connecté via une interface active et correctement configurée.</para>
		</listitem>
		</varlistentry>

		<varlistentry>
			<term>Routeur R1 - démon zebra</term>
		<listitem>
<screen><prompt>R1-zebra#</prompt> sh ip route 
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, A - Babel,
       > - selected route, * - FIB route

K>* 0.0.0.0/0 via 192.0.2.1, eth0
C>* 10.1.12.0/26 is directly connected, eth0.12
C>* 10.1.13.0/26 is directly connected, eth0.13
C>* 127.0.0.0/8 is directly connected, lo
C>* 192.0.2.0/26 is directly connected, eth0</screen>

		<para>On retrouve les mêmes informations qu'au niveau système. Une
		distinction apparaît entre la route par défaut héritée du niveau
		système qui est repérée avec l'indicateur <option>K</option> et les
		autres routes qui correspondent aux réseaux <acronym>IPv4</acronym> sur
		lesquels le routeur est directement connecté.</para>
		</listitem>
		</varlistentry>

		<varlistentry>
			<term>Routeur R2 - niveau système</term>
		<listitem>
<screen><prompt>r2:~$</prompt> ip route ls
10.1.12.0/26 dev eth0.12  proto kernel  scope link  src 10.1.12.2 
10.1.23.0/26 dev eth0.23  proto kernel  scope link  src 10.1.23.2</screen>
		</listitem>
		</varlistentry>

		<varlistentry>
			<term>Routeur R2 - démon zebra</term>
		<listitem>
<screen><prompt>R2-zebra#</prompt> sh ip route 
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, A - Babel,
       > - selected route, * - FIB route

C>* 10.1.12.0/26 is directly connected, eth0.12
C>* 10.1.23.0/26 is directly connected, eth0.23
C>* 127.0.0.0/8 is directly connected, lo</screen>
		</listitem>
		</varlistentry>

		<varlistentry>
			<term>Routeur R3 - niveau système</term>
		<listitem>
<screen><prompt>r3:~$</prompt> ip route ls
10.1.13.0/26 dev eth0.13  proto kernel  scope link  src 10.1.13.3 
10.1.23.0/26 dev eth0.23  proto kernel  scope link  src 10.1.23.3</screen>
		</listitem>
		</varlistentry>

		<varlistentry>
			<term>Routeur R3 - démon zebra</term>
		<listitem>
<screen><prompt>R3-zebra#</prompt> sh ip route
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, A - Babel,
       > - selected route, * - FIB route

C>* 10.1.13.0/26 is directly connected, eth0.13
C>* 10.1.23.0/26 is directly connected, eth0.23
C>* 127.0.0.0/8 is directly connected, lo</screen>
		</listitem>
		</varlistentry>
		</variablelist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelle est l'opération à effectuer pour activer la
		fonction routage du noyau Linux ?</phrase></para>

		<para>Reprendre l'instruction présentée dans le document
		&url.config.interface.lan.proc;.</para>

		<para>L'opération doit être répétée sur chacun des trois routeurs pour
		que le protocole de routage dynamique puisse fonctionner
		normalement.</para>
	</question>
	<answer>
		<para>Si cette fonction n'est pas active dans le noyau Linux, aucune
		décision d'acheminement d'un paquet d'une interface vers l'autre ne
		sera prise. Les paquets à router sont simplement jetés.</para>

		<para>Les instructions d'activation de la fonction de routage sont
		données dans la section <link
		linkend='interco.ospf.prepare-config.routing'>Préparation des
		routeurs</link>.</para>
	</answer>
	</qandaentry>
	</qandaset>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf.protocol-config'>
	<title>Configuration OSPF de base</title>

	<para>Dans cette section, on introduit les premières commandes de
	configuration du protocole de routage dynamique <acronym>OSPF</acronym> qui
	permettent d'activer le protocole puis d'introduire des entrées de réseau
	dans la base de données de ce protocole.</para>

	<qandaset>
	<qandaentry>
	<question>
		<para><phrase>Comment peut-on contrôler si le protocole
		<acronym>OSPF</acronym> est actif ou non sur le routeur
		?</phrase></para>

		<para>Une fois connecté au démon <systemitem
		class='daemon'>ospfd</systemitem>, lancer la commande de visualisation
		globale du protocole.</para>

		<para>Cette commande est utilisable sur chacun des trois routeurs.</para>
	</question>
	<answer>
		<para>Dans les informations données dans la copie d'écran ci-dessous,
		il apparaît que l'algorithme de calcul de topologie n'a pas encore été
		exécuté. Le protocole <acronym>OSPF</acronym> n'est dononc pas encore
		actif.</para>

<screen>etu@r1:~$ telnet localhost ospfd
Trying ::1...
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.

Hello, this is Quagga (version 0.99.24.1).
Copyright 1996-2005 Kunihiro Ishiguro, et al.


User Access Verification

Password: 
R1-ospfd> en
Password: 
R1-ospfd# sh ip ospf 
 OSPF Routing Process, Router ID: 192.0.2.10
 Supports only single TOS (TOS0) routes
 This implementation conforms to RFC2328
 RFC1583Compatibility flag is disabled
 OpaqueCapability flag is disabled
 Initial SPF scheduling delay 200 millisec(s)
 Minimum hold time between consecutive SPFs 1000 millisec(s)
 Maximum hold time between consecutive SPFs 10000 millisec(s)
 Hold time multiplier is currently 1
 <emphasis>SPF algorithm has not been run</emphasis>
 SPF timer is inactive
 Refresh timer 10 secs
 Number of external LSA 0. Checksum Sum 0x00000000
 Number of opaque AS LSA 0. Checksum Sum 0x00000000
 Number of areas attached to this router: 0</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les opérations à effectuer pour activer le
		protocole de routage <acronym>OSPF</acronym> et fixer manuellement
		l'identifiant du routeur ?</phrase></para>

		<warning>
		<para>Les identifiants à utiliser lors de la séance de travaux
		pratiques sont donnés dans le <xref linkend='lab.addressing'/>.</para>
		</warning>
    </question>
    <answer>
		<para>Toujours à partir de la connexion au démon <systemitem
		class='daemon'>ospfd</systemitem>, on exécute les commandes suivantes
		sur chacun des trois routeurs en prenant soin d'implanter le bon
		identifiant.</para>

<screen><prompt>R1-ospfd#</prompt> conf t
<prompt>R1-ospfd(config)#</prompt> router ospf
<prompt>R1-ospfd(config-router)#</prompt> router-id 0.0.0.1
<prompt>R1-ospfd(config-router)#</prompt> ^Z
<prompt>R1-ospfd#</prompt> sh ip ospf 
 OSPF Routing Process, <emphasis>Router ID: 0.0.0.1</emphasis>
 Supports only single TOS (TOS0) routes
 This implementation conforms to RFC2328
 RFC1583Compatibility flag is disabled
 OpaqueCapability flag is disabled
 Initial SPF scheduling delay 200 millisec(s)
 Minimum hold time between consecutive SPFs 1000 millisec(s)
 Maximum hold time between consecutive SPFs 10000 millisec(s)
 Hold time multiplier is currently 1
 SPF algorithm has not been run
 SPF timer is inactive
 Refresh timer 10 secs
 Number of external LSA 0. Checksum Sum 0x00000000
 Number of opaque AS LSA 0. Checksum Sum 0x00000000
 Number of areas attached to this router: 0</screen>

		<para>Le choix de codage des identifiants <acronym>OSPF</acronym> a
		pour but d'éviter une confusion avec les adresses des réseaux actifs
		sur chaque routeur. Dans l'exemple ci-dessus, on se réfère à la <xref
		linkend='interco.ospf.vm.router-id'/>.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les opérations à effectuer pour activer le
		protocole de routage <acronym>OSPF</acronym> pour les réseaux
		<acronym>IPv4</acronym> connus de	chaque routeur ?</phrase></para>

		<para>Dans la configuration du démon <systemitem
		class='daemon'>ospfd</systemitem>, ajouter une entrée de réseau pour
		chaque lien connu du routeur. La liste des liens connus correspond aux
		entrées marquées <option>C</option> de la table de routage visualisée à
		partir du démon <systemitem class='daemon'>zebra</systemitem>.</para>
	</question>
	<answer>
		<variablelist>
		<varlistentry>
			<term>Routeur R1</term>
		<listitem>
<screen>R1-ospfd# conf t
R1-ospfd(config)# router ospf
R1-ospfd(config-router)# router-id 0.0.0.1
R1-ospfd(config-router)# network 10.1.12.0/26 area 0
R1-ospfd(config-router)# network 10.1.13.0/26 area 0</screen>
		</listitem>
		</varlistentry>

		<varlistentry>
			<term>Routeur R2</term>
		<listitem>
<screen>R2-ospfd# conf t
R2-ospfd(config)# router ospf
R2-ospfd(config-router)# router-id 0.0.0.2
R2-ospfd(config-router)# network 10.1.12.0/26 area 0
R2-ospfd(config-router)# network 10.1.23.0/26 area 0</screen>
		</listitem>
		</varlistentry>

		<varlistentry>
			<term>Routeur R3</term>
		<listitem>
<screen>R3-ospfd# conf t
R3-ospfd(config)# router ospf
R3-ospfd(config-router)# router-id 0.0.0.3
R3-ospfd(config-router)# network 10.1.13.0/26 area 0
R3-ospfd(config-router)# network 10.1.23.0/26 area 0</screen>
		</listitem>
		</varlistentry>
		</variablelist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelle est la commande qui permet de visualiser l'état
		des interfaces actives du routeur vis-à-vis du protocole de routage
		<acronym>OSPF</acronym> ?</phrase></para>

		<para>Les interfaces sont automatiquement activées dès qu'une entrée de
		réseau est saisie au niveau du démon <systemitem
		class='daemon'>ospfd</systemitem> et que l'adresse
		<acronym>IP</acronym> de l'interface correspond à ce réseau.</para>
	</question>
	<answer>
		<para>C'est la commande <command>sh ip ospf interface</command> qui
		affiche l'état de chaque interface du routeur.</para>

		<variablelist>
		<varlistentry>
			<term>Exemple du routeur R1</term>
		<listitem>
<screen>R1-ospfd# sh ip ospf interface 
eth0 is up
  ifindex 2, MTU 1500 bytes, BW 100000 Kbit &lt;UP,BROADCAST,RUNNING,MULTICAST>
  <emphasis>OSPF not enabled on this interface</emphasis>
eth0.12 is up
  ifindex 11, MTU 1500 bytes, BW 100000 Kbit &lt;UP,BROADCAST,RUNNING,MULTICAST>
  Internet Address 10.1.12.1/26, Broadcast 10.1.12.63, Area 0.0.0.0
  MTU mismatch detection:enabled
  Router ID 0.0.0.1, Network Type BROADCAST, Cost: 100
  Transmit Delay is 1 sec, State DR, Priority 1
  Designated Router (ID) 0.0.0.1, Interface Address 10.1.12.1
  Backup Designated Router (ID) 0.0.0.2, Interface Address 10.1.12.2
  Multicast group memberships: OSPFAllRouters OSPFDesignatedRouters
  Timer intervals configured, Hello 10s, Dead 40s, Wait 40s, Retransmit 5
    Hello due in 1.379s
  Neighbor Count is 1, Adjacent neighbor count is 1
eth0.13 is up
  ifindex 12, MTU 1500 bytes, BW 100000 Kbit &lt;UP,BROADCAST,RUNNING,MULTICAST>
  Internet Address 10.1.13.1/26, Broadcast 10.1.13.63, Area 0.0.0.0
  MTU mismatch detection:enabled
  Router ID 0.0.0.1, Network Type BROADCAST, Cost: 100
  Transmit Delay is 1 sec, State DR, Priority 1
  Designated Router (ID) 0.0.0.1, Interface Address 10.1.13.1
  Backup Designated Router (ID) 0.0.0.3, Interface Address 10.1.13.3
  Multicast group memberships: OSPFAllRouters OSPFDesignatedRouters
  Timer intervals configured, Hello 10s, Dead 40s, Wait 40s, Retransmit 5
    Hello due in 9.490s
  Neighbor Count is 1, Adjacent neighbor count is 1
lo is up
  ifindex 1, MTU 65536 bytes, BW 0 Kbit &lt;UP,LOOPBACK,RUNNING>
  OSPF not enabled on this interface</screen>
		</listitem>
		</varlistentry>
		</variablelist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>À partir des informations affichées dans la question
		précédente, retrouver l'identifiant de routeur et le type de réseau,
		repérer et identifier la présence d'un autre routeur sur le même
		réseau.</phrase></para>

		<para>Pour chaque interface vue du démon de routage
		<acronym>OSPF</acronym>, repérer les informations relatives au type de
		réseau et au décomptage des routeurs voisins.</para>
	</question>
	<answer>
		<para>En reprenant l'exemple du routeur <systemitem
		class='systemname'>R1</systemitem> et de son interface
		<option>eth0.12</option>, on relève les informations suivantes.</para>

		<variablelist>
		<varlistentry>
			<term><literal>Router ID 0.0.0.1, Network Type BROADCAST, Cost: 1</literal></term>
		<listitem>
		<para>L'identifiant <acronym>OSPF</acronym> du routeur est <systemitem
		class='ipaddress'>0.0.0.1</systemitem> ; soit le routeur <systemitem
		class='systemname'>R1</systemitem>. L'interface est connectée sur un
		réseau Ethernet de type <emphasis>diffusion</emphasis> dans lequel
		<systemitem class='systemname'>R1</systemitem> est un «routeur désigné»
		(<wordasword>Designated Router</wordasword>) qui sert de référence aux
		autres routeurs du même périmètre de diffusion ; <systemitem
		class='systemname'>R2</systemitem> dans cet exemple.</para>
		</listitem>
		</varlistentry>

		<varlistentry>
			<term><literal>Neighbor Count is 1, Adjacent neighbor count is 1</literal></term>
		<listitem>
		<para>Un routeur <acronym>OSPF</acronym> voisin a été reconnu sur ce
		lien et une adjacence a été établie. Il s'agit du routeur <systemitem
		class='systemname'>R2</systemitem> qui apparaît avec l'identifiant
		<systemitem class='ipaddress'>0.0.0.2</systemitem> sur une ligne
		au-dessus.</para>
		</listitem>
		</varlistentry>
		</variablelist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment peut-on vérifier que l'algorithme
		<acronym>SPF</acronym> du protocole <acronym>OSPF</acronym> à été
		correctement exécuté, que le protocole a convergé et que les entrées de
		table de routage ont été publiées ?</phrase></para>

		<para>Visualiser les listes des routeurs voisins puis la liste des
		routes présentes dans la base de données du démon <systemitem
		class='daemon'>ospfd</systemitem>. Faire la correspondance entre les
		métriques affichées et les bandes passantes de chaque lien.</para>
	</question>
	<answer>
		<para>En reprenant l'exemple du routeur <systemitem
		class='systemname'>R1</systemitem>, on consulte la liste des voisins
		<acronym>OSPF</acronym>.</para>

<screen>R1-ospfd# sh ip ospf neighbor 

Neighbor ID Pri State        Dead Time Address      Interface         RXmtL RqstL DBsmL
0.0.0.2       1 Full/Backup    39.347s 10.1.12.2    eth0.12:10.1.12.1     0     0     0
0.0.0.3       1 Full/Backup    34.493s 10.1.13.3    eth0.13:10.1.13.1     0     0     0</screen>

		<para>Dans cette liste, on relève la présence des deux autres routeurs
		:</para>

		<itemizedlist>
		<listitem>
			<para><systemitem class='systemname'>R2</systemitem> avec
			l'identifiant <systemitem
			class='ipaddress'>0.0.0.2</systemitem></para>
		</listitem>
		<listitem>
			<para><systemitem class='systemname'>R3</systemitem> avec
			l'identifiant <systemitem
			class='ipaddress'>0.0.0.3</systemitem></para>
		</listitem>
		</itemizedlist>

		<para>L'indicateur d'état <literal>Full/Backup</literal> montre que le
		dialogue entre les routeurs voisins à convergé vers l'état stable et
		que le routeur voisin de <systemitem class='systemname'>R1</systemitem>
		joue le rôle de «routeur désigné de secours» (<wordasword>Backup
		Designated Router</wordasword>).</para>

		<para>Ensuite, on trouve de gauche à droite l'adresse
		<acronym>IPv4</acronym> de l'interface réseau du routeur voisin et
		l'interface du routeur local ainsi que son adresse
		<acronym>IP</acronym>.</para>

		<para>Toujours sur le routeur <systemitem
		class='systemname'>R1</systemitem>, la liste des routes publiées par le
		démon <systemitem class='daemon'>ospfd</systemitem> est donnée par la
		commande <command>sh ip ospf route</command>.</para>

<screen>R1-ospfd# sh ip ospf route 
============ OSPF network routing table ============
N    10.1.12.0/26          [100] area: 0.0.0.0
                           directly attached to eth0.12
N    10.1.13.0/26          [100] area: 0.0.0.0
                           directly attached to eth0.13
N    10.1.23.0/26          [200] area: 0.0.0.0
                           via 10.1.12.2, eth0.12
                           via 10.1.13.3, eth0.13

============ OSPF router routing table =============

============ OSPF external routing table ===========</screen>

		<para>Les valeurs notées entre crochets correspondent à la métrique du
		lien pour joindre le réseau à gauche. Pour le protocole
		<acronym>OSPF</acronym>, le calcul de métrique se fait à partir de
		l'expression : 10<superscript>8</superscript> /
		Bande_Passante_du_lien.</para>

		<para>La valeur du numérateur (10<superscript>8</superscript>)
		correspond à un débit de 100Mbps. À l'époque de la rédaction du
		standard <acronym>OSPFv2</acronym>, ce débit a servi de référence.
		Aujourd'hui, cette valeur est complètement dépassée. C'est la raison
		pour laquelle on adapte le calcul de métrique en changeant le
		coefficient du numérateur. Voir la <xref
		linkend='interco.ospf.auto-cost' />.</para> 

		<para>Les deux premiers réseaux de la table sont joignable via un lien
		Ethernet à 100Mbps ; soit une métrique de <option>100</option>. Le
		troisième réseau est joignable via deux liens Ethernet à 100Mbps ; d'où
		la métrique de <option>200</option>.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quel est le mode d'affichage de la table de routage du
		système qui offre le plus d'informations ?</phrase></para>

		<para>Identifier le «lieu de la synthèse» de tous les canaux
		d'information sur la table de routage d'un routeur.</para>
	</question>
	<answer>
		<para>C'est le démon <systemitem class='daemon'>zebra</systemitem> qui
		offre le plus d'informations sur les entrées de table de routage de
		l'ensemble du système. Il faut donc se connecter à ce démon pour
		visualiser toutes les propositions ainsi que les choix retenus pour la
		table de routage.</para>

<screen>R1-zebra# sh ip route
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, A - Babel,
       > - selected route, * - FIB route

K>* 0.0.0.0/0 via 192.0.2.1, eth0
O   10.1.12.0/26 [110/100] is directly connected, eth0.12, 00:47:45
C>* 10.1.12.0/26 is directly connected, eth0.12
O   10.1.13.0/26 [110/100] is directly connected, eth0.13, 00:47:45
C>* 10.1.13.0/26 is directly connected, eth0.13
O>* 10.1.23.0/26 [110/200] via 10.1.12.2, eth0.12, 00:44:56
  *                        via 10.1.13.3, eth0.13, 00:44:56
C>* 127.0.0.0/8 is directly connected, lo
C>* 192.0.2.0/26 is directly connected, eth0</screen>

		<itemizedlist>
		<listitem>
			<para>Les entrées avec le caractère <option>*</option>
			correspondent aux routes actives mémorisées dans la base de
			commutation des paquets <acronym>IP</acronym> ou
			<wordasword>Forward Information	Base</wordasword>
			(<acronym>FIB</acronym>).</para>
		</listitem>
		<listitem>
			<para>L'entrée notée <option>K</option> correspond à une route
			apprise via la configuration système.</para>
		</listitem>
		<listitem>
			<para>Les entrées notées <option>C</option> correspondent à des
			routes pour lesquelles il existe une interface sur le routeur. Les
			métriques de ses routes ont la valeur <option>0</option>. Ce sont
			les routes les	plus prioritaires.</para>
		</listitem>
		<listitem>
			<para>Les entrées notées <option>O</option> correspondent aux
			routes apprises via le protocole <acronym>OSPF</acronym>. La
			métrique de ces routes se décompose en deux parties. La valeur
			figée à <option>110</option> définit le niveau de priorité du
			protocole <acronym>OSPF</acronym> (<wordasword>Administrative
			Distance</wordasword>) relativement aux autres protocoles de
			routage. Les valeurs notées après le <option>/</option> sont les
			métriques de liens calculées comme indiqué ci-dessus.</para>
		</listitem>
		</itemizedlist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment visualiser la table de routage au niveau système
		?</phrase></para>

		<para>Utiliser une commande usuelle de visualisation de la table de
		routage.</para>
	</question>
	<answer>
		<para>Avec la commande <command>ip</command>, on voit apparaître les
		«sources» d'alimentation de la table de routage finale du système :
		<option>kernel</option> et <option>zebra</option>.</para>

<screen><prompt>r1:~$</prompt> ip route ls
default via 192.0.2.1 dev eth0 
10.1.12.0/26 dev eth0.12  proto kernel  scope link  src 10.1.12.1 
10.1.13.0/26 dev eth0.13  proto kernel  scope link  src 10.1.13.1 
10.1.23.0/26  proto zebra  metric 200 
        nexthop via 10.1.12.2  dev eth0.12 weight 1
        nexthop via 10.1.13.3  dev eth0.13 weight 1
192.0.2.0/26 dev eth0  proto kernel  scope link  src 192.0.2.10</screen>
	</answer>
	</qandaentry>
	</qandaset>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf.default-information'>
	<title>Publication d'une route par défaut via OSPF</title>

	<para>Dans la topologie logique étudiée, le routeur <systemitem
	class='systemname'>R1</systemitem> dispose d'un lien montant vers
	l'Internet. On peut donc considérer que ce lien est la route par défaut
	vers tous les réseaux non connus de l'aire <acronym>OSPF</acronym>
	contenant les trois routeurs.</para>

	<para>Il est possible de publier une route par défaut via le protocole
	<acronym>OSPF</acronym> depuis le routeur <systemitem
	class='systemname'>R1</systemitem> vers les routeurs <systemitem
	class='systemname'>R2</systemitem> et <systemitem
	class='systemname'>R3</systemitem>.</para>

	<para>Voici, pour mémoire, une copie de la base de données
	<acronym>OSPF</acronym> avant la mise en place de la publication de route
	par défaut. On reconnaît les <acronym>LSA</acronym>s (<wordasword>Link
	State Advertisement)</wordasword>) de type 1 et 2 qui correspondent
	respectivement aux annonces de routeurs et de réseaux.</para>

<screen><prompt>R1-ospfd#</prompt> sh ip ospf database 

       OSPF Router with ID (0.0.0.1)

                Router Link States (Area 0.0.0.0)

Link ID         ADV Router      Age  Seq#       CkSum  Link count
0.0.0.1         0.0.0.1          210 0x80000021 0xebbe 2
0.0.0.2         0.0.0.2         1345 0x8000001e 0xe7ae 2
0.0.0.3         0.0.0.3         1654 0x8000001f 0xcf44 3

                Net Link States (Area 0.0.0.0)

Link ID         ADV Router      Age  Seq#       CkSum
10.1.12.1       0.0.0.1         1670 0x80000018 0xda8b
10.1.13.1       0.0.0.1         1120 0x80000018 0xdd86
10.1.23.2       0.0.0.2         1405 0x80000018 0x69ed</screen>

	<qandaset>
	<qandaentry>
	<question>
		<para><phrase>Quelle est la condition préalable à respecter pour que le
		routeur <systemitem class='systemname'>R1</systemitem> soit en mesure
		de publier une route par défaut via son démon
		<acronym>OSPF</acronym> ?</phrase></para>

		<para>Parmi toutes les méthodes de redistribution de routes dans la
		protocole <acronym>OSPF</acronym>, il en existe une dédiée à
		l'injection de route par défaut dans une aire normale : Voir <xref
		linkend='interco.ospf.refdocs.cisco-ospf' />.</para>
	</question>
	<answer>
		<para>Une route par défaut doit exister avant d'être injectée dans une
		aire <acronym>OSPF</acronym>. Dans notre cas, une route statique par
		défaut suffit à respecter la condition préalable.</para>

		<para>Sur la maquette, on valide la présence de la route par défaut
		comme suit :</para>

<screen><prompt>r1:~$</prompt> ip route ls | grep default
default via 192.0.2.1 dev eth0</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelle est l'instruction à utiliser pour publier une
		route par défaut via le protocole de routage <acronym>OSPF</acronym>
		?</phrase></para>

		<para>Rechercher le mot clé <option>default</option> dans la liste des
		commandes relatives au démon <systemitem
		class='daemon'>ospfd</systemitem>.</para>
	</question>
	<answer>
		<para>C'est la commande <command>default-information
		originate</command> que l'on doit placer dans la configuration de
		l'instance <acronym>OSPF</acronym>.</para>

<screen><prompt>R1-ospfd#</prompt> conf t
R1-ospfd(config)# router ospf
R1-ospfd(config-router)# default-information originate</screen>

		<para>Une fois cette instruction exécutée, la base de données
		<acronym>OSPF</acronym> devient :</para>

<screen><prompt>R1-ospfd#</prompt> sh ip ospf database 

       OSPF Router with ID (0.0.0.1)

                Router Link States (Area 0.0.0.0)

Link ID         ADV Router      Age  Seq#       CkSum  Link count
0.0.0.1         0.0.0.1          784 0x80000021 0xebbe 2
0.0.0.2         0.0.0.2           58 0x8000001f 0xe5af 2
0.0.0.3         0.0.0.3          463 0x80000020 0xcd45 3

                Net Link States (Area 0.0.0.0)

Link ID         ADV Router      Age  Seq#       CkSum
10.1.12.1       0.0.0.1          394 0x80000019 0xd88c
10.1.13.1       0.0.0.1         1694 0x80000018 0xdd86
10.1.23.2       0.0.0.2          228 0x80000019 0x67ee

                <emphasis>AS External Link States</emphasis>

Link ID         ADV Router      Age  Seq#       CkSum  Route
0.0.0.0         0.0.0.1          514 0x80000003 0x3d88 E2 0.0.0.0/0 [0x0]</screen>

		<para>On voit apparaître une nouvelle rubrique baptisée <wordasword>AS
		External Link States</wordasword>. Ce nouveau rôle pour le routeur
		<systemitem class='systemname'>R1</systemitem> apparaît aussi lorsque
		l'on affiche l'état de l'instance de routage
		<acronym>OSPF</acronym>.</para>

<screen>R1-ospfd# sh ip ospf 
 OSPF Routing Process, Router ID: 0.0.0.1
 Supports only single TOS (TOS0) routes
 This implementation conforms to RFC2328
 RFC1583Compatibility flag is disabled
 OpaqueCapability flag is disabled
 Initial SPF scheduling delay 200 millisec(s)
 Minimum hold time between consecutive SPFs 1000 millisec(s)
 Maximum hold time between consecutive SPFs 10000 millisec(s)
 Hold time multiplier is currently 1
 SPF algorithm last executed 39m29s ago
 Last SPF duration 148 usecs
 SPF timer is inactive
 Refresh timer 10 secs
 <emphasis>This router is an ASBR (injecting external routing information)</emphasis>
 Number of external LSA 1. Checksum Sum 0x00003d88
 Number of opaque AS LSA 0. Checksum Sum 0x00000000
 Number of areas attached to this router: 1

 Area ID: 0.0.0.0 (Backbone)
   Number of interfaces in this area: Total: 2, Active: 2
   Number of fully adjacent neighbors in this area: 2
   Area has no authentication
   SPF algorithm executed 16 times
   Number of LSA 6
   Number of router LSA 3. Checksum Sum 0x00029eb2
   Number of network LSA 3. Checksum Sum 0x00021e00
   Number of summary LSA 0. Checksum Sum 0x00000000
   Number of ASBR summary LSA 0. Checksum Sum 0x00000000
   Number of NSSA LSA 0. Checksum Sum 0x00000000
   Number of opaque link LSA 0. Checksum Sum 0x00000000
   Number of opaque area LSA 0. Checksum Sum 0x00000000</screen>

		<para>Le routeur <systemitem class='systemname'>R1</systemitem>, est
		maintenant à la frontière entre deux systèmes autonomes. Il a le rôle
		<acronym>ASBR</acronym> (<wordasword>Autonmous System Border
		Router</wordasword>) et il est responsable de l'émission des
		<acronym>LSA</acronym>s de type 5 à destination des autres routeurs de
		l'aire.</para>

		<para>Ici, <systemitem class='systemname'>R1</systemitem> utilise
		<acronym>OSPF</acronym> et possède une route statique définie au niveau
		système vers l'Internet. L'instruction donnée ci-dessus assure la
		redistribution de la route statique vers <systemitem
		class='systemname'>R2</systemitem> et <systemitem
		class='systemname'>R3</systemitem>. Cette route apparaît comme une
		entrée de type <option>E2</option> dans les tables de routage de ces
		routeurs.</para>

		<para>L'indicateur <option>E2</option> correspond au type par défaut
		des routes apprises par le biais de la redistribution. La métrique est
		un point important à considérer avec les routes de type
		<option>E2</option>. Ces routes ne présentent que le coût du chemin
		allant du routeur <acronym>ASBR</acronym> vers le réseau de destination
		; ce qui ne correspond pas au coût réel du chemin.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment la publication de route par défaut apparaît-elle
		sur les différents routeurs <acronym>OSPF</acronym> ?</phrase></para>

		<para>Relevez la métrique de la route par défaut sur les routeurs qui
		n'ont pas une connexion directe vers l'Internet.</para>
	</question>
	<answer>
		<para>En prenant l'exemple du routeur <systemitem
		class='systemname'>R2</systemitem>, on retrouve les informations
		suivantes :</para>

		<itemizedlist>
		<listitem>
			<para>Vu du démon <systemitem class='daemon'>ospfd</systemitem>
			:</para>

<screen><prompt>R2-ospfd#</prompt> sh ip ospf route 
============ OSPF network routing table ============
N    10.1.3.0/29           [110] area: 0.0.0.0
                           via 10.1.23.3, eth0.23
N    10.1.12.0/26          [10] area: 0.0.0.0
                           directly attached to eth0.12
N    10.1.13.0/26          [20] area: 0.0.0.0
                           via 10.1.12.1, eth0.12
                           via 10.1.23.3, eth0.23
N    10.1.23.0/26          [10] area: 0.0.0.0
                           directly attached to eth0.23

============ OSPF router routing table =============
R    0.0.0.1               [10] area: 0.0.0.0, ASBR
                           via 10.1.12.1, eth0.12

============ OSPF external routing table ===========
<emphasis>N E2 0.0.0.0/0             [10/10] tag: 0
                           via 10.1.12.1, eth0.12</emphasis></screen>
		</listitem>
		<listitem>
		<para>Vu du démmon <systemitem class='daemon'>zebra</systemitem>
		:</para>

<screen><prompt>R2-zebra#</prompt> sh ip route 
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, A - Babel,
       > - selected route, * - FIB route

<emphasis>O>* 0.0.0.0/0 [110/10] via 10.1.12.1, eth0.12, 2d03h12m</emphasis>
O>* 10.1.3.0/29 [110/110] via 10.1.23.3, eth0.23, 2d03h36m
O   10.1.12.0/26 [110/10] is directly connected, eth0.12, 2d03h32m
C>* 10.1.12.0/26 is directly connected, eth0.12
O>* 10.1.13.0/26 [110/20] via 10.1.12.1, eth0.12, 2d03h31m
  *                       via 10.1.23.3, eth0.23, 2d03h31m
O   10.1.23.0/26 [110/10] is directly connected, eth0.23, 2d03h32m
C>* 10.1.23.0/26 is directly connected, eth0.23
C>* 127.0.0.0/8 is directly connected, lo</screen>
		</listitem>
		<listitem>
		<para>Vu du niveau système :</para>

<screen><prompt>r2:~$</prompt> ip route ls
<emphasis>default via 10.1.12.1 dev eth0.12  proto zebra  metric 10</emphasis>
10.1.3.0/29 via 10.1.23.3 dev eth0.23  proto zebra  metric 110 
10.1.12.0/26 dev eth0.12  proto kernel  scope link  src 10.1.12.2 
10.1.13.0/26  proto zebra  metric 20 
        nexthop via 10.1.12.1  dev eth0.12 weight 1
        nexthop via 10.1.23.3  dev eth0.23 weight 1
10.1.23.0/26 dev eth0.23  proto kernel  scope link  src 10.1.23.2</screen>
		</listitem>
		</itemizedlist>

		<para>La métrique relevée pour la route par défaut vaut
		<option>10</option>. Il s'agit d'un lien à 1Gbps. Voir la <xref
		linkend='interco.ospf.auto-cost' />. Cette métrique ne comprend que le
		coût du lien allant du routeur <systemitem
		class='systemname'>R1</systemitem> (avec le rôle
		<acronym>ASBR</acronym>) vers l'Internet.</para>
	</answer>
	</qandaentry>
	</qandaset>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf.dummies'>
	<title>Ajout de routes fictives</title>

	<para>L'introduction de nouvelles entrées fictives dans les tables de
	routage est une pratique très répandue. Elle permet de qualifier le bon
	fonctionnement du filtrage réseau ou d'un service Internet sans ajouter de
	matériel. Cette section décrit justement la mise en place d'un service Web
	de test.</para>

	<qandaset>
	<qandaentry>
	<question>
		<para><phrase>Quelles sont les opérations à effectuer pour pouvoir
		utiliser des interfaces réseau virtuelles de type boucle locale sur un
		système GNU/Linux ?</phrase></para>

		<para>Avec un noyau Linux, il est conseillé d'utiliser les interfaces
		baptisées <wordasword>dummy</wordasword> pour ce genre d'usage. Les
		opérations à effectuer consistent à charger le module du même nom en
		mémoire et à appliquer une nouvelle configuration
		<acronym>IP</acronym>.</para>
	</question>
	<answer>
<screen><prompt>#</prompt> modprobe -v dummy numdummies=2
insmod /lib/modules/4.2.0-1-686-pae/kernel/drivers/net/dummy.ko numdummies=2
<prompt>#</prompt> ip addr ls | grep dummy
5: dummy0: &lt;BROADCAST,NOARP> mtu 1500 qdisc noop state DOWN group default 
6: dummy1: &lt;BROADCAST,NOARP> mtu 1500 qdisc noop state DOWN group default</screen>

		<para>En prenant l'exemple du routeur <systemitem
		class='systemname'>R3</systemitem>, on créé une nouvelle interface avec
		l'adresse <acronym>IP</acronym> <systemitem
		class='ipaddress'>10.1.3.3/30</systemitem>. Bien sûr, cette adresse ne
		correspond à aucun réseau déjà connu des trois routeurs.</para>

<screen><prompt>#</prompt> ip addr add 10.1.3.3/29 brd + dev dummy0
<prompt>#</prompt> ip link set dev dummy0 up
<prompt>#</prompt> ip route ls
<emphasis>10.1.3.0/29 dev dummy0  proto kernel  scope link  src 10.1.3.3</emphasis>
10.1.12.0/26  proto zebra  metric 20 
        nexthop via 10.1.13.1  dev eth0.13 weight 1
        nexthop via 10.1.23.2  dev eth0.23 weight 1
10.1.13.0/26 dev eth0.13  proto kernel  scope link  src 10.1.13.3 
10.1.23.0/26 dev eth0.23  proto kernel  scope link  src 10.1.23.3</screen>

		<para>Cette nouvelle interface se retrouve automatiquement disponible
		dans la configuration les deux démons de routages. Dans <systemitem
		class='daemon'>zebra</systemitem> sur <systemitem
		class='systemname'>R3</systemitem>, on obtient les informations
		suivante sur l'interface <option>dummy0</option>.</para>

<screen><prompt>R3-zebra#</prompt> sh int dummy0
Interface dummy0 is up, line protocol detection is disabled
  index 5 metric 0 mtu 1500 
  flags: &lt;UP,BROADCAST,RUNNING,NOARP>
  HWaddr: 12:08:a0:09:f3:7d
  <emphasis>bandwidth 100000 kbps</emphasis>
  inet 10.1.3.3/29 broadcast 10.1.3.7
  inet6 fe80::1008:a0ff:fe09:f37d/64</screen>

		<para>On a fixé manuellement à 100Mbps dans <systemitem
		class='daemon'>zebra</systemitem> le débit associé à l'interface
		<option>dummy0</option>. Ce paramètre influence le calcul de métrique
		dans les bases de données <acronym>OSPF</acronym>.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les opérations à effectuer pour installer un
		service Web en écoute exclusivement sur l'adresse <acronym>IP</acronym>
		de l'interface <option>dummy0</option> ?</phrase></para>

		<para>Pour aller au plus court, on installe le paquet
		<application>apache2</application> et on édite la configuration du
		service de façon à limiter l'accès à l'adresse <acronym>IP</acronym>
		voulue.</para>
	</question>
	<answer>
<screen># aptitude install apache2
Les NOUVEAUX paquets suivants vont être installés :     
  apache2 apache2-bin{a} apache2-data{a} apache2-utils{a} libapr1{a}
  libaprutil1{a} libaprutil1-dbd-sqlite3{a} libaprutil1-ldap{a} liblua5.1-0{a}
  ssl-cert{a} 
  0 paquets mis à jour, 10 nouvellement installés, 0 à enlever et 0 non mis à jour.
  Il est nécessaire de télécharger 2 041 ko d'archives. Après dépaquetage,
  6 475 ko seront utilisés.
  Voulez-vous continuer ? [Y/n/?] Y</screen>

		<para>On modifie ensuite le fichier de configuration
		<filename>/etc/apache2/ports.conf</filename> de façon à limiter l'accès
		à une adresse <acronym>IP</acronym> unique.</para>

<screen><?dbfo keep-together="auto" ?><xi:include href='files/ports.conf.patch'
parse='text' xmlns:xi='http://www.w3.org/2001/XInclude'/></screen>

		<para>Après avoir redémarré l'instance de serveur Web, on vérifie que
		la nouvelle configuration est bien en place.</para>

<screen><prompt>#</prompt> /etc/init.d/apache2 restart
&lt;snipped>
<prompt>#</prompt> # ss -nlt '( src :80 )'
State       Recv-Q Send-Q   Local Address:Port     Peer Address:Port              
LISTEN      0      128           10.1.3.3:80                  *:*</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment ajouter la route correspondant au nouveau réseau
		<systemitem class='ipaddress'>10.1.3.0/29</systemitem> dans le domaine
		de routage <acronym>OSPF</acronym> ?</phrase></para>

		<para>Comme dans le cas de la mise en place des autres routes dans la
		configuration du démon <systemitem class='daemon'>ospfd</systemitem>,
		on ajoute une entrée <option>network</option> dans l'instance
		<acronym>OSPF</acronym> du routeur.</para>
	</question>
	<answer>
		<para>Dans le cas du routeur <systemitem
		class='systemname'>R3</systemitem>, la syntaxe est la suivante :</para>

<screen>R3-ospfd(config)# router ospf
R3-ospfd(config-router)# network 10.1.3.0/29 area 0</screen>

		<para>On vérifie ensuite que cette entrée est bien intégrée dans la
		base des routes <acronym>OSPF</acronym>.</para>

<screen>R3-ospfd(config)# sh ip ospf route</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment valider l'accès à ce service Web depuis les
		autres réseaux ?</phrase></para>

		<para>En respectant l'ordre des protocoles de la pile
		<acronym>TCP/IP</acronym>, on commence par valider la connectivité au
		niveau réseau avant de passer à la couche application.</para>
	</question>
	<answer>
		<para>À partir du routeur <systemitem
		class='systemname'>R1</systemitem>, on utilise la séquence suivante
		:</para>
		<itemizedlist>
		<listitem>
			<para>Test <acronym>ICMP</acronym> au niveau réseau :</para>

<screen><prompt>r1:~$</prompt> ping -c2 10.1.3.3
PING 10.1.3.3 (10.1.3.3) 56(84) bytes of data.
64 bytes from 10.1.3.3: icmp_seq=1 ttl=64 time=0.939 ms
64 bytes from 10.1.3.3: icmp_seq=2 ttl=64 time=0.561 ms

--- 10.1.3.3 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 0.561/0.750/0.939/0.189 ms</screen>
		</listitem>
		<listitem>
			<para>Test <acronym>HTTP</acronym> au niveau application :</para>

<screen><prompt>r1:~$</prompt> wget -O /dev/null http://10.1.3.3
--2015-10-28 09:24:29--  http://10.1.3.3/
Connexion à 10.1.3.3:80… connecté.
requête HTTP transmise, en attente de la réponse… 200 OK
Taille : 11104 (11K) [text/html]</screen>
		</listitem>
		</itemizedlist>
	</answer>
	</qandaentry>
	</qandaset>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf.auto-cost'>
	<title>Adaptation de la métrique de lien au débit</title>

	<para>Par défaut, le calcul de métrique du le protocole
	<acronym>OSPF</acronym> se fait à partir de l'expression :
	10<superscript>8</superscript> / Bande_Passante_du_lien.</para>

	<para>Cette règle a été établie à une époque où l'utilisation d'un lien à
	100Mbps devait être considéré comme une situation d'exploitation futuriste.
	Aujourd'hui, les liens à 100Mbps sont monnaie courante et les 100Gbps vont
	bientôt le devenir.</para>

	<para>Cette section traite donc de la configuration des instances de
	protocole de routage <acronym>OSPF</acronym> utilisant des liens avec une
	capacité supérieure à 100Mbps.</para>

	<qandaset>
	<qandaentry>
	<question>
		<para><phrase>Quelle est l'instruction à utiliser pour que le calcul de
		métrique <acronym>OSPF</acronym> se fasse sur la base d'un débit de
		lien à 10Gbps ?</phrase></para>

		<para>Rechercher le mot clé <wordasword>bandwidth</wordasword> dans la
		liste des instructions de configuration du démon <systemitem
		class='daemon'>ospfd</systemitem>.</para>
	</question>
	<answer>
		<para>C'est l'instruction <command>auto-cost
		reference-bandwidth</command> qui permet de fixer une nouvelle
		référence de coût de lien en Mbps.</para>

<screen>R2-ospfd(config-router)# auto-cost reference-bandwidth
  &lt;1-4294967>  The reference bandwidth in terms of Mbits per second</screen>

		<para>Voici un extrait de la configuration du routeur <systemitem
		class='systemname'>R2</systemitem> après application d'une nouvelle
		référence à 10000Mbps soit 10Gbps.</para>

<screen>router ospf
 ospf router-id 0.0.0.2
! Important: ensure reference bandwidth is consistent across all routers
 <emphasis>auto-cost reference-bandwidth 10000</emphasis>
 network 10.1.12.0/26 area 0.0.0.0
 network 10.1.23.0/26 area 0.0.0.0</screen>

		<para>Comme indiqué dans le commentaire ci-dessus, il est indispensable
		que tous les routeurs de l'aire <acronym>OSPF</acronym> aient la même
		référence de calcul de métrique. La même instruction doit donc être
		implantée dans la configuration des trois routeurs.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment modifier le débit d'un lien à 1Gbps ?</phrase></para>

		<para>Normalement, le débit d'un lien est directement extrait des
		paramètres de l'interface connectée au lien. Dans le cas d'interface
		qui n'ont «aucune réalité physique», ce débit peut être attribué
		arbitrairement par configuration. On doit rechercher dans les options
		des démons <systemitem class='daemon'>zebra</systemitem> et <systemitem
		class='daemon'>ospfd</systemitem> le moyen d'attribuer un débit aux
		sous-interfaces de <acronym>VLAN</acronym>s.</para>
	</question>
	<answer>
		<para>Comme indiqué dans la <xref
		linkend='interco.ospf.prepare-config'/>, c'est dans la configuration du
		démon <systemitem class='daemon'>zebra</systemitem> que l'on attribue
		le débit binaire d'une interface réseau. Cette opération est nécessaire
		compte tenu du fait que le débit d'une même interface Ethernet
		<option>eth0</option> peut varier de 10Mbps à 100Gbps.</para>

		<para>Dans toutes les sections précédentes, la bande passante des
		interfaces était fixée à 100Mbps. Pour tenir compte de la nouvelle
		référence de calcul de métrique, on applique une nouvelle valeur de
		bande passante fixée à 1Gbps sur les interfaces Ethernet des trois
		routeurs. Voici un extrait du fichier de configuration du démon
		<systemitem class='daemon'>zebra</systemitem> du routeur <systemitem
		class='systemname'>R2</systemitem>.</para>

<screen>interface eth0
 <emphasis>bandwidth 1000000</emphasis>
 ipv6 nd suppress-ra
!
interface eth0.12
 <emphasis>bandwidth 1000000</emphasis>
 ipv6 nd suppress-ra
!
interface eth0.23
 <emphasis>bandwidth 1000000</emphasis>
 ipv6 nd suppress-ra</screen>

		<para>Comme la valeur de base de bande passante est le kilobit par
		seconde, il faut 1 million de Kbps pour faire 1Gbps ou
		10<superscript>9</superscript>bps.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment peut-on identifier le débit d'un lien dans la
		configuration <acronym>OSPF</acronym> ?</phrase></para>

		<para>Visualiser les paramètres des interfaces réseau depuis la console
		du démon <systemitem class='daemon'>ospfd</systemitem>.</para>
	</question>
	<answer>
		<para>C'est l'instruction <command>sh ip ospf interface</command> qui
		permet d'afficher la valeur de débit attribuée aux interfaces avec le
		protocole de routage <acronym>OSPF</acronym>.</para>

		<para>Voici le résultat obtenu sur le routeur <systemitem
		class='systemname'>R2</systemitem>.</para>

<screen><prompt>R2-ospfd#</prompt> sh ip ospf interface
eth0 is up
  ifindex 2, MTU 1500 bytes, <emphasis>BW 1000000 Kbit</emphasis> &lt;UP,BROADCAST,RUNNING,MULTICAST>
  OSPF not enabled on this interface
eth0.12 is up
  ifindex 3, MTU 1496 bytes, <emphasis>BW 1000000 Kbit</emphasis> &lt;UP,BROADCAST,RUNNING,MULTICAST>
  Internet Address 10.1.12.2/26, Broadcast 10.1.12.63, Area 0.0.0.0
  MTU mismatch detection:enabled
  Router ID 0.0.0.2, Network Type BROADCAST, Cost: 1
  Transmit Delay is 1 sec, State DR, Priority 1
  Designated Router (ID) 0.0.0.2, Interface Address 10.1.12.2
  Backup Designated Router (ID) 0.0.0.1, Interface Address 10.1.12.1
  Multicast group memberships: OSPFAllRouters OSPFDesignatedRouters
  Timer intervals configured, Hello 10s, Dead 40s, Wait 40s, Retransmit 5
    Hello due in 8.604s
  Neighbor Count is 1, Adjacent neighbor count is 1
eth0.23 is up
  ifindex 4, MTU 1496 bytes, <emphasis>BW 1000000 Kbit</emphasis> &lt;UP,BROADCAST,RUNNING,MULTICAST>
  Internet Address 10.1.23.2/26, Broadcast 10.1.23.63, Area 0.0.0.0
  MTU mismatch detection:enabled
  Router ID 0.0.0.2, Network Type BROADCAST, Cost: 1
  Transmit Delay is 1 sec, State Backup, Priority 1
  Designated Router (ID) 0.0.0.3, Interface Address 10.1.23.3
  Backup Designated Router (ID) 0.0.0.2, Interface Address 10.1.23.2
  Multicast group memberships: OSPFAllRouters OSPFDesignatedRouters
  Timer intervals configured, Hello 10s, Dead 40s, Wait 40s, Retransmit 5
    Hello due in 1.144s
  Neighbor Count is 1, Adjacent neighbor count is 1
lo is up
  ifindex 1, MTU 16436 bytes, BW 0 Kbit &lt;UP,LOOPBACK,RUNNING>
  OSPF not enabled on this interface</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quel est le coût d'accès au pseudo service Internet
		(réseau <systemitem class='ipaddress'>10.1.3.0/29</systemitem>) après
		modification de la référence de calcul de métrique ? Justifier la
		valeur de métrique obtenue.</phrase></para>

		<para>À partir des informations de la base de données du démon
		<systemitem class='daemon'>ospfd</systemitem>, faire la somme des
		métriques de chaque lien entre les deux extrémités en
		communication.</para>
	</question>
	<answer>
		<para>Il est possible d'obtenir les informations de calcul de métrique
		soit à partir du démon de routage <acronym>OSPF</acronym> <systemitem
		class='daemon'>ospfd</systemitem>, soit à partir du démon de routage
		statique <systemitem class='daemon'>zebra</systemitem>.</para>

		<itemizedlist>
		<listitem>
			<para>Démon de routage <acronym>OSPF</acronym>:</para>

<screen><prompt>R2-ospfd#</prompt> sh ip ospf route 
============ OSPF network routing table ============
N    10.1.3.0/29           [<emphasis>110</emphasis>] area: 0.0.0.0
                           via 10.1.23.3, eth0.23
N    10.1.12.0/26          [10] area: 0.0.0.0
                           directly attached to eth0.12
N    10.1.13.0/26          [20] area: 0.0.0.0
                           via 10.1.12.1, eth0.12
                           via 10.1.23.3, eth0.23
N    10.1.23.0/26          [10] area: 0.0.0.0
                           directly attached to eth0.23

============ OSPF router routing table =============
R    0.0.0.1               [10] area: 0.0.0.0, ASBR
                           via 10.1.12.1, eth0.12

============ OSPF external routing table ===========
N E2 0.0.0.0/0             [10/10] tag: 0
                           via 10.1.12.1, eth0.12</screen>
		</listitem>
		<listitem>
			<para>Démon de routage statique :</para>

<screen><prompt>R2-zebra#</prompt> sh ip route
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, A - Babel,
       > - selected route, * - FIB route

O>* 0.0.0.0/0 [110/10] via 10.1.12.1, eth0.12, 23:49:36
O>* 10.1.3.0/29 [110/<emphasis>110</emphasis>] via 10.1.23.3, eth0.23, 00:13:23
O   10.1.12.0/26 [110/10] is directly connected, eth0.12, 00:09:46
C>* 10.1.12.0/26 is directly connected, eth0.12
O>* 10.1.13.0/26 [110/20] via 10.1.12.1, eth0.12, 00:09:00
  *                       via 10.1.23.3, eth0.23, 00:09:00
O   10.1.23.0/26 [110/10] is directly connected, eth0.23, 00:09:42
C>* 10.1.23.0/26 is directly connected, eth0.23
C>* 127.0.0.0/8 is directly connected, lo</screen>
		</listitem>
		</itemizedlist>

		<para>Prenons l'exemple de la métrique du réseau <systemitem
		class='ipaddress'>10.1.3.0/29</systemitem>. La valeur
		<option>110</option> correspond à la somme des coûts de deux liens : 1
		lien à 1Gbps
		(10<superscript>10</superscript>/10<superscript>9</superscript> = 10) +
		1 lien à 100Mbps
		(10<superscript>10</superscript>/10<superscript>8</superscript> = 100)
		= 110.</para>

		<para>Le lien à 1Gbps correspond à la liaison entre les routeurs
		<systemitem class='systemname'>R2</systemitem> et <systemitem
		class='systemname'>R3</systemitem>. Le lien à 100Mbps correspond à la
		liaison entre le routeur <systemitem class='systemname'>R3</systemitem>
		et son <link linkend='interco.ospf.dummies'>interface virtuelle
		<option>dummy0</option></link> sur laquelle le service Web est en
		écoute.</para>
	</answer>
	</qandaentry>
	</qandaset>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf.vm'>
	<title>Manipulations sur machines virtuelles</title>

	<para>Il est possible de réaliser l'ensemble des manipulations de ce
	support à l'aide de trois instances de machines virtuelles et du
	commutateur &url.ovs; présenté dans le guide &url.vm;.</para>

	<para>Voici quelques éléments sur la mise en œuvre de cette «infrastructure
	de travaux pratiques». Dans la figure ci-dessous, le routeur baptisé
	<citetitle>ISP</citetitle> correspond au système hôte sur lequel les
	systèmes virtuels sont exécutés.</para>

	<mediaobject>
	<imageobject role='fo'>
		<imagedata format='PNG' fileref='images/interco.ospf.vm.png' width='9cm' scalefit='1' />
	</imageobject>
	<imageobject role='html'>
		<imagedata format='PNG' fileref='images/interco.ospf.vm.png' width='480px' scalefit='1' />
	</imageobject>
	<textobject>
		<phrase>Topologie logique machines virtuelles</phrase>
	</textobject>
	</mediaobject>

	<sect2 xml:id='interco.ospf.vm.ovs'>
		<title>Préparation du commutateur Open vSwitch</title>

	<para>On se réfère au guide &url.vm; dans lequel le lancement du
	commutateur virtuel &url.ovs; est intégré à la configuration du système
	hôte. Voici un extrait du fichier
	<filename>/etc/network/interfaces</filename> relatif à la configuration du
	commutateur <systemitem>dsw-host</systemitem>.</para>

<screen><?dbfo keep-together="auto" ?><xi:include href='files/interfaces'
parse='text' xmlns:xi='http://www.w3.org/2001/XInclude'/></screen>

	<para>Dans cette configuration, <systemitem>vlan1</systemitem> est
	l'interface principale du système hôte. Elle sert à la fois au routage et à
	l'accès aux instances de machines virtuelles depuis les autres
	réseaux.</para>

	<para>La configuration de départ du commutateur sur le système hôte est la
	suivante :</para>

<screen>$ sudo ovs-vsctl show
0fb1e80b-37cf-4dce-9a19-17b9fb989610
    Bridge dsw-host
        Port "eth0"
            Interface "eth0"
        Port "vlan1"
            Interface "vlan1"
                type: internal
        Port dsw-host
            Interface dsw-host
                type: internal
    ovs_version: "2.3.0"</screen>

	<para>Partant de cette configuration de départ, on créé 3 cordons de
	brassage ; un par routeur. On dispose d'un script pour répéter les
	opérations de base.</para>

<screen><?dbfo keep-together="auto" ?><xi:include href='files/patchcables.sh'
parse='text' xmlns:xi='http://www.w3.org/2001/XInclude'/></screen>

	<para>Avec cet outil, la création des cordons s'effectue comme suit
	:</para>

<screen><prompt>$</prompt> sh ./patchcables.sh tap1 tap2 tap3</screen>

	<para>Maintenant que les cordons sont disponibles, il faut les brasser sur
	le commutateur <systemitem>dsw-host</systemitem>. L'opération ci-dessous
	créé trois nouveaux ports sur le commutateur.</para>

<screen><prompt>$</prompt> for port in tap1 tap2 tap3; do sudo ovs-vsctl add-port dsw-host $port; done</screen>

	<para>Pour respecter la topologie physique proposée dans l'énoncé, ces
	trois ports doivent être configurés en mode
	<wordasword>trunk</wordasword>de façon à ce que chaque routeur puisse
	router les <acronym>VLAN</acronym>s qui le concernent. Avec &url.ovs;, les
	paramètres de configuration sont les suivants :</para>

<screen><prompt>$</prompt> sudo ovs-vsctl set port tap1 vlan_mode=trunk trunks=0,12,13
<prompt>$</prompt> sudo ovs-vsctl set port tap2 vlan_mode=trunk trunks=12,23
<prompt>$</prompt> sudo ovs-vsctl set port tap3 vlan_mode=trunk trunks=13,23</screen>

	<note>
	<para>La particularité du commutateur &url.ovs; est d'utiliser le numéro 0
	comme <acronym>VLAN</acronym> par défaut. Dans notre cas, ce
	<acronym>VLAN</acronym> 0 devient le <acronym>VLAN</acronym> natif dans
	lequel circulent les trames sans étiquettes
	<acronym>IEEE802.1Q</acronym>.</para>
	</note>

	<para>On aboutit à la représentation graphique suivante :</para>

	<mediaobject>
	<imageobject role='fo'>
		<imagedata format='PNG' fileref='images/interco.ospf.ovs.png' width='9cm' scalefit='1' />
	</imageobject>
	<imageobject role='html'>
		<imagedata format='PNG' fileref='images/interco.ospf.ovs.png' width='480px' scalefit='1' />
	</imageobject>
	<textobject>
		<phrase>Brassage des machines virtuelles</phrase>
	</textobject>
	</mediaobject>

	<para>La table de correspondance entre <acronym>VLAN</acronym> et liaison
	devient :</para>

	<informaltable frame='all'>
	<tgroup cols='2'>
	<colspec colwidth='1*'/>
	<colspec colwidth='1*'/>
	<tbody>
	<row>
		<entry><acronym>VLAN</acronym> numéro 0</entry>
		<entry>Liaison R1 &lt;-> ISP</entry>
	</row>
	<row>
		<entry><acronym>VLAN</acronym> numéro 12</entry>
		<entry>Liaison R1 &lt;-> R2</entry>
	</row>
	<row>
		<entry><acronym>VLAN</acronym> numéro 13</entry>
		<entry>Liaison R1 &lt;-> R3</entry>
	</row>
	<row>
		<entry><acronym>VLAN</acronym> numéro 23</entry>
		<entry>Liaison R2 &lt;-> R3</entry>
	</row>
	</tbody>
	</tgroup>
	</informaltable>

	<para>Une fois que les opérations des sections suivantes auront été
	effectuées, la consultation de la table <acronym>CAM</acronym> du
	commutateur donnera les informations suivantes :</para>

<screen><prompt>$</prompt> sudo ovs-appctl fdb/show dsw-host
[sudo] password for latu: 
 port  VLAN  MAC                Age
   11    12  ba:ad:ca:fe:00:02   10
   12    23  ba:ad:ca:fe:00:03    9
   12    13  ba:ad:ca:fe:00:03    9
   10    13  ba:ad:ca:fe:0d:01    9
   10    12  ba:ad:ca:fe:0c:01    4
   11    23  ba:ad:ca:fe:00:02    1
    1     0  de:56:80:40:1d:ed    0
    2     0  42:d9:5d:6c:89:d8    0</screen>
	</sect2>

	<sect2 xml:id='interco.ospf.vm.rtr'>
		<title>Préparation des routeurs</title>

	<para>Sachant que l'on dispose d'une image <wordasword>master</wordasword>
	sur laquelle est installée un système Debian GNU/Linux de base, on créé 3
	images différentielles qui vont correspondre aux instances de routeurs.
	Voici un exemple de suite de commandes pour la mise en place des
	images.</para>

<screen><prompt>:~$</prompt> mkdir -p ~/vm/ospf
<prompt>:~$</prompt> cd vm
<prompt>:~/vm$</prompt> wget http://www.stri/vm/vm0-debian-testing-i386-base.qed
&lt;snipped/>
<prompt>:~/vm$</prompt> cd ospf
<prompt>:~/vm/ospf$</prompt> ../scripts/diff-img.sh ../vm0-debian-testing-i386-base.qed r1.qed
<prompt>:~/vm/ospf$</prompt> ../scripts/diff-img.sh ../vm0-debian-testing-i386-base.qed r2.qed
<prompt>:~/vm/ospf$</prompt> ../scripts/diff-img.sh ../vm0-debian-testing-i386-base.qed r3.qed</screen>

	<para>Le code du &url.vm.diff-img.sh; est fourni dans le guide
	&url.vm;.</para>

	<para>Ensuite, on créé un nouveau script <wordasword>shell</wordasword> de
	lancement des instances de «routeurs» dans lequel on fixe les paramètres
	d'initialisation de ces mêmes «routeurs».</para>

	<warning>
	<para>Ce script ne doit être lancé qu'après l'initialisation du commutateur
	virtuel pour que le brassage des routeurs sur les ports du commutateur
	puisse se faire correctement.</para>
	</warning>

<screen><prompt>$</prompt> cd ~/vm/ospf
<prompt>$</prompt> cat ospf-startup.sh 
#!/bin/bash

../scripts/ovs-startup.sh r1.qed 512 1

../scripts/ovs-startup.sh r2.qed 512 2

../scripts/ovs-startup.sh r3.qed 512 3</screen>
	</sect2>

	<sect2 xml:id='interco.ospf.vm.router-id'>
		<title>Choix des identifiants de routeur OSPF</title>

	<para>Pour toute instance du protocole de routage <acronym>OSPF</acronym>,
	le choix de l'identifiant se fait dans l'ordre suivant :</para>

	<orderedlist>
	<listitem>
		<para>Adresse <acronym>IPv4</acronym> définie à l'aide de l'instruction
		<command>router-id</command>.</para>
	</listitem>
	<listitem>
		<para>Adresse <acronym>IPv4</acronym> la plus élevée parmi toutes les
		interfaces de boucle locale</para>
	</listitem>
	<listitem>
		<para>Adresse <acronym>IPv4</acronym> la plus élevée parmi toutes les
		interfaces actives</para>
	</listitem>
	</orderedlist>

	<para>La liste de identifiants utilisés pour les trois routeurs qui servent
	à la rédaction des réponses types est la suivante.</para>

	<informaltable frame='all'>
	<tgroup cols='2'>
		<colspec colwidth='1*'/>
		<colspec colwidth='1*'/>
	<tbody>
	<row>
		<entry>R1</entry>
		<entry><systemitem class='ipaddress'>0.0.0.1</systemitem></entry>
	</row>
	<row>
		<entry>R2</entry>
		<entry><systemitem class='ipaddress'>0.0.0.2</systemitem></entry>
	</row>
	<row>
		<entry>R3</entry>
		<entry><systemitem class='ipaddress'>0.0.0.3</systemitem></entry>
	</row>
	</tbody>
	</tgroup>
	</informaltable>
	</sect2>

	<sect2 xml:id='interco.ospf.vm.static-route'>
		<title>Table de routage du système hôte</title>

	<para>Pour que les réseaux de l'aire <acronym>OSPF</acronym> puissent
	communiquer avec le système hôte et l'Internet, il est nécessaire de
	compléter la table de routage du système hôte. Dans ce contexte le système
	hôte joue le rôle d'un routeur central et la technique usuelle employée
	pour répondre au besoin d'interconnexion consiste à implanter une route
	statique avec un «super réseau» qui rassemble tous les réseaux de l'aire en
	une seule entrée.</para>

	<para>L'aire <acronym>OSPF</acronym> étudiée contient quatre réseaux
	:</para>

	<itemizedlist>
	<listitem>
		<para>10.1.3.0/29 - réseau fictif ajouté sur R3,</para>
	</listitem>
	<listitem>
		<para>10.1.12.0/26 - réseau correspondant au lien entre R1 et R2,</para>
	</listitem>
	<listitem>
		<para>10.1.13.0/26 - réseau correspondant au lien entre R1 et R3,</para>
	</listitem>
	<listitem>
		<para>10.1.23.0/26 - réseau correspondant au lien entre R2 et R3,</para>
	</listitem>
	</itemizedlist>

	<para>L'utilisation de l'outil <application>ipcalc</application> permet de
	vérifier qu'un masque de 19 bits permet d'englober ces quatre réseaux en
	une seule entrée.</para>

<screen><prompt>$</prompt> ipcalc 10.1.0.0/19
Address:   10.1.0.0             00001010.00000001.000 00000.00000000
Netmask:   255.255.224.0 = 19   11111111.11111111.111 00000.00000000
Wildcard:  0.0.31.255           00000000.00000000.000 11111.11111111
=>
Network:   10.1.0.0/19          00001010.00000001.000 00000.00000000
HostMin:   10.1.0.1             00001010.00000001.000 00000.00000001
HostMax:   10.1.31.254          00001010.00000001.000 11111.11111110
Broadcast: 10.1.31.255          00001010.00000001.000 11111.11111111
Hosts/Net: 8190                  Class A, Private Internet</screen>

	<para>On complète donc la table de routage du système hôte avec
	l'instruction suivante :</para>

<screen><prompt>$</prompt> sudo ip route add 10.1.0.0/19 via 192.0.2.10</screen>

	<para>Une fois cette nouvelle entrée de la table de routage du système hôte
	en place, on peut valider l'accessibilité des réseaux de l'aire en testant
	le service Web factice implanté sur le routeur R3 depuis le système
	hôte.</para>

<screen><prompt>$</prompt> wget -O /dev/null http://10.1.3.3
--2015-10-30 15:35:37--  http://10.1.3.3/
Connexion à 10.1.3.3:80… connecté.
requête HTTP transmise, en attente de la réponse… <emphasis>200 OK</emphasis>
Taille : 11104 (11K) [text/html]
Sauvegarde en : « /dev/null »</screen>

	<para>Le chargement de la page depuis le serveur web factice fonctionne
	bien !</para>
	</sect2>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf.refdocs'>
	<title>Documents de référence</title>

	<variablelist>
	<varlistentry xml:id='interco.ospf.refdocs.archi-tp'>
		<term><citetitle>Architecture réseau des travaux pratiques</citetitle></term>
	<listitem>
		<para>Le support &url.infra.tp;  présente la topologie physique des
		salles de travaux pratiques avec la &url.infra.tp.cabling; ainsi que
		les configurations par défaut des équipements. On y trouve aussi le
		plan d'adressage <acronym>IP</acronym> utilisé avec les autres supports
		de travaux pratiques, le plan de numérotations des
		<acronym>VLAN</acronym>s et les affectations des groupes de ports des
		commutateurs.</para>
	</listitem>
	</varlistentry>

	<varlistentry xml:id='interco.ospf.refdocs.config-interface-lan'>
		<term><citetitle>Configuration d'une interface réseau</citetitle></term>
	<listitem>
		<para>Le support &url.config.interface.lan; présente les opérations de
		configuration d'une interface réseau et propose quelques
		manipulations sur les protocoles de la pile
		<acronym>TCP/IP</acronym></para>
	</listitem>
	</varlistentry>

	<varlistentry xml:id='interco.ospf.refdocs.guide-routage-statique'>
		<term><citetitle>Initiation au routage, 1ère partie</citetitle></term>
	<listitem>
		<para>L'article &url.zebra.static; introduit l'utilisation de
		<application>quagga</application> et de son premier démon baptisé
		<systemitem class='daemon'>zebra</systemitem>. Ce démon permet de
		mettre en place un <emphasis>routage statique</emphasis> associé à la
		table de routage définie dans la configuration du système.</para>
	</listitem>
	</varlistentry>

	<varlistentry xml:id='interco.ospf.refdocs.guide-routage-ospf'>
		<term><citetitle>Initiation au routage, 3ème partie</citetitle></term>
	<listitem>
		<para>L'article &url.zebra.ospf; introduit l'utilisation du protocole
		<acronym>OSPF</acronym> sur plusieurs aires. Ce n'est pas l'objectif de
		ce support qui se limite au routage dynamique dans un système autonome
		unique ; donc une aire unique.</para>
	</listitem>
	</varlistentry>

	<varlistentry xml:id='interco.ospf.refdocs.inter-vlan'>
		<term><citetitle>Introduction au routage inter-VLAN</citetitle></term>
	<listitem>
		<para>Le support &url.inter-vlan-routing; introduit le principe du
		routage inter-VLAN ainsi que ses conditions d'utilisation. C'est aussi
		un support de travaux pratiques dans lequel on n'utilise que du routage
		statique et de la traduction d'adresses sources
		(<acronym>S-NAT</acronym>) pour acheminer le trafic utilisateur entre
		les différents réseaux.</para>
	</listitem>
	</varlistentry>

	<varlistentry xml:id='interco.ospf.refdocs.cisco-ospf'>
		<term><citetitle>Open Shortest Path First (OSPF)</citetitle></term>
	<listitem>
		<para>La page consacrée au protocole sur le site
		<trademark>Cisco</trademark> : &url.cisco-ospf; regroupe des ressources
		importantes sur la conception d'architecture réseau utilisant ce
		protocole.</para>

		<para>On peut aussi citer les supports de formation <citetitle>Cisco
		Networking Academy</citetitle> qui sont d'une grande qualité sur
		l'initiation à l'utilisation des protocoles de routage.
		Malheureusement, ce ne sont pas des documents libres
		d'utilisation.</para>
	</listitem>
	</varlistentry>

	<varlistentry xml:id='interco.ospf.refdocs.vm'>
		<term><citetitle>Virtualisation système et enseignement</citetitle></term>
	<listitem>
		<para>Le support &url.vm; présente la solution de virtualisation
		intégrée au noyau Linux : <acronym>KVM</acronym>. Associée au
		commutateur &url.ovs;, cette solution permet de construire des
		maquettes de travaux pratiques très complètes en offrant de nombreuses
		fonctions réseau «réelles» dont une table &url.cam;.</para>
	</listitem>
	</varlistentry>
	</variablelist>
</sect1>
</article>
