<?xml version='1.0'?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V5.0//EN"
        "/usr/share/xml/docbook/schema/dtd/5.0/docbook.dtd"[

<!ENTITY phl   	     	   	SYSTEM "author.xml">
<!ENTITY legal 			SYSTEM "legal.xml">

<!ENTITY segmentation.avant	SYSTEM "files/segmentation.avant.txt">
<!ENTITY segmentation.apres	SYSTEM "files/segmentation.apres.txt">
<!ENTITY topologie		SYSTEM "files/topologie.txt">
<!ENTITY access.active		SYSTEM "files/access.active.txt">

<!ENTITY % inetdoc_urls SYSTEM 'inetdoc.urls.xml'>
%inetdoc_urls;

<!ENTITY url.isl.dot1q
  '<link xmlns="http://docbook.org/ns/docbook" xlink:href="http://www.cisco.com/en/US/tech/tk389/tk689/technologies_tech_note09186a0080094665.shtml">
  <citetitle>InterSwitch Link and IEEE 802.1Q Frame Format</citetitle></link>'>

<!ENTITY url.ieee802.1q.standard
  '<link xmlns="http://docbook.org/ns/docbook" xlink:href="http://standards.ieee.org/getieee802/download/802.1Q-1998.pdf">
  <citetitle>IEEE 802.1Q Standard</citetitle></link>'>

<!ENTITY url.cisco.simple.config
  '<link xmlns="http://docbook.org/ns/docbook" xlink:href="http://www.cisco.com/en/US/tech/tk389/tk815/technologies_configuration_example09186a00800949fd.shtml">
  <citetitle>Configuring InterVLAN Routing and ISL/802.1Q Trunking</citetitle></link>'>

<!ENTITY url.cisco.how_lan_swicthes_work
  '<link xmlns="http://docbook.org/ns/docbook" xlink:href="http://www.cisco.com/en/US/tech/tk389/tk689/technologies_tech_note09186a00800a7af3.shtml">
  <citetitle>How LAN Switches Work</citetitle></link>'>
]>

<article xml:lang='fr' xml:id='inter-vlan.routing.'>
<info>
  <title>Introduction au routage inter-VLAN</title>
  &phl;
  <abstract>
    <para>Le routage inter-VLAN sur les systèmes GNU/Linux présente de nombreux
    intérêts tant du point de vue conception que du point de vue exploitation.
    Avec un système GNU/Linux on peut combiner les fonctions de cloisonnement
    des domaines de diffusion avec un bon niveau de sécurité basé le filtrage
    réseau <citetitle>netfilter/iptables</citetitle>. De plus, sur une
    infrastructure hétérogène associant plusieurs générations et|ou marques de
    commutateurs, GNU/Linux permet d'homogénéiser l'exploitation.</para>
  </abstract>
  <keywordset>
    <keyword>access</keyword>
    <keyword>8021q</keyword>
    <keyword>arp</keyword>
    <keyword>dot1q</keyword>
    <keyword>eth0</keyword>
    <keyword>ifconfig</keyword>
    <keyword>iptables</keyword>
    <keyword>route</keyword>
    <keyword>routing</keyword>
    <keyword>sysctl</keyword>
    <keyword>vconfig</keyword>
    <keyword>vlan</keyword>
    <keyword>trunk</keyword>
  </keywordset>
</info>

<sect1 xml:id='inter-vlan.routing.meta'>
  &legal;
  <sect2 xml:id='inter-vlan.routing.meta.file'>
    <title>Méta-information</title>
    
  <para>Cet article est écrit avec <link
  xlink:href="http://www.docbook.org"><citetitle>DocBook</citetitle></link> XML
  sur un système <link xlink:href="http://www.debian.org"><citetitle>Debian
  GNU/Linux</citetitle></link>. Il est disponible en version imprimable au
  format PDF : <link
  xlink:href="http://www.inetdoc.net/pdf/__printbasename__"><literal>__printbasename__</literal></link>.</para>

  <para>Les commandes utilisées dans ce document ne sont pas spécifiques à une
  version particulière des systèmes UNIX ou GNU/Linux. C'est la distribution
  <citetitle>Debian GNU/Linux</citetitle> qui est utilisée pour les tests
  présentés. Voici une liste des paquets contenant les
  commandes :</para>
  <itemizedlist>
    <listitem>
    <para><application>vlan</application> - user mode programs to enable VLANs on your ethernet devices</para>
    </listitem>
    <listitem>
    <para><application>iptables</application> - administration tools for packet filtering and NAT</para>
    </listitem>
    <listitem>
    <para><application>net-tools</application> - The NET-3 networking toolkit</para>
    </listitem>
    <listitem>
    <para><application>ifupdown</application> - High level tools to configure network interfaces</para>
    </listitem>
    </itemizedlist>
  </sect2>

  <sect2 xml:id='inter-vlan.routing.meta.convtypo'>
    <title>Conventions typographiques</title>

  <para>Tous les exemples d'exécution des commandes sont précédés d'une invite
  utilisateur ou <wordasword>prompt</wordasword> spécifique au niveau des
  droits utilisateurs nécessaires sur le système.</para>

  <itemizedlist>
    <listitem>
    <para>Toute commande précédée de l'invite <prompt>$</prompt> ne nécessite
    aucun privilège particulier et peut être utilisée au niveau utilisateur
    simple.</para>
    </listitem>
    <listitem>
    <para>Toute commande précédée de l'invite <prompt>#</prompt> nécessite les
    privilèges du super-utilisateur.</para>
    </listitem>
  </itemizedlist>
  </sect2>
</sect1>

<sect1 xml:id='inter-vlan.routing.intro.vlan'>
  <title>Réseaux locaux virtuels : VLANs</title>

  <sect2 xml:id='inter-vlan.routing.intro.vlan.definitions'>
    <title>Définitions</title>
  <para>Généralement, un réseau local (<acronym>LAN</acronym>) est défini par
  un domaine de diffusion. Tous les hôtes d'un réseau local reçoivent les
  messages de diffusion émis par n'importe quel autre hôte de ce réseau. Par
  définition, un réseau local est délimité par des équipements fonctionnant au
  niveau 3 du modèle OSI : la couche réseau.</para>

  <para>Un réseau local virtuel (<acronym>VLAN</acronym>) est un réseau local
  (<acronym>LAN</acronym>) distribué sur des équipements fonctionnant au niveau
  2 du modèle OSI : la couche liaison. À priori, il n'est donc plus
  nécessaire d'avoir recours à un équipement de niveau 3 pour «borner» le
  réseau local. Cette formulation bute sur une fonction difficile à
  contourner : l'interconnexion des réseaux locaux. Dès que l'on a besoin
  de communiquer entre domaines de diffusion, il est absolument nécessaire de
  passer par les fonctions de routage du niveau réseau du modèle OSI.</para>

  <para>Le réseau local est distribué sur différents équipements via des
  liaisons dédiées appelées <wordasword>trunks</wordasword>. Un
  <wordasword>trunk</wordasword> est une connexion physique unique sur laquelle
  on transmet le trafic de plusieurs réseaux virtuels. Les trames qui
  traversent le <wordasword>trunk</wordasword> sont complétées avec un
  identificateur de réseau local virtuel (<acronym>VLAN id</acronym>). Grâce à
  cette identification, les trames sont conservées dans un même
  <acronym>VLAN</acronym> (ou domaine de diffusion).</para>

  <para>Les <wordasword>trunks</wordasword> peuvent être utilisés :</para>

  <variablelist>
    <varlistentry xml:id='trunk.sw2sw'>
      <term>entre deux commutateurs</term>
      <listitem>
      <para>C'est le mode de distribution des réseaux locaux le plus
      courant.</para>
      </listitem>
    </varlistentry>
    <varlistentry xml:id='trunk.sw2host'>
      <term>entre un commutateur et un hôte</term>
      <listitem>
      <para>C'est le mode de fonctionnement à surveiller étroitement. Un hôte
      qui supporte le <wordasword>trunking</wordasword>  a la possibilité
      d'analyser le trafic de tous les réseaux locaux virtuels.</para>
    </listitem>
    </varlistentry>
    <varlistentry xml:id='trunk.sw2router'>
      <term>entre un commutateur et un routeur</term>
      <listitem>
      <para>C'est le mode fonctionnement qui permet d'accéder aux fonctions de
      routage ; donc à l'interconnexion des réseaux virtuels par routage
      inter-VLAN. La mise en œuvre de ce type de routage est l'objet de ce
      document.</para>
    </listitem>
    </varlistentry>
  </variablelist>

  <para>Enfin, il ne faut pas oublier que tous les <acronym>VLANs</acronym>
  véhiculés dans le même <wordasword>trunk</wordasword> partagent la bande
  passante du média utilisé. Si un <wordasword>trunk</wordasword> utilise un
  lien 100Mbps Full-Duplex, la bande passante de tous les
  <acronym>VLANs</acronym> associés est limitée à ces 100Mbps
  Full-Duplex.</para>
  </sect2>

  <sect2 xml:id='inter-vlan.routing.intro.vlan.standards'>
    <title>Réseaux locaux virtuels standards</title>

  <para>Il existe plusieurs mécanismes de gestion des <acronym>VLANs</acronym>.
  Beaucoup sont propriétaires et ne fonctionnent que sur les équipements d'une
  seule marque.</para>

  <variablelist>
    <varlistentry xml:id='port.vlan'>
      <term><acronym>VLANs</acronym> par ports</term>
      <listitem>
      <para>Cette technique fournit une méthode de division d'un équipement de
      niveau 2 (un commutateur) en plusieurs domaines de diffusion. La
      réalisation de cette division est spécifique à chaque plateforme.</para>
      
      <para>Le coût d'administration de ce genre de réseaux locaux est très
      important puisqu'il faut gérer manuellement sur chaque équipement la
      distribution des réseaux locaux.</para>

      <para>Ceci dit, cette technique ne dépend pas d'une gestion propriétaire
      de l'affectation des ports dans les différents <acronym>VLANs</acronym>.
      C'est la raison principale pour laquelle elle est très répandue. Le
      commutateur assure une isolation complète entre la station et le
      <acronym>VLAN</acronym> auquel elle appartient.</para>
      </listitem>
    </varlistentry>
    <varlistentry xml:id='isl.vlan'>
      <term><acronym>VLANs</acronym> du type Cisco Inter-Switch Link</term>
      <term><acronym>ISL</acronym> <acronym>VLANs</acronym></term>
      <listitem>
      <para>Cette technique a été développée spécifiquement pour les
      équipements <trademark>Cisco</trademark>. Elle complète les en-têtes de
      trames avec 30 octets répartis en 13 champs. Ce type d'encapsulation
      n'est plus beaucoup utilisé du fait de son incompatibilité avec le
      standard <acronym>IEEE 802.1Q</acronym>.</para>
      </listitem>
    </varlistentry>
    <varlistentry xml:id='dot1q.vlan'>
      <term><acronym>VLANs</acronym> IEEE 802.1Q</term>
      <listitem>
      <para>Le standard IEEE 802.1Q fournit un mécanisme d'encapsulation
      très répandu et implanté dans de nombreux équipements de marques
      différentes. C'est sur ce standard que s'appuie ce document. Comme dans
      le cas de l'encapsulation <acronym>ISL</acronym> précédente, l'en-tête de
      trame est complété par une balise de 4 octets.</para>
      </listitem>
    </varlistentry>
  </variablelist>
  </sect2>

<?custom-pagebreak?>
  <sect2 xml:id='inter-vlan.routing.intro.vlan.dot1q'>
    <title>Balise IEEE 802.1Q</title>

  <para>Le standard IEEE 802.1Q définit le contenu de la balise de VLAN
  (<wordasword>VLAN tag</wordasword>) avec laquelle on complète l'en-tête de
  trame Ethernet. Le format de la trame Ethernet modifiée avec les 4 octets
  supplémentaires est présenté ci-dessous :</para>
<screen width='80'>+--------------+--------------+------------+---------------------+-----+
| adresse dst. | adresse src. | long./type | données ...         | FCS |
+--------------+--------------+------------+---------------------+-----+
                              |\
                              | \__________
                              |            \
+--------------+--------------+-------+-----+------------+---------------------+-----+
| adresse dst. | adresse src. | Etype | Tag | long./type | données ...         | FCS |
+--------------+--------------+-------+-----+------------+---------------------+-----+
                                     /       \
                                 ___/         \___
                                /                 \
                               +---+-+----+--------+
                               |pri| |    |vlan id |
                               +---+-+----+--------+</screen>

  <para>Il faut noter que le champ <literal>FCS</literal> est recalculé après
  l'insertion de la balise de <acronym>VLAN</acronym>.</para>

  <para>Voici un extrait de capture, réalisée avec
  <application>Wireshark</application>, qui illustre les champs de la balise
  <acronym>IEEE 802.1Q</acronym>.</para>

  <note xml:id='ieee8021q.tshark'>
  <para>Pour ne capturer que les trames avec balise
  <acronym>IEEE 802.1Q</acronym>, voici la syntaxe de filtrage à
  priori :
  <userinput># tshark -i eth0 -w sample.cap vlan</userinput>.</para>
  </note>
  
<screen width='80'>Frame 103 (1518 bytes on wire, 1518 bytes captured)
Ethernet II, Src: 00:14:f2:75:ed:72, Dst: 00:10:5a:de:9d:d7
    Destination: 3com_de:9d:d7 (00:10:5a:de:9d:d7)
    Source: Cisco_75:ed:72 (00:14:f2:75:ed:72)
    Type: 802.1Q Virtual LAN (0x8100) <co xml:id='ieee8021q.tpid'/>
802.1Q Virtual LAN
    000. .... .... .... = Priority: 0 <co xml:id='ieee8021q.prio'/>
    ...0 .... .... .... = CFI: 0      <co xml:id='ieee8021q.cfi'/>
    .... 0000 0110 0100 = ID: 100     <co xml:id='ieee8021q.vid'/>
    Type: IP (0x0800)
Internet Protocol, Src: 172.17.0.2 (172.17.0.2), Dst: 172.16.80.19 (172.16.80.19)
Transmission Control Protocol, Src Port: www (80), Dst Port: 1548 (1548)
</screen>

  <calloutlist>
    <callout arearefs='ieee8021q.tpid'>
    <variablelist>
      <varlistentry>
        <term><citetitle>Tag protocol identifier</citetitle></term>
        <term>TPID</term>
        <term>EtherType</term>
        <listitem>
	<para>Ce champ de 16 bits identifie le protocole véhiculé dans la
	trame. La valeur <literal>0x8100</literal> désigne une balise
	<acronym>IEEE 802.1Q / 802.1P</acronym>.</para>
        </listitem>
      </varlistentry>
    </variablelist>
    </callout>
    <callout arearefs='ieee8021q.prio'>
    <variablelist>
      <varlistentry>
        <term><citetitle>Priority</citetitle></term>
        <listitem>
	<para>Ce champ de 3 bits fait référence au standard
	<acronym>IEEE 802.1P</acronym>. Sur 3 bits on peut coder 8 niveaux
	de priorités de 0 à 7. La notion de priorité dans les
	<acronym>VLANs</acronym> est sans rapport avec les mécanismes de
	priorité <acronym>IP</acronym> au niveau réseau. Ces 8 niveaux sont
	utilisés pour fixer une priorité aux trames d'un
	<acronym>VLAN</acronym> relativement aux autres
	<acronym>VLANs</acronym>.</para>
        </listitem>
      </varlistentry>
    </variablelist>
    </callout>
    <callout arearefs='ieee8021q.cfi'>
    <variablelist>
      <varlistentry>
        <term><citetitle>Canonical Format Identifier</citetitle></term>
        <listitem>
	<para>Ce champ codé sur 1 bit assure la compatibilité entre les
	adresses MAC Ethernet et Token Ring. Un commutateur Ethernet fixera
	toujours cette valeur à 0. Si un port Ethernet reçoit une valeur 1 pour
	ce champ, alors la trame ne sera pas propagée puisqu'elle est destinée
	à un port «sans balise» (<wordasword>untagged
	port</wordasword>).</para>
        </listitem>
      </varlistentry>
    </variablelist>
    </callout>
    <callout arearefs='ieee8021q.vid'>
    <variablelist>
      <varlistentry>
        <term><citetitle>VLAN Identifier</citetitle></term>
        <term>vlan id</term>
        <term>VID</term>
        <listitem>
	<para>Ce champ de 12 bits sert à identifier le réseau local virtuel
	auquel appartient la trame. Il est possible de coder 4094
	(<literal>2^12-2</literal>) réseaux virtuels (<acronym>VLAN</acronym>s)
	avec ce champ.</para>
        </listitem>
    </varlistentry>
    </variablelist>
    </callout>
  </calloutlist>
  </sect2>
</sect1>

<sect1 xml:id='inter-vlan.routing.intro.routage'>
  <title>Routage inter-VLAN</title>

  <para>A partir de l'argumentation développée dans l'article <xref
  linkend='inter-vlan.routing.segmentation.lan'/>, on dispose de deux règles de
  base. Sans aucune programmation particulière des équipements :</para>

  <itemizedlist>
    <listitem>
    <para>Une interface de <emphasis>commutateur</emphasis> délimite un domaine
    de <emphasis>collision</emphasis>.</para>
    </listitem>
    <listitem>
    <para>Une interface de <emphasis>routeur</emphasis> délimite un domaine de
    <emphasis>diffusion</emphasis>.</para>
    </listitem>
  </itemizedlist>

  <sect2 xml:id='inter-vlan.routing.intro.routage.avant'>
    <title>Situation avant routage inter-VLAN</title>
  <para>Du point de vue conception, le respect de ces deux règles impose que
  l'on ajoute une interface de routeur pour chaque nouveau domaine de diffusion
  ou périmètre de contrôle. De plus, les commutateurs appartenant à un domaine
  de diffusion sont dédiés à ce domaine. Il n'est pas possible de distribuer
  plusieurs réseaux locaux virtuels entre plusieurs domaines de diffusion
  «isolés» par un routeur.</para>
  
<screen width='80'>&segmentation.avant;
</screen>

  <para>Remarques sur ce type de conception :</para>

  <itemizedlist>
    <listitem>
    <para>Si on programme le commutateur A avec 2 VLANs distincts pour chacun
    des PCs <literal>A1</literal> et <literal>A2</literal>, alors toute
    communication entre <literal>A1</literal> et <literal>A2</literal> sera
    impossible. De plus, ces deux PCs ne pourront communiquer avec d'autres
    réseaux que si l'interface du routeur <literal>RA</literal> appartient aux
    deux VLANs programmés.</para>

    <para>Cette situation peut présenter des avantages du point de vue
    exploitation mais elle dépend beaucoup de la gestion des interfaces
    physiques. Ce que ne montre pas le diagramme simplifié ci-dessus, c'est que
    le coût d'administration devient très important dès que le nombre de
    réseaux virtuels augmente.</para>
    </listitem>
    <listitem>
    <para>Si l'utilisateur «associé» au PC <literal>A1</literal> déménage dans
    un lieu ou seul le domaine de diffusion B est distribué, il est nécessaire
    d'étendre le domaine de diffusion A jusqu'à ce nouveau lieu. En
    conséquence, il faudra installer un nouveau commutateur et câbler de
    nouvelles prises entre le point de brassage principal du domaine A et ce
    lieu.</para>
    
    <para>Sur une même infrastructure, on se retrouve rapidement avec des
    commutateurs saturés pour lesquels tous les ports disponibles sont utilisés
    et d'autres commutateurs pour lesquels seuls quelques ports sont
    utilisés.</para>

    <para>Ce scénario montre qu'il est excessivement difficile d'optimiser le
    parc des ports de commutateurs avec ce type d'architecture. Le coût de
    l'infrastructure augmente donc fortement puisqu'il faut passer par des
    réinvestissements lourds en câblage et en équipements à chaque modification
    des périmètres.</para>
    </listitem>
  </itemizedlist>
  </sect2>

  <sect2 xml:id='inter-vlan.routing.intro.routage.apres'>
    <title>Situation après routage inter-VLAN</title>
  <para>Les deux règles de base énoncées ci-dessus ne sont pas remises en
  question. Il s'agit maintenant de dissocier les notions d'interface physique
  et d'interface de routage. On n'associe plus une interface physique à chaque
  domaine de diffusion mais une interface «virtuelle» (encore du
  virtuel !).</para>
  
<screen width='80'>&segmentation.apres;
</screen>

  <para>Remarques sur ce type de conception relativement à la situation sans
  routage inter-VLAN :</para>

  <itemizedlist>
    <listitem>
    <para>Le contrôle d'accès est centralisé au niveau du routeur. Il n'existe
    plus de «mélange des genres» entre la programmation des commutateurs et le
    contrôle d'accès au niveau réseau. Les communications entre les hôtes d'un
    même domaine de diffusion ou entre plusieurs domaines de diffusion sont
    gérées de la même façon.</para>

    <para>On obtient donc de véritables réseaux locaux distribués sur la
    totalité de l'infrastructure (équipements de niveau 2 + équipements de
    niveau 3).</para>
    </listitem>
    <listitem>
    <para>La gestion du parc des ports de commutation est optimisée. Comme les
    domaines de diffusion sont partagés entre tous les équipements, la gestion
    des évolutions est beaucoup plus souple. Les déménagements n'entraînent
    aucun recâblage tant que le nombre d'utilisateurs ne change pas. Il est
    donc possible de <emphasis>concentrer</emphasis> l'administration sur un
    nombre d'équipements plus faible que dans une architecture sans routage
    inter-VLAN.</para>
    </listitem>
  </itemizedlist>
  </sect2>

  <sect2 xml:id='inter-vlan.routing.intro.routage.debits'>
    <title>Augmentation des débits</title>
  <para>Si les avantages liés aux facilités d'exploitation ne suffisaient pas,
  l'augmentation des débits favorise un peu plus l'adoption d'architectures à
  base de routage inter-VLAN. Les évolutions techniques des routeurs conduisent
  à diminuer le nombre de leurs interfaces alors que les évolutions des
  commutateurs conduisent à augmenter considérablement le nombre de leurs
  ports.</para>

  <para>En reprenant la remarque sur le partage des débits entre les VLANs à
  l'intérieur des <wordasword>trunks</wordasword> (voir <xref
  linkend='inter-vlan.routing.intro.vlan.definitions'/>), il devient
  intéressant de partager le débit disponible «en fond de panier» dans les
  châssis de commutateurs. Le critère de choix d'un équipement, commutateur ou
  routeur, s'articule de plus en plus autour du rapport :</para>
<screen width='80'>   capacité de commutation en millions de paquets par seconde (mpps)
   -----------------------------------------------------------------
                                prix
</screen>

   <para>Ce que l'on appelle commutateur de niveau 3 correspond le plus souvent
   à un module de routage matériel ou logiciel inséré dans un commutateur
   classique de niveau 2. Si on reprend le diagramme ci-dessus avec ce genre
   d'équipement, il ne faudrait plus qu'un seul châssis en lieu et place du
   routeur et des deux commutateurs. La répartition des rôles resterait
   inchangée.</para>
  </sect2>
</sect1>

<sect1 xml:id='inter-vlan.routing.typical'>
  <title>Etude d'une configuration type</title>

  <para>La configuration type étudiée ici correspond à un scénario classique
  d'exploitation d'une infrastructure de taille moyenne. Pour les besoin des
  l'illustration, on n'utilise qu'un équipement de chaque type : un
  routeur et un commutateur.</para>

  <para>Le routeur unique correspond bien à la réalité des réseaux modernes. Du
  réseau d'agence d'une centaine d'hôtes au réseau de campus de plusieurs
  milliers d'hôtes, seule la capacité de traitement de l'équipement varie (voir
  <xref linkend='inter-vlan.routing.intro.routage.debits'/>).</para>

  <para>Le commutateur unique correspond beaucoup moins à la réalité. Même dans
  un réseau d'agence, on dépasse très vite le cap des 48 ports connectés. On
  utilise alors un équipement avec une bonne capacité de commutation qui assure
  la <emphasis>distribution</emphasis> vers des commutateurs dédiés aux
  <emphasis>accès</emphasis> des hôtes. Tout ces commutateurs sont reliés entre
  eux à l'aide de <emphasis>trunks</emphasis> qui véhiculent les flux marqués
  des réseaux virtuels. Voir <xref
  linkend='inter-vlan.routing.intro.vlan.definitions'/>.</para>
  
  <para>Dans l'illustration présentée ici, les deux couches
  <emphasis>distribution</emphasis> et <emphasis>accès</emphasis> sont
  «synthétisées» sur un seul équipement. Un <wordasword>trunk</wordasword> sur
  un lien gigabit relie le routeur au commutateur. En véhiculant les flux
  marqués entre le routeur et le commutateur il assure la liaison entre routage
  et commutation. Les hôtes directement connectés au commutateur n'ont aucune
  connaissance des trames IEEE 802.1Q (voir <xref
  linkend='inter-vlan.routing.intro.vlan.dot1q'/>). Ils ne nécessitent donc
  aucune configuration particulière.</para>

<screen width='80'>        __         Routeur
    ___/  \_      GNU/Linux 
  _/        \__     .---.     gi0/1 fa0/4       fa0/23
 /             \eth1| ==|eth0   _|___|_____ / /__|sw1
| Internet      |___| ==|_     |_=_=_=_=_=_/ /_=_=_=_|
\_           __/    |  -| `-O----'   |    / /    |
  \__     __/       |   |  trunk     |           |périmètre
     \___/         -------           |           |accès
                        .------------'           |
                        | périmètre              |.....
                  .__.  | services              .------,~
           serveur| .|,-'                       |client|'
               Web| =|                          |      ||
                  |  |                          \------ /
                 ------                          ======/

</screen>

  <para>Cette infrastructure type comprend 2 périmètres (ou réseaux privés)
  reliés au réseau public Internet. Un périmètre de services utilisé pour
  l'hébergement des services accessibles depuis le réseau public : DNS,
  Web, courrier électronique, etc. et un périmètre pour les postes de travail
  qui doivent être inaccessibles depuis le réseau public.</para>

  <para>On ajoute aux deux périmètres classiques, un réseau particulier dédié à
  la gestion de l'infrastructure : configuration des équipements,
  métrologie, journalisation, etc.</para>
  
  <table xml:id='sample.perimeter.addressing' frame='all' pgwide='1'>
    <title>Plan d'adressage des périmètres</title>
    <tgroup cols='3'>
    <colspec colnum='1' colwidth='1*'/>
    <colspec colnum='2' colwidth='1*'/>
    <colspec colnum='3' colwidth='3*'/>
    <thead>
      <row>
        <entry>Nom</entry>
	<entry>n° VLAN</entry>
	<entry>Adresse IP</entry>
      </row>
    </thead>
    <tbody>
      <row>
        <entry><citetitle>Management</citetitle></entry>
	<entry>2</entry>
	<entry><systemitem
	class='ipaddress'>192.168.2.0/24</systemitem></entry>
      </row>
      <row>
        <entry><citetitle>Services</citetitle></entry>
	<entry>100</entry>
	<entry><systemitem
	class='ipaddress'>192.168.100.0/24</systemitem></entry>
      </row>
      <row>
        <entry><citetitle>Accès</citetitle></entry>
	<entry>200</entry>
	<entry><systemitem
	class='ipaddress'>192.168.200.0/24</systemitem></entry>
      </row>
    </tbody>
    </tgroup>
  </table>

  <para>Le tableau ci-dessus établit la correspondance entre les périmètres,
  les réseaux virtuels et les réseaux <acronym>IP</acronym> à
  interconnecter.</para>

  <sect2 xml:id='inter-vlan.routing.typical.management'>
    <title>Configuration du <wordasword>trunk</wordasword></title>
    <subtitle>Communications réseau dans le périmètre
    <emphasis>Management</emphasis></subtitle>

  <para>Du point de vue configuration, ce réseau est très particulier. Il
  véhicule les trames sans balises IEEE 802.1Q entre le routeur et le
  commutateur. On associe à ce périmètre le <acronym>VLAN</acronym>
  <emphasis>natif</emphasis> du <wordasword>trunk</wordasword>.</para>
  
  <para>Côté routeur GNU/Linux, on configure l'interface de façon classique
  puisqu'il s'agit de traiter des trames Ethernet «normales».</para>

<screen width='80'># ifconfig eth0 192.168.2.2 broadcast 192.168.2.255 netmask 255.255.255.0
</screen>

  <para>Côté commutateur, on utilise la notion de VLAN «natif» pour configurer
  le <wordasword>trunk</wordasword>.</para>

<screen width='80'>!
interface GigabitEthernet0/1
 switchport trunk native vlan 2
 switchport mode trunk
 no cdp enable

&lt;snipped/>
!
interface Vlan2
 ip address 192.168.2.1 255.255.255.0
 no ip redirects
 no ip unreachables
 no ip proxy-arp
 no ip route-cache
</screen>

  <para>La configuration du <wordasword>trunk</wordasword> est la
  suivante :</para>

<screen width='80'>#sh int gi0/1 trunk

Port        Mode         Encapsulation  Status        Native vlan
Gi0/1       on           802.1q         trunking      2

Port      Vlans allowed on trunk
Gi0/1       1-4094

Port        Vlans allowed and active in management domain
Gi0/1       1-2,100,200

Port        Vlans in spanning tree forwarding state and not pruned
Gi0/1       1-2,100,200
</screen>

  <para>Les règles d'utilisation des trames sans balises IEEE 802.1Q sont
  les suivantes :</para>

  <itemizedlist>
    <listitem>
    <para>Toute trame appartenant au VLAN natif du
    <wordasword>trunk</wordasword> est émise sans balise IEEE 802.1Q par
    le commutateur.</para>
    </listitem>
    <listitem>
    <para>Toute trame reçue sans balise IEEE 802.1Q par le commutateur
    appartient au VLAN natif.</para>
    </listitem>
  </itemizedlist>

  <para>On complétera la configuration du commutateur de façon à ce que toutes
  les opérations de gestion de l'équipement passent par ce VLAN natif.</para>

  <para>À ce niveau, les tests de communication réseau sont d'une grande
  trivialité !</para>

  <itemizedlist>
    <listitem>
    <para>Côté routeur :</para>
<screen width='80'>RouterA:~$ ping -c 2 192.168.2.1
PING 192.168.2.1 (192.168.2.1) 56(84) bytes of data.
64 bytes from 192.168.2.1: icmp_seq=1 ttl=255 time=19.4 ms
64 bytes from 192.168.2.1: icmp_seq=2 ttl=255 time=1.22 ms

--- 192.168.2.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 1.226/10.355/19.484/9.129 ms
</screen>
    </listitem>
    <listitem>
    <para>Côté commutateur :</para>
<screen width='80'>Switch#ping 192.168.2.2

Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 192.168.2.2, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 1/1/4 ms
</screen>
    </listitem>
  </itemizedlist>
  </sect2>

  <sect2 xml:id='inter-vlan.routing.typical.tagged'>
    <title>Configuration IEEE 802.1Q sur le Routeur GNU/Linux</title>
    <subtitle>Communications réseau dans les périmètres
    <emphasis>Services</emphasis> et <emphasis>Accès</emphasis></subtitle>

  <para>Cette fois-ci, il est indispensable de traiter les flux marqués avec
  les balises IEEE 802.1Q.</para>

  <para>Côté routeur GNU/Linux, il faut s'assurer que le noyau à la capacité à
  traiter les balises IEEE 802.1Q. Tous les noyaux de distributions tels
  que ceux fournis par <citetitle>Debian</citetitle> ont un module
  IEEE 802.1Q appelé <systemitem>8021q</systemitem>.</para>

<screen width='80'># find /lib/modules/`uname -r` -name 8021q
/lib/modules/2.6.12-rc5/kernel/net/8021q
# modprobe 8021q
</screen>

  <para>Le résultat du chargement du module se retrouve dans les messages système :</para>

<screen width='80'># dmesg
&lt;snipped/>
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com>
All bugs added by David S. Miller &lt;davem@redhat.com>
</screen>

  <para>Avec un noyau récent, ce module est chargé automatiquement lors d'une
  opération de configuration sur un <acronym>VLAN</acronym>.</para>

  <para>Une fois la partie <wordasword>kernelspace</wordasword> traitée, on
  passe logiquement à la partie <wordasword>userspace</wordasword> : les
  outils de configuration utilisateur avec le paquet
  <citetitle>Debian</citetitle> <systemitem>vlan</systemitem>.</para>

<screen width='80'># dpkg -l vlan
Souhait=inconnU/Installé/suppRimé/Purgé/H=à garder
| État=Non/Installé/fichier-Config/dépaqUeté/échec-conFig/H=semi-installé
|/ Err?=(aucune)/H=à garder/besoin Réinstallation/X=les deux (État,Err: maj=mauvais)
||/ Nom      Version    Description
+++-========-==========-===========================================================
ii  vlan     1.9-3      User mode programs to enable VLANs on your ethernet devices
</screen>

  <para>Tous les outils sont en place ; il ne reste plus qu'à configurer
  les 2 <acronym>VLAN</acronym>s correspondant aux 2 périmètres définis.</para>

<screen width='80'># vconfig add eth0 100
Added VLAN with VID == 100 to IF -:eth0:-
# vconfig add eth0 200
Added VLAN with VID == 200 to IF -:eth0:-
</screen>

  <para>Ces 2 opérations ont ajouté 2 sous-interfaces à l'interface physique
  <systemitem>eth0</systemitem>. On visualise le résultat avec la commande
  «historique» <command>ifconfig</command> (et|ou) la commande
  <command>ip</command> :</para>

<screen width='80'># ifconfig -a
eth0      Lien encap:Ethernet  HWaddr 00:0C:6E:B7:09:46
          inet adr:192.168.2.2  Bcast:192.168.2.255  Masque:255.255.255.0
          adr inet6: fe80::20c:6eff:feb7:946/64 Scope:Lien
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:24 errors:0 dropped:0 overruns:0 frame:0
          TX packets:35 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 lg file transmission:1000
          RX bytes:2456 (2.3 KiB)  TX bytes:3180 (3.1 KiB)
          Interruption:185

eth0.100  Lien encap:Ethernet  HWaddr 00:0C:6E:B7:09:46
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 lg file transmission:0
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)

eth0.200  Lien encap:Ethernet  HWaddr 00:0C:6E:B7:09:46
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 lg file transmission:0
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)
</screen>

<screen width='80'># ip addr ls
2: eth0: &lt;BROADCAST,MULTICAST,UP> mtu 1500 qdisc pfifo_fast qlen 1000
    link/ether 00:0c:6e:b7:09:46 brd ff:ff:ff:ff:ff:ff
    inet 192.168.2.2/24 brd 192.168.2.255 scope global eth0
    inet6 fe80::20c:6eff:feb7:946/64 scope link
    valid_lft forever preferred_lft forever
7: eth0.100: &lt;BROADCAST,MULTICAST> mtu 1500 qdisc noop
    link/ether 00:0c:6e:b7:09:46 brd ff:ff:ff:ff:ff:ff
8: eth0.200: &lt;BROADCAST,MULTICAST> mtu 1500 qdisc noop
    link/ether 00:0c:6e:b7:09:46 brd ff:ff:ff:ff:ff:ff
</screen>

  <para>Les 2 nouvelles sous-interfaces se configurent manuellement de façon
  classique.</para>

<screen width='80'># ifconfig eth0.100 192.168.100.1 broadcast 192.168.100.255 netmask 255.255.255.0
# ifconfig eth0.200 192.168.200.1 broadcast 192.168.200.255 netmask 255.255.255.0
</screen>

  <para>Sur un système <citetitle>Debian GNU/Linux</citetitle>, il est possible
  de rendre cette configuration permanente en éditant le fichier
  <filename>/etc/network/interfaces</filename> comme suit :</para>

<screen width='80'>&lt;snipped/>
auto eth0
iface eth0 inet static
        address 192.168.2.2
        netmask 255.255.255.0
        broadcast 192.168.2.255

auto eth0.100
iface eth0.100 inet static
        address 192.168.100.1
        netmask 255.255.255.0
        broadcast 192.168.100.255

auto eth0.200
iface eth0.200 inet static
        address 192.168.200.1
        netmask 255.255.255.0
        broadcast 192.168.200.255
</screen>

  <para>Une fois la configuration des interfaces en place, on obtient la table
  de routage suivante :</para>

<screen width='80'># route -n
Table de routage IP du noyau
Destination     Passerelle      Genmask         Indic Metric Ref    Use Iface
192.168.100.0   0.0.0.0         255.255.255.0   U     0      0        0 eth0.100<co xml:id='eth0.100'/>
192.168.2.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0<co xml:id='eth0'/>
aaa.bbb.ccc.0   0.0.0.0         255.255.255.0   U     0      0        0 eth1<co xml:id='eth1'/>
192.168.200.0   0.0.0.0         255.255.255.0   U     0      0        0 eth0.200<co xml:id='eth0.200'/>
0.0.0.0         aaa.bbb.ccc.1   0.0.0.0         UG<co xml:id='eth1.gw'/>    0      0        0 eth1
</screen>

<screen width='80'># ip route ls
192.168.100.0/24 dev eth0.100  proto kernel  scope link  src 192.168.100.1
192.168.2.0/24 dev eth0  proto kernel  scope link  src 192.168.2.2
aaa.bbb.ccc.0/24 dev eth1  proto kernel  scope link  src aaa.bbb.ccc.7
192.168.200.0/24 dev eth0.200  proto kernel  scope link  src 192.168.200.1
default via aaa.bbb.ccc.1 dev eth1
</screen>

  <calloutlist>
    <callout arearefs='eth0.100'>
    <para>L'interface <systemitem>eth0.100</systemitem> est associée au VLAN
    numéro 100. Sa configuration réseau correspond au périmètre
    <emphasis>Services</emphasis>. Les trames de ce réseau qui circulent sur le
    <wordasword>trunk</wordasword> sont complétées avec une balise
    IEEE 802.1Q comprenant l'identificateur de VLAN 100.</para>
    </callout>
    <callout arearefs='eth0'>
    <para>L'interface <systemitem>eth0</systemitem> sert de
    <wordasword>trunk</wordasword> entre le routeur et le commutateur. Sa
    configuration réseau correspond au périmètre
    <emphasis>Management</emphasis>. Le réseau auquel appartient l'interface
    utilise des trames <emphasis>sans balises IEEE 802.1Q</emphasis>. Dans
    le vocabulaire <trademark>Cisco</trademark>, ce <acronym>VLAN</acronym> est
    qualifié de «natif».</para>
    </callout>
    <callout arearefs='eth1'>
    <para>L'interface <systemitem>eth1</systemitem> est directement connectée
    au réseau «public». Elle n'a aucune connaissance du trafic issu des
    différents périmètres sans configuration spécifique.</para>
    </callout>
    <callout arearefs='eth0.200'>
    <para>L'interface <systemitem>eth0.200</systemitem> est associée au VLAN
    numéro 200. Sa configuration réseau correspond au périmètre
    <emphasis>Accès</emphasis>. Les trames de ce réseau qui circulent sur le
    <wordasword>trunk</wordasword> sont complétées avec une balise
    IEEE 802.1Q comprenant l'identificateur de VLAN 200.</para>
    </callout>
    <callout arearefs='eth1.gw'>
    <para>L'interface <systemitem>eth1</systemitem> a la possibilité
    d'acheminer le trafic issu du Routeur GNU/Linux vers l'Internet via une
    passerelle par défaut.</para>
    </callout>
  </calloutlist>

  <para>Côté commutateur, il faut que la base de données des
  <acronym>VLAN</acronym>s connus contienne les mêmes identificateurs que ceux
  affectés sur le Routeur GNU/Linux.</para>

  <para>Le fichier de configuration du commutateur doit contenir les
  informations suivantes :</para>

<screen width='80'>vlan 2
 name management
!
vlan 100
 name services
!
vlan 200
 name access
</screen>

  <para>Ensuite, on affecte les ports du commutateurs aux différents
  <acronym>VLAN</acronym>s ou périmètres.</para>

<screen width='80'>Switch#conf t
Enter configuration commands, one per line.  End with CNTL/Z.
Switch(config)#int range fastEthernet 0/1 - 12
Switch(config-if-range)#switchport access vlan 100
Switch(config-if-range)#exit
Switch(config)#int range fastEthernet 0/13 - 48
Switch(config-if-range)#switchport access vlan 200
Switch(config-if)#^Z
Switch#
07:10:45: %SYS-5-CONFIG_I: Configured from console by console</screen>


  <para>On visualise le résultat des affectations de ports en mode accès de la
  façon suivante.</para>

<screen width='80'>Switch#sh vlan

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active
2    management                       active
100  services                         active    Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                                Fa0/5, Fa0/6, Fa0/7, Fa0/8
                                                Fa0/9, Fa0/10, Fa0/11, Fa0/12
200  access                           active    Fa0/13, Fa0/14, Fa0/15, Fa0/16
                                                Fa0/17, Fa0/18, Fa0/19, Fa0/20
                                                Fa0/21, Fa0/22, Fa0/23, Fa0/24
                                                Fa0/25, Fa0/26, Fa0/27, Fa0/28
                                                Fa0/29, Fa0/30, Fa0/31, Fa0/32
                                                Fa0/33, Fa0/34, Fa0/35, Fa0/36
                                                Fa0/37, Fa0/38, Fa0/39, Fa0/40
                                                Fa0/41, Fa0/42, Fa0/43, Fa0/44
                                                Fa0/45, Fa0/46, Fa0/47, Fa0/48
</screen>
  </sect2>

  <sect2 xml:id='inter-vlan.routing.typical.routing'>
    <title>Activation de la fonction routage</title>

  <para>Avec la configuration actuelle, le Routeur GNU/Linux ne remplit pas sa
  fonction. Par exemple, les hôtes du périmètre <emphasis>Accès</emphasis> ne
  peuvent pas communiquer avec les serveurs du périmètre
  <emphasis>Services</emphasis>. Il est nécessaire d'activer la fonction
  routage au niveau du noyau Linux pour que les paquets <acronym>IP</acronym>
  puissent être transmis (ou routés) entre des réseaux différents.</para>

  <para>La présentation des fonctions réseau d'une interface pilotée par le
  noyau Linux sort du cadre de ce document. Il faut consulter le support <xref
  linkend='inter-vlan.routing.config.interface.lan'/> pour obtenir les informations
  nécessaires.</para>

  <para>Voici une copie du fichier <filename>/etc/sysctl.conf</filename>
  comprenant l'ensemble des réglages appliqués au noyau Linux du Routeur de la
  configuration type. Pour appliquer ces paramètres, il suffit d'utiliser la
  commande <userinput>sysctl -p</userinput> et de valider la valeur de la
  «clé» <option>ip_forward</option>. Si cette valeur est à <option>1</option>,
  le routage est actif au niveau du noyau Linux.</para>

<screen width='80'># /etc/sysctl.conf - Configuration file for setting system variables
# See sysctl.conf (5) for information.
#
# Refuser la prise en charge des requêtes ARP pour d'autres hôtes
net.ipv4.conf.all.proxy_arp = 0

# Ignorer les mauvais messages d'erreurs ICMP
net.ipv4.icmp_ignore_bogus_error_responses = 1

# Ignorer les messages de diffusion ICMP
net.ipv4.icmp_echo_ignore_broadcasts = 1

# Journaliser les adresses sources falsifiées ou non routables
net.ipv4.conf.all.log_martians = 1

# Refuser les adresses sources falsifiées ou non routables
net.ipv4.conf.all.rp_filter = 1

# Refuser les messages ICMP redirect
net.ipv4.conf.all.accept_redirects = 0

net.ipv4.conf.all.send_redirects = 0

# Refuser le routage source
net.ipv4.conf.all.accept_source_route = 0

# Activer le routage
net.ipv4.ip_forward = 1
</screen>

  <para>Les tests de communications entre les réseaux des différents périmètres
  peuvent être effectués depuis le commutateur.</para>

<screen width='80'>Switch#ping 192.168.2.2<co xml:id='ping.management'/>

Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 192.168.2.2, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 1/1/4 ms
Switch#ping 192.168.100.1<co xml:id='ping.services'/>

Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 192.168.100.1, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 1/202/1000 ms
Switch#ping 192.168.200.1<co xml:id='ping.acces'/>

Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 192.168.200.1, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 1/1/1 ms
Switch#ping aaa.bbb.ccc.7<co xml:id='ping.public'/>

Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to aaa.bbb.ccc.7, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 1/202/1004 ms
Switch#ping aaa.bbb.ccc.1<co xml:id='ping.internet'/>

Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to aaa.bbb.ccc.1, timeout is 2 seconds:
.....
Success rate is 0 percent (0/5)
</screen>
  <calloutlist>
    <callout arearefs='ping.management'>
    <para>Test de communication <acronym>ICMP</acronym> sur le périmètre
    <emphasis>Management</emphasis>. Ce test n'utilise pas la fonction routage
    puisqu'il est effectué entre les 2 extrémités du
    <wordasword>trunk</wordasword>.</para>
    </callout>
    <callout arearefs='ping.services'>
    <para>Test de communication <acronym>ICMP</acronym> sur le périmètre
    <emphasis>Services</emphasis>. Ce test utilise la fonction routage entre le
    réseau <systemitem class='ipaddress'>192.168.2.0/24</systemitem> et le
    réseau <systemitem class='ipaddress'>192.168.100.0/24</systemitem>.</para>
    </callout>
    <callout arearefs='ping.acces'>
    <para>Test de communication <acronym>ICMP</acronym> sur le périmètre
    <emphasis>Accès</emphasis>. Ce test utilise la fonction routage entre le
    réseau <systemitem class='ipaddress'>192.168.2.0/24</systemitem> et le
    réseau <systemitem class='ipaddress'>192.168.200.0/24</systemitem>.</para>
    </callout>
    <callout arearefs='ping.public'>
    <para>Test de communication <acronym>ICMP</acronym> vers le réseau public.
    Ce test utilise la fonction routage entre le réseau <systemitem
    class='ipaddress'>192.168.2.0/24</systemitem> et le réseau <systemitem
    class='ipaddress'>aaa.bbb.ccc.0/24</systemitem>.</para>
    </callout>
    <callout arearefs='ping.internet'>
    <para>Test de communication <acronym>ICMP</acronym> vers l'Internet. Ce
    test échoue puisque le Routeur GNU/Linux n'échange pas sa table de routage
    avec les autres routeurs de l'Internet.</para>
    </callout>
  </calloutlist>

  <para>Ces tests montrent qu'il faut compléter la configuration pour que les
  échanges réseau entre les périmètres et l'Internet soient possibles. Comme
  ces échanges réseau entre l'Internet et les périmètres ne peuvent pas se
  faire dans n'importe quelles conditions, il est nécessaire d'introduire la
  fonction de filtrage pour obtenir une interconnexion satisfaisante.</para>
  </sect2>
</sect1>

<sect1 xml:id='inter-vlan.routing.netfilter'>
  <title>Interconnexion et filtrage réseau</title>

  <para>L'étude du filtrage réseau avec le noyau Linux sort du cadre de ce
  document. Il faut consulter les versions françaises du <xref
  linkend='inter-vlan.routing.packet.filtering.howto'/> et du <xref
  linkend='inter-vlan.routing.nat-howto'/> pour obtenir les informations
  nécessaires.</para>

  <para>D'un point de vue général, on dispose de deux solutions distinctes pour
  interconnecter les périmètres réseau administrés avec l'Internet.</para>

  <itemizedlist>
    <listitem>
    <para>Partager la table de routage des périmètres administrés avec les
    routeurs de l'Internet via un protocole de routage tel
    qu'<acronym>OSPF</acronym>. Consulter le guide <xref
    linkend='inter-vlan.routing.zebra.ospf'/> pour obtenir des exemples
    complets d'exploitation du protocole de routage <acronym>OSPF</acronym>
    avec les services du logiciel GNU/Linux
    <application>Quagga</application>.</para>
    </listitem>
    <listitem>
    <para>Camoufler les périmètres administrés derrière une adresse
    <acronym>IP</acronym> publique accessible depuis l'Internet. Cette
    opération est réalisée avec les fonctions de filtrage réseau du noyau
    Linux :
    <application>netfilter</application> pour la partie
    <wordasword>kernelspace</wordasword> et <application>iptables</application>
    pour la partie <wordasword>userspace</wordasword>.</para>
    </listitem>
  </itemizedlist>

  <para>C'est la seconde proposition qui offre le plus de facilités de contrôle
  immédiat sur les flux réseau. L'outil de camouflage
  (<wordasword>masquerading</wordasword>) généralement utilisé est appelé
  traduction d'adresses (<wordasword>Native Address Translation</wordasword> ou
  <acronym>NAT</acronym>).</para>

  <sect2 xml:id='inter-vlan.routing.netfilter.light'>
    <title>Fonctionnement minimal</title>

  <para>Après avoir activé le routage au niveau noyau (voir <xref
  linkend='inter-vlan.routing.typical.routing'/>), la fontion de camouflage est
  simple à mettre en oeuvre :</para>

<screen width='80'># iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE
</screen>

  <para>Cette règle réalise une traduction d'adresse source. Tout paquet
  <acronym>IP</acronym> sortant par l'interface <systemitem>eth1</systemitem>
  voit son adresse <acronym>IP</acronym> source réécrite avec l'adresse
  <acronym>IP</acronym> de l'interface.</para>

  <para>L'exécution de la règle entraîne le chargement des modules de gestion
  de la traduction d'adresses et du suivi dynamique de communication
  (<wordasword>stateful inspection</wordasword>).</para>

<screen width='80'># dmesg |grep ip_
ip_tables: (C) 2000-2002 Netfilter core team
ip_conntrack version 2.1 (4095 buckets, 32760 max) - 248 bytes per conntrack
</screen>

<screen width='80'># lsmod |grep ip
iptable_filter          3200  0
ipt_MASQUERADE          3712  1
iptable_nat            23516  2 ipt_MASQUERADE
ip_conntrack           44728  2 ipt_MASQUERADE,iptable_nat
ip_tables              22528  3 iptable_filter,ipt_MASQUERADE,iptable_nat
ipv6                  255936  12
</screen>

  <para>Le suivi dynamique de communication consiste à conserver une empreinte
  de paquet sortant de façon à identifier les paquets retour relatifs à cette
  «demande». Les empreintes sont stockées dans la table
  <filename>/proc/net/ip_conntrack</filename> du système de fichiers virtuel du
  noyau Linux.</para>

<screen width='80'># cat /proc/net/ip_conntrack
tcp<co xml:id='conntrack.proto1'/>     6 431999 ESTABLISHED<co xml:id='conntrack.state1'/> src=192.168.200.2<co xml:id='conntrack.src1'/> dst=192.168.200.1<co xml:id='conntrack.dst1'/> \
         sport=33450 dport=22<co xml:id='conntrack.ssh'/> packets=417 bytes=31133 \
         src=192.168.200.1 dst=192.168.200.2 \
         sport=22 dport=33450 packets=306 bytes=111969 [ASSURED] mark=0 use=1
tcp      6 431999 ESTABLISHED src=192.168.200.2<co xml:id='conntrack.src2'/> dst=64.236.34.4<co xml:id='conntrack.dst2'/> \
         sport=33449 dport=80<co xml:id='conntrack.http'/> packets=7075 bytes=368009 \
         src=64.236.34.4 dst=aaa.bbb.ccc.7<co xml:id='conntrack.public'/> \
         sport=80 dport=33449 packets=9219 bytes=12839148 [ASSURED] mark=0 use=1
</screen>

  <calloutlist>
    <callout arearefs='conntrack.proto1'>
    <para>Protocole de transport utilisé.</para>
    </callout>
    <callout arearefs='conntrack.state1'>
    <para>État de la connexion <acronym>TCP</acronym>.</para>
    </callout>
    <callout arearefs='conntrack.src1 conntrack.src2'>
    <para>Adresse <acronym>IP</acronym> source. Cette adresse correspond à un
    poste client appartenant au périmètre <emphasis>Accès</emphasis>.</para>
    </callout>
    <callout arearefs='conntrack.dst1 conntrack.dst2'>
    <para>Adresses <acronym>IP</acronym> destination. Dans le premier cas, la
    communication est interne au réseau du périmètre
    <emphasis>Accès</emphasis>. Dans le second cas, il s'agit d'une adresse sur
    l'Internet.</para>
    </callout>
    <callout arearefs='conntrack.ssh conntrack.http'>
    <para>À partir du port destination du paquet sortant on peut identifier le
    service Internet utilisé : <acronym>SSH</acronym> et
    <acronym>HTTP</acronym>. Plus loin sur la même ligne, on retrouve les
    adresses <acronym>IP</acronym> source et destination attendues.</para>
    </callout>
    <callout arearefs='conntrack.public'>
    <para>L'adresse <acronym>IP</acronym> destination attendue pour un paquet
    retour est l'adresse publique du Routeur GNU/Linux. Cette ligne montre bien
    que le routeur à la connaissance des réseaux internes et du réseau public.
    C'est à partir de ces correspondances d'adresses <acronym>IP</acronym> que
    les décision d'acheminement sont prises. Dans le cas de la traduction
    d'adresses par camouflage, l'adresse <acronym>IP</acronym> retour est
    réécrite avec l'adresse <acronym>IP</acronym> de l'hôte du périmètre
    <emphasis>Accès</emphasis>.</para>
    </callout>
  </calloutlist>

  <para>Si cette configuration a le mérite d'illustrer le fonctionnement du
  routage inter-VLAN de façon simple, elle ne correspond pas à un niveau de
  contrôle d'accès suffisant. L'objet de la section suivante est justement de
  chercher à augmenter ce niveau de contrôle.</para>
  </sect2>
  
  <sect2 xml:id='inter-vlan.routing.netfilter.midrange'>
    <title>Meilleur contrôle d'accès</title>

  <para>Dans un premier temps, il faut garantir que tous les paquets
  <acronym>IP</acronym> non autorisés sont bloqués ; ce qui revient à appliquer
  la règle <emphasis>«tout ce qui n'est pas autorisé est
  interdit»</emphasis>.</para>

  <para>La traduction de cette règle en termes de configuration revient à jeter
  tous les nouveaux paquets par défaut sur les «chaînes» d'entrée et de
  traversée des interfaces réseau</para>

<screen width='80'># iptables -P INPUT DROP
# iptables -P FORWARD DROP
</screen>

  <para>En toute rigueur, il faudrait faire de même avec la chaîne de
  sortie  <option>OUTPUT</option>. Cette présentation ayant pour but
  premier d'illustrer les concepts, ajouter les traitements de la chaîne
  <option>OUTPUT</option> ne ferait qu'alourdir les scripts sans apporter
  d'élément nouveau.</para>

  <para>Dans un deuxième temps, il faut affiner la configuration du suivi de
  communication dynamique. La règle d'or du filtrage avec la fonction
  <wordasword>stateful inspection</wordasword>, c'est <emphasis>la description
  la plus fine possible du premier paquet qu'on autorise à
  passer</emphasis>.</para>

  <para>La traduction de cette règle en termes de configuration contient 2
  parties :</para>

  <itemizedlist>
    <listitem>
    <para>Un bloc de règles qui organise le suivi de communication pour chaque
    chaîne sur laquelle on appliqué la politique par défaut
    <option>DROP</option>.</para>

<screen width='80'>-A &lt;CHAINE> -p udp -m state --state RELATED,ESTABLISHED -j ACCEPT
-A &lt;CHAINE> -p tcp -m state --state ESTABLISHED -m tcp ! --syn -j ACCEPT
-A &lt;CHAINE> -p tcp -m state --state RELATED -m tcp --syn -j ACCEPT
-A &lt;CHAINE> -p icmp -m state --state ESTABLISHED -j ACCEPT
</screen>
    </listitem>
    <listitem>
    <para>Des règles spécifiques à chaque flux autorisé. C'est à la rédaction
    de ces règles qui correspondent au premier paquet autorisé qu'il faut
    apporter le plus grand soin. Un exemple pour les paquets
    <acronym>IP</acronym> émis depuis le périmètre
    <emphasis>Accès</emphasis> sur la chaîne
    <option>FORWARD</option> :</para>

<screen width='80'>-A FORWARD -i eth0.200 -s 192.168.200.0/24 \
   -p tcp -m tcp --syn --sport 1024: -m state --state NEW -j ACCEPT
-A FORWARD -i eth0.200 -s 192.168.200.0/24 \
   -p udp -m udp --sport 1024: -m state --state NEW -j ACCEPT
-A FORWARD -i eth0.200 -s 192.168.200.0/24 \
   -p icmp --icmp-type echo-request -m state --state NEW -j ACCEPT
</screen>
    </listitem>
  </itemizedlist>

  <para>Voici une version intermédiaire de script de configuration du filtrage
  pour le périmètre <emphasis>Accès</emphasis>. En supposant que le fichier des
  règles est stocké dans le répertoire <filename
  class='directory'>/var/lib/iptables/</filename>, on active les règles avec
  une commande du type <userinput>iptables-restore
  &lt;/var/lib/iptables/active</userinput>.</para>
<screen width='90'>&access.active;
</screen>
  </sect2>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='inter-vlan.routing.tp'>
  <title>Travaux pratiques</title>

  <sect2 xml:id='inter-vlan.routing.tp.topo'>
    <title>Topologie type de travaux pratiques</title>

<screen width='80'>&topologie;
</screen>

  <para>Pour les besoins de ces travaux pratiques, les configurations des 4
  commutateurs : <systemitem
  class='systemname'>sw5.infra.stri</systemitem>, <systemitem
  class='systemname'>sw6.infra.stri</systemitem>, <systemitem
  class='systemname'>sw7.infra.stri</systemitem> et <systemitem
  class='systemname'>sw8.infra.stri</systemitem> sont effacées ainsi que leurs
  bases de données de <acronym>VLAN</acronym>s.</para>

  <para>Comme indiqué dans la topologie type ci-dessus, trois postes de travaux
  pratiques sont associés à un commutateur. Un poste joue le rôle de routeur
  inter-VLAN et les deux autres sont des postes clients appartenant chacun à un
  <acronym>VLAN</acronym> ou réseau <acronym>IP</acronym> différent.</para>

  <para>Le seul point de configuration imposé est le raccordement au réseau
  d'interconnexion avec le routeur principal de la salle de travaux pratiques.
  Ce raccordement utilise le port <systemitem>fa0/24</systemitem> de chaque
  commutateur qui doit être configuré en mode <wordasword>trunk</wordasword> en
  utilisant le <acronym>VLAN</acronym> natif numéro 3. Le réseau
  <acronym>IP</acronym> correspondant au <acronym>VLAN</acronym> numéro 3 a
  l'adresse : <systemitem
  class='ipaddress'>172.16.0.0/20</systemitem></para>

  <para>Point important, la lecture de la section «Plan d'adressage» du
  document &url.archi.tp; donne les adresses des deux routeurs ayant accès au
  réseau de Campus.</para>

  <itemizedlist>
    <listitem>
    <para>Routeur <systemitem
    class='systemname'>casper.infra.stri</systemitem> : <systemitem
    class='ipaddress'>172.16.0.2/20</systemitem></para>
    </listitem>
    <listitem>
    <para>Routeur <systemitem
    class='systemname'>cooper.infra.stri</systemitem> : <systemitem
    class='ipaddress'>172.16.0.4/20</systemitem></para>
    </listitem>
  </itemizedlist>
  </sect2>
  
  <sect2 xml:id='inter-vlan.routing.tp.addr'>
    <title>Affectation des postes de travail</title>

  <para>Les affectations données dans la table ci-dessous ne sont pas figées
  pour la durée des travaux pratiques. Une fois la configuration validée sur un
  groupe de trois postes, il est vivement conseillé de permuter les rôles de
  façon à mieux maîtriser les étapes de configuration.</para>

  <table xml:id='lab.addressing' frame='all' pgwide='1'>
    <title>Affectation des rôles, des numéros de VLANs et des adresses
    IP</title>
    <tgroup cols='6' align='left' colsep='1' rowsep='1'>
    <colspec colnum='1' colwidth='1*'/>
    <colspec colnum='2' colwidth='3*'/>
    <colspec colnum='3' colwidth='1*'/>
    <colspec colnum='4' colwidth='1*'/>
    <colspec colnum='5' colwidth='2*'/>
    <colspec colnum='6' colwidth='3*'/>
    <thead>
      <row>
      <entry>Groupe</entry>
      <entry>Commutateur</entry>
      <entry>Poste</entry>
      <entry>Rôle</entry>
      <entry>VLAN</entry>
      <entry>Réseau</entry>
      </row>
    </thead>
    <tbody>
      <row>
      <entry morerows='4' valign='middle'>1</entry>
      <entry morerows='4' valign='middle'><systemitem class='systemname'>sw5.infra.stri</systemitem></entry>
      <entry>alderaan</entry>
      <entry>client</entry>
      <entry>300</entry>
      <entry><systemitem class='ipaddress'>192.168.1.2/25</systemitem></entry>
      </row>
      <row>
      <entry>bespin</entry>
      <entry>client</entry>
      <entry>301</entry>
      <entry><systemitem class='ipaddress'>192.168.1.130/25</systemitem></entry>
      </row>
      <row>
      <entry morerows='2' valign='middle'>centares</entry>
      <entry morerows='2' valign='middle'>routeur</entry>
      <entry>3</entry>
      <entry><systemitem class='ipaddress'>172.16.0.30/20</systemitem></entry>
      </row>
      <row>
      <entry>300</entry>
      <entry><systemitem class='ipaddress'>192.168.1.1/25</systemitem></entry>
      </row>
      <row>
      <entry>301</entry>
      <entry><systemitem class='ipaddress'>192.168.1.129/25</systemitem></entry>
      </row>
      <row>
      <entry morerows='4' valign='middle'>2</entry>
      <entry morerows='4' valign='middle'><systemitem class='systemname'>sw6.infra.stri</systemitem></entry>
      <entry>coruscant</entry>
      <entry>client</entry>
      <entry>302</entry>
      <entry><systemitem class='ipaddress'>192.168.2.2/25</systemitem></entry>
      </row>
      <row>
      <entry>dagobah</entry>
      <entry>client</entry>
      <entry>303</entry>
      <entry><systemitem class='ipaddress'>192.168.2.130/25</systemitem></entry>
      </row>
      <row>
      <entry morerows='2' valign='middle'>endor</entry>
      <entry morerows='2' valign='middle'>routeur</entry>
      <entry>3</entry>
      <entry><systemitem class='ipaddress'>172.16.0.32/20</systemitem></entry>
      </row>
      <row>
      <entry>302</entry>
      <entry><systemitem class='ipaddress'>192.168.2.1/25</systemitem></entry>
      </row>
      <row>
      <entry>303</entry>
      <entry><systemitem class='ipaddress'>192.168.2.129/25</systemitem></entry>
      </row>
      <row>
      <entry morerows='4' valign='middle'>3</entry>
      <entry morerows='4' valign='middle'><systemitem class='systemname'>sw7.infra.stri</systemitem></entry>
      <entry>felucia</entry>
      <entry>client</entry>
      <entry>304</entry>
      <entry><systemitem class='ipaddress'>192.168.3.2/25</systemitem></entry>
      </row>
      <row>
      <entry>geonosis</entry>
      <entry>client</entry>
      <entry>305</entry>
      <entry><systemitem class='ipaddress'>192.168.3.130/25</systemitem></entry>
      </row>
      <row>
      <entry morerows='2' valign='middle'>hoth</entry>
      <entry morerows='2' valign='middle'>routeur</entry>
      <entry>3</entry>
      <entry><systemitem class='ipaddress'>172.16.0.34/20</systemitem></entry>
      </row>
      <row>
      <entry>304</entry>
      <entry><systemitem class='ipaddress'>192.168.3.1/25</systemitem></entry>
      </row>
      <row>
      <entry>305</entry>
      <entry><systemitem class='ipaddress'>192.168.3.129/25</systemitem></entry>
      </row>
      <row>
      <entry morerows='4' valign='middle'>4</entry>
      <entry morerows='4' valign='middle'><systemitem class='systemname'>sw8.infra.stri</systemitem></entry>
      <entry>mustafar</entry>
      <entry>client</entry>
      <entry>306</entry>
      <entry><systemitem class='ipaddress'>192.168.4.2/25</systemitem></entry>
      </row>
      <row>
      <entry>naboo</entry>
      <entry>client</entry>
      <entry>307</entry>
      <entry><systemitem class='ipaddress'>192.168.4.130/25</systemitem></entry>
      </row>
      <row>
      <entry morerows='2' valign='middle'>tatooine</entry>
      <entry morerows='2' valign='middle'>routeur</entry>
      <entry>3</entry>
      <entry><systemitem class='ipaddress'>172.16.0.36/20</systemitem></entry>
      </row>
      <row>
      <entry>306</entry>
      <entry><systemitem class='ipaddress'>192.168.4.1/25</systemitem></entry>
      </row>
      <row>
      <entry>307</entry>
      <entry><systemitem class='ipaddress'>192.168.4.129/25</systemitem></entry>
      </row>
    </tbody>
    </tgroup>
  </table>

  <para>Le positionnement des 4 commutateurs est référencé dans le support
  <xref linkend='inter-vlan.routing.archi.tp'/>.</para>
  </sect2>

  <sect2 xml:id='inter-vlan.routing.tp.pcs'>
    <title>Configuration des postes de travaux pratiques</title>

  <qandaset defaultlabel='number'>
    <qandaentry>
      <question>
	<para>Dans un groupe de trois postes tel qu'il a été défini ci-dessus,
	quel(s) poste(s) nécessite(nt) une configuration spécifique pour
	l'utilisation des réseaux locaux virtuels ?</para>
      </question>
    </qandaentry>

    <qandaentry>
      <question>
	<para>Toujours dans un groupe de trois postes, comment doivent être
	programmés les ports de commutateur sur lesquels les postes clients
	sont raccordés ?</para>
      </question>
    </qandaentry>

    <qandaentry>
      <question>
	<para>Encore dans un groupe de trois postes, comment doivent être
	programmés les ports de commutateur sur lesquels les routeurs	sont
	raccordés ?</para>
      </question>
    </qandaentry>

    <qandaentry>
      <question>
	<para>Dans la configuration d'un <wordasword>trunk</wordasword>,
	qu'est-ce qui distingue un <acronym>VLAN</acronym> natif ?</para>
      </question>
    </qandaentry>

    <qandaentry>
      <question>
	<para>À partir du tableau des affectations ci-dessus, pourquoi les
	trois postes d'un groupe ne peuvent-ils pas appartenir au même réseau
	<acronym>IP</acronym> ?</para>
      </question>
    </qandaentry>

    <qandaentry>
      <question>
	<para>Quel type de poste reçoit les trames complétées par des balises
	<acronym>IEEE 802.1Q</acronym> ?</para>
      </question>
    </qandaentry>
  </qandaset>

  <para>Une fois le plan d'adressage <acronym>IP</acronym> défini, reprendre la
  <xref linkend='inter-vlan.routing.typical'/> pour le groupe de postes de
  travaux pratiques.</para>

  <qandaset defaultlabel='number'>
    <qandaentry>
      <question>
	<para>Quel est le paquet qui contient les outils de configuration des
	interfaces réseau correspondant à chaque <acronym>VLAN</acronym> à
	router ?</para>
      </question>
    </qandaentry>

    <qandaentry>
      <question>
	<para>Une fois les interfaces de chaque <acronym>VLAN</acronym>
	configurées sur le poste routeur, quelles sont les opérations à
	effectuer pour que le transfert des paquets <acronym>IP</acronym> d'un
	réseau local à l'autre soit effectif ?</para>
      </question>
    </qandaentry>

    <qandaentry>
      <question>
	<para>Pourquoi doit-on utiliser la traduction d'adresses pour les flux
	réseau sortants du poste routeur vers l'Internet ? Que deviennent
	les paquets <acronym>IP</acronym> de ces flux sans traduction
	d'adresses ? Si la traduction d'adresses n'était pas disponible,
	quelle autre technique faudrait-il employer ?</para>
      </question>
    </qandaentry>

    <qandaentry>
      <question>
	<para>Donner la séquence des tests <acronym>ICMP</acronym> à effectuer
	pour valider la connectivité entre :</para>
	<itemizedlist>
	  <listitem>
	  <para>les postes clients et le poste routeur,</para>
	  </listitem>
	  <listitem>
	  <para>les postes clients et l'ensemble des autres interfaces du
	  routeur,</para>
	  </listitem>
	  <listitem>
	  <para>les postes clients entre eux,</para>
	  </listitem>
	  <listitem>
	  <para>les postes clients et l'Internet.</para>
	  </listitem>
	</itemizedlist>
      </question>
    </qandaentry>

    <qandaentry>
      <question>
	<para>À l'aide de l'analyseur <application>Wireshark</application>,
	capturer des flux réseau mettant en évidence le marquage des trames
	avec les balises <acronym>IEEE 802.1Q</acronym>. Relever les numéros
	d'identification des <acronym>VLANs</acronym> vus par les interfaces du
	routeur. Quelle interface faut-il utiliser pour la capture de façon à
	visualiser l'ensemble du trafic ?</para>
      </question>
    </qandaentry>

    <qandaentry>
      <question>
	<para>Pourquoi les flux réseau capturés contiennent-ils autant de
	trames <acronym>STP</acronym> (<wordasword>Spanning Tree
	Protocol</wordasword>) ?</para>
      </question>
    </qandaentry>

    <qandaentry>
      <question>
	<para>Pourquoi la majorité des trames <acronym>STP</acronym> capturées
	sont-elles considérées comme ayant le type
	<citetitle>Ethernet II</citetitle> ? Quel aurait du être le
	type d'une trame <acronym>STP</acronym> si les balises
	<acronym>IEEE 802.1Q</acronym> n'étaient pas
	utilisées ?</para>
      </question>
    </qandaentry>
  </qandaset>
  </sect2>
</sect1>

<sect1 xml:id='inter-vlan.routing.references'>
  <title>Documents de référence</title>

  <variablelist>
    <varlistentry xml:id='inter-vlan.routing.ieee802.1q.standard'>
      <term><citetitle>IEEE 802.1Q Standard</citetitle></term>
      <listitem>
      <para>&url.ieee802.1q.standard;</para>
      </listitem>
    </varlistentry>
    <varlistentry xml:id='inter-vlan.routing.cisco.how_lan_swicthes_work'>
      <term><citetitle>How LAN Switches Work</citetitle></term>
      <term>Document ID: 10607</term>
      <listitem>
      <para>Documentation <trademark>Cisco</trademark> :
      &url.cisco.how_lan_swicthes_work;</para>
      </listitem>
    </varlistentry>
    <varlistentry xml:id='inter-vlan.routing.cisco.vlan.encap'>
      <term>Standards d'encapsulation dans les <wordasword>trunks</wordasword></term>
      <listitem>
      <para>Documentation <trademark>Cisco</trademark> :
      &url.isl.dot1q;</para>
      </listitem>
    </varlistentry>
    <varlistentry xml:id='inter-vlan.routing.cisco.vlan.trunk'>
      <term><citetitle>Configuring InterVLAN Routing and ISL/802.1Q Trunking</citetitle></term>
      <term>Document ID: 14976</term>
      <listitem>
      <para>Documentation <trademark>Cisco</trademark> décrivant une
      configuration simple sur le routage inter-VLAN :
      &url.cisco.simple.config;.</para>
      </listitem>
    </varlistentry>
    <varlistentry xml:id='inter-vlan.routing.segmentation.lan'>
      <term><citetitle>La segmentation des réseaux locaux</citetitle></term>
      <listitem>
      <para>&url.segmentation.lan; : argumentation sur les fonctions de
      commutation et de routage.</para>
      </listitem>
    </varlistentry>
    <varlistentry xml:id='inter-vlan.routing.config.interface.lan'>
      <term><citetitle>Configuration d'une interface de réseau local</citetitle></term>
      <listitem>
      <para>&url.config.interface.lan; : présentation complète sur la
      configuration des interfaces réseau avec un système GNU/Linux. La section
      sur les <citetitle>Fonctions réseau d'un interface</citetitle> traite des
      réglages possibles au niveau du noyau Linux. C'est à ce niveau que l'on
      retrouve l'activation du routage. Voir <xref
      linkend='inter-vlan.routing.typical.routing'/>.</para>
      </listitem>
    </varlistentry>
    <varlistentry xml:id='inter-vlan.routing.packet.filtering.howto'>
      <term><citetitle>Guide Pratique du Filtrage de Paquets sous Linux 2.4</citetitle></term>
      <listitem>
      <para>&url.packet.filtering.howto; : présentation des concepts du
      filtrage réseau avec le noyau Linux.</para>
      </listitem>
    </varlistentry>
    <varlistentry xml:id='inter-vlan.routing.nat-howto'>
      <term><citetitle>Guide Pratique du NAT sous Linux 2.4</citetitle></term>
      <listitem>
      <para>&url.nat-howto; : présentation des concepts de la fonction de
      traduction d'adresses IP avec le noyau Linux.</para>
      </listitem>
    </varlistentry>
    <varlistentry xml:id='inter-vlan.routing.zebra.ospf'>
      <term><citetitle>Initiation au routage, 3ème partie</citetitle></term>
      <listitem>
      <para>&url.zebra.ospf; : guide complet sur l'utilisation du logiciel
      <application>Quagga</application> pour transformer un système GNU/Linux
      en routeur <acronym>OSPF</acronym>.</para>
      </listitem>
    </varlistentry>
    <varlistentry xml:id='inter-vlan.routing.archi.tp'>
      <term><citetitle>Architecture réseau des travaux pratiques</citetitle></term>
      <listitem>
	<para>Le support &url.archi.tp;  présente la topologie physique de
	la salle de travaux pratiques avec la &url.archi.tp.brassage; ainsi que
	les configurations par défaut des équipements. On y trouve aussi le
	plan d'adressage IP utilisé avec les autres supports de travaux
	pratiques, le plan de numérotations des VLANs et les affectations des
	groupes de ports des commutateurs.</para>
      </listitem>
    </varlistentry>
  </variablelist>
</sect1>
</article>
