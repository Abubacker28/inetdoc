<?xml version='1.0'?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V5.0//EN"
"/usr/share/xml/docbook/schema/dtd/5.0/docbook.dtd" [

<!ENTITY author		SYSTEM "author.xml">
<!ENTITY legal		SYSTEM "legal.xml">

<!-- urls -->
<!ENTITY % rfc_urls SYSTEM 'rfc.urls.xml'>
%rfc_urls;

<!ENTITY % inetdoc_urls SYSTEM 'inetdoc.urls.xml'>
%inetdoc_urls;

<!ENTITY url.ppp-wikipedia
'<link xmlns="http://docbook.org/ns/docbook" xlink:href="https://en.wikipedia.org/wiki/Point-to-Point_Protocol">
<citetitle>Point-to-Point Protocol</citetitle></link>'>

<!ENTITY url.pppoe-wikipedia
'<link xmlns="http://docbook.org/ns/docbook" xlink:href="https://en.wikipedia.org/wiki/Point-to-point_protocol_over_Ethernet">
<citetitle>Point-to-point protocol over Ethernet</citetitle></link>'>

<!ENTITY url.ppp-howto
'<link xmlns="http://docbook.org/ns/docbook" xlink:href="http://tldp.org/HOWTO/PPP-HOWTO/">
<citetitle>Linux PPP HOWTO</citetitle></link>'>

<!ENTITY url.cheatsheet
'<link xmlns="http://docbook.org/ns/docbook" xlink:href="https://www.inetdoc.net/pdf/iproute-cheatsheet.pdf">
<citetitle>Antisèche réseau</citetitle></link>'>
]>

<article xml:id='interco.pppoe.qa' xml:lang='fr'>

<info>
	<title>Topologie Hub &amp; Spoke avec le protocole PPPoE</title>

&author;
<abstract>
	<para>L'objectif de ce support de travaux pratiques est d'étudier les
		configurations d'un routeur d'accès (<wordasword>Hub</wordasword>) et
		d'un ou plusieurs routeurs d'agence (<wordasword>Spoke</wordasword>).
		On assimile ces deux configurations types à des routeurs qui réalisent
		l'interconnexion entre un réseau local et un réseau étendu. La
		technologie <acronym>PPPoE</acronym> illustre le raccordement entre les
		routeurs distants.</para>
</abstract>
<keywordset>
	<keyword>ppp</keyword>
	<keyword>pppoe</keyword>
	<keyword>chap</keyword>
	<keyword>pap</keyword>
	<keyword>route</keyword>
	<keyword>trunk</keyword>
	<keyword>vlan</keyword>
</keywordset>
</info>

<sect1 xml:id='interco.pppoe.qa.legal.meta'>
&legal;

<sect2 xml:id='interco.pppoe.qa.meta'>
	<title>Méta-information</title>

	<para>Cet article est écrit avec <link
		xlink:href="http://www.docbook.org"><citetitle>DocBook</citetitle></link>
		XML sur un système <link
		xlink:href="https://www.debian.org"><citetitle>Debian
		GNU/Linux</citetitle></link>. Il est disponible en version
		imprimable au format PDF : <link
		xlink:href="https://www.inetdoc.net/pdf/__printbasename__"><literal>__printbasename__</literal></link>.</para>

	<para>Toutes les commandes utilisées dans ce document ne sont pas
		spécifiques à une version particulière des systèmes UNIX ou GNU/Linux.
		C'est la distribution <citetitle>Debian GNU/Linux</citetitle> qui est
		utilisée pour les tests présentés. Voici une liste des paquets
		contenant les commandes :</para>

<itemizedlist>
	<listitem>
	<para><application>iproute2</application> - Outils de contrôle du trafic et
		du réseau</para>
	</listitem>
	<listitem>
	<para><application>ifupdown</application> - High level tools to configure
		network interfaces</para>
    </listitem>
	<listitem>
	<para><application>iputils-ping</application> - Tools to test the
		reachability of network hosts</para>
	</listitem>
	<listitem>
	<para><application>iputils-tracepath</application> - Tools to trace the
		network path to a remote host</para>
	</listitem>
	<listitem>
	<para><application>ppp</application> - Point-to-Point Protocol (PPP) -
		daemon</para>
	</listitem>
	<listitem>
	<para><application>pppoe</application> - PPP over Ethernet driver</para>
	</listitem>
</itemizedlist>
</sect2>

<sect2 xml:id='interco.pppoe.qa.convtypo'>
	<title>Conventions typographiques</title>

	<para>Tous les exemples d'exécution des commandes sont précédés d'une
		invite utilisateur ou <wordasword>prompt</wordasword> spécifique au
		niveau des droits utilisateurs nécessaires sur le système.</para>

	<itemizedlist>
	<listitem>
	<para>Toute commande précédée de l'invite <prompt>$</prompt> ne nécessite
		aucun privilège particulier et peut être utilisée au niveau utilisateur
		simple.</para>
	</listitem>
	<listitem>
	<para>Toute commande précédée de l'invite <prompt>#</prompt> nécessite les
		privilèges du super-utilisateur.</para>
	</listitem>
	</itemizedlist>
</sect2>

<sect2 xml:id='interco.pppoe.qa.troubleshoot'>
	<title>Aide à la mise au point</title>

	<para>Afin de résoudre les problèmes de connexion et de configuration, la
		journalisation système constitue le principal canal
		d'information.</para>

	<para>L'affichage des messages système est géré par le démon <systemitem
		class='daemon'>rsyslogd</systemitem>. Pour consulter ces messages,
		il faut lire le contenu des fichiers du répertoire <filename
		class='directory'>/var/log/</filename>. Dans le cas des travaux
		pratiques, les informations nécessaires à la mise au point des
		connexions réseau se trouvent dans le fichier
		<filename>/var/log/syslog</filename>.</para>

	<para>Pour visualiser les dernières lignes d'un journal système à la
		console on peut utiliser la commande <command>tail</command>.</para>

<screen><prompt>$</prompt> tail -n 50 -f /var/log/syslog</screen>

	<para>Du point de vue droits sur le système de fichiers, la commande
		<command>tail</command> peut être utilisée au niveau utilisateur normal
		dès lors que celui-ci appartient au groupe
		<systemitem>adm</systemitem>. Les commandes <command>id</command> et
		<command>groups</command> permettent de connaître les groupes auxquels
		l'utilisateur courant appartient.</para>
</sect2>
</sect1>

<sect1 xml:id='interco.pppoe.qa.isdn'>
	<title>Interface Ethernet &amp; protocole PPP</title>

	<para>Avec la généralisation de l'utilisation de la fibre optique dans les
		réseaux étendus, le format de trame historique <acronym>HDLC</acronym>
		est progressivement abandonné. Il faut dire que ce format de trame date
		du développement des liaisons séries asynchrones. Aujourd'hui, les
		liaisons sur fibres optiques sont <wordasword>Full-Duplex</wordasword>
		et on ne se préoccupe plus de synchronisation au niveau de la couche
		liaison de données. Le format de trame Ethernet devient donc une
		référence universelle.</para>

	<para>Le protocole <acronym>PPP</acronym> offre depuis l'origine une
		configuration indépendante de la technologie du réseau étendu.</para>

	<para>L'association entre trame Ethernet et <acronym>PPP</acronym> se fait
		grâce à un autre protocole baptisé <acronym>PPPoE</acronym>. Ce dernier
		permet d'encapsuler des trames <acronym>PPP</acronym> dans des trames
		Ethernet. Il est décrit à la page &url.pppoe-wikipedia; qui permet de
		traiter les questions ci-après.</para>

<qandaset defaultlabel='number'>
	<qandadiv>
	<qandaentry>
	<question>
	<para><phrase>Quelle est la raison de l'ajout d'un nouveau protocole entre
		Ethernet et <acronym>PPP</acronym> ?</phrase></para>

	<para>Consulter la page &url.pppoe-wikipedia;.</para>
	</question>
	<answer>
	<para>Le protocole <acronym>PPP</acronym> a été conçu pour fonctionner
		sur des liaisons point-à-point alors qu'un réseau local Ethernet est
		par définition un réseau de diffusion.</para> 

	<para>Sur un réseau de diffusion, le canal de transmission est partagé
		entre tous les hôtes qui accèdent au canal. Il a donc été nécessaire
		d'introduire un mécanisme de découverte des deux extrémités en
		communication avant de lancer les opérations du protocole
		<acronym>PPP</acronym>.</para> 
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para><phrase>Donner la liste des messages de découverte et de session
		<acronym>PPPoE</acronym> en précisant qui est l'initiative de cette
		découverte.</phrase></para>

	<para>Consulter la page &url.pppoe-wikipedia;.</para>
	</question>
	<answer>
	<itemizedlist>
	<listitem>
	<para>Client to server: Initiation (PADI)</para>
	</listitem>
	<listitem>
	<para>Server to client: Offer (PADO)</para>
	</listitem>
	<listitem>
	<para>Client to server: request (PADR)</para>
	</listitem>
	<listitem>
	<para>Server to client: session-confirmation (PADS)</para>
	</listitem>
	<listitem>
	<para>Either end to other end: termination (PADT)</para>
	</listitem>
	</itemizedlist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para><phrase>Quels sont les autres mécanismes de découverte de voisins
		connus dans un réseau local Ethernet ?</phrase></para>
	</question>
	<answer>
	<para>Voici la liste des «grands classiques».</para>

	<itemizedlist>
	<listitem>
	<para>Address Resolution Protocol (<acronym>ARP</acronym>).</para>

	<para>Quelle est l'adresse <acronym>MAC</acronym> d'un hôte dont on connaît
		l'adresse <acronym>IPv4</acronym> ?</para>
	</listitem>
	<listitem>
	<para>Neighbor Discovery Protocol (<acronym>NDP</acronym>).</para>

	<para>Ce protocole est associé à <acronym>IPv6</acronym>. Il définit 5
	messages <acronym>ICMPv6</acronym> qui couvrent les opérations réalisées
	par <acronym>ARP</acronym> et qui ajoutent de nouvelles fonctions.</para>
	</listitem>
	<listitem>
	<para>Multicast DNS (<acronym>mDNS</acronym>) ou
		<wordasword>Bonjour</wordasword>.</para>

	<para>Ce protocole entre dans la famille
		<wordasword>zeroconf</wordasword> qui a pour but d'annoncer et de
		fournir des éléments de configuration aux hôtes du réseau sans faire
		appel à une infrastructure de services tels que <acronym>DNS</acronym>
		et <acronym>DHCP</acronym>.</para>
	</listitem>
	</itemizedlist>
	</answer>
	</qandaentry>
	</qandadiv>
</qandaset>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.pppoe.qa.ppp-protocol'>
	<title>Connexion avec le protocole PPPoE</title>

	<para>Le Protocole Point à Point (<acronym>PPP</acronym>) est utilisé pour
	établir une communication directe entre deux hôtes. Il relie deux routeurs
	de façon logique au dessus d'une topologie de réseau physique qui peut
	comprendre divers composants et différentes technologies. Il permet aux
	deux extrémités en communication de négocier des paramètres de transmission
	tels que l'authentification, la compression et l'attribution d'adresses de
	couche réseau. Dans ce document, on utilise le protocole
	<acronym>PPP</acronym> au dessus d'un réseau Ethernet qui représente la
	technologie mise en œuvre par un opérateur Internet.</para>

	<para>Pour valider le fonctionnement du protocole <acronym>PPPoE</acronym>,
	on utilise les postes de travaux pratiques par groupes de deux routeurs
	<wordasword>Spoke</wordasword> et un routeur <wordasword>Hub</wordasword>.
	Les rôles sont définis ci-dessous.</para>
	
	<variablelist>
	<varlistentry xml:id='interco.pppoe.qa.hub-role'>
		<term><citetitle>Hub</citetitle></term>
	<listitem>
	<para>Traduit mot à mot, le rôle <wordasword>Hub</wordasword> correspond à
	un concentrateur.</para>

	<para>Il concentre tous les flux réseau des routeurs qui ont le rôle
	<wordasword>Spoke</wordasword>. En effet, les échanges entre deux routeurs
	<wordasword>Spoke</wordasword> doivent passer par le routeur
	<wordasword>Hub</wordasword>.</para>

	<para>On lui attribue aussi la fonction de <wordasword>Broadband Remote
	Access Server</wordasword> ou <acronym>BRAS</acronym>. Dans notre contexte,
	cette fonction se caractérise par le fait que ce routeur détient le plan
	d'adressage. C'est lui qui a la responsabilité de délivrer les adresses
	<acronym>IP</acronym> lors de l'initiation de la session
	<acronym>PPP</acronym>.</para>
	</listitem>
	</varlistentry>

	<varlistentry xml:id='interco.pppoe.qa.spoke-role'>
		<term><citetitle>Spoke</citetitle></term>
	<listitem>
	<para>Contrairement au cas précédent, il n'y a pas de traduction mot à mot
	pour le rôle <wordasword>Spoke</wordasword>. Le routeur
	<wordasword>Spoke</wordasword> doit s'adresser au routeur
	<acronym>Hub</acronym> dès qu'il veut acheminer un flux réseau. Il s'agit
	d'un routeur d'extrémité qui ne dispose d'aucun chemin alternatif pour
	joindre l'Internet.</para> 

	<para>Dans les réseaux domestiques, la «box» correspond bien au rôle
	<wordasword>Spoke</wordasword> dans la mesure où elle se voit attribuer une
	adresse <acronym>IPv4</acronym> publique par le fournisseur d'accès. Les
	seules informations qu'elle détient sont les authentifiants du
	client de l'opérateur.</para>
	</listitem>
	</varlistentry>
	</variablelist>

	<mediaobject>
	<imageobject role='fo'>
		<imagedata fileref='images/pppoe-topology.png' format='PNG'
		width='12cm' scalefit='1' align='center'/>
	</imageobject>
	<imageobject role='html'>
		<imagedata fileref='images/pppoe-topology.png' format='PNG'
		width='640px' scalefit='1' align='center'/>
	</imageobject>
	<textobject>
		<phrase>Topologie entre deux routeurs <wordasword>Hub</wordasword> et
		<wordasword>Spoke</wordasword> avec <acronym>PPPoE</acronym></phrase>
	</textobject>
	<caption>
		<para><link xlink:href='images/pppoe-topology.png'>Topologie entre deux
		routeurs <wordasword>Hub</wordasword> et <wordasword>Spoke</wordasword>
		avec <acronym>PPPoE</acronym></link></para>
	</caption>
	</mediaobject>

	<para>Comme le montre le graphique ci-dessus, l'opérateur distingue 4 types
	de flux réseau. Dans les manipulations qui suivent, on ne s'intéresse qu'au
	<acronym>VLANs</acronym> <wordasword>Management</wordasword> et
	<wordasword>Data</wordasword>. La gestion des flux de téléphonie et de
	vidéo suppose que l'on mette en œuvre des services qui sortent du cadre de
	l'étude du protocole <acronym>PPP</acronym>.</para>

	<para>Pour mettre en œuvre la topologie voulue, on distingue 4 groupes de 3
	postes de travaux pratiques. Le rôle de chaque poste est défini dans les
	tableaux ci-dessous en fonction de la salle de travaux pratiques.</para>

	<para>Plusieurs remarques sont à prendre en considération pour la suite du
	document.</para>

	<itemizedlist>
	<listitem>
		<para>Les adresses <acronym>IPv4</acronym> données dans les tableaux
		sont utilisées par des liens point à point. Le masque réseau est donc
		complet : <systemitem class='ipaddress'>255.255.255.255</systemitem>.
		Pour autant, les adresses ont été choisies de façon à pouvoir publier
		des réseaux avec un masque sur 30 bits via des routes statiques et/ou
		des protocoles de routage dynamique.</para>
	</listitem>
	<listitem>
		<para>Tous les exemples de commandes donnés dans la suite du document
		utilisent la numérotation suivante pour les
		<acronym>VLANs</acronym>.</para>
		<informaltable frame='all' pgwide='0'>
		<tgroup cols='2' align='left' colsep='1' rowsep='1'>
		<colspec colnum='1' colwidth='1*'/>
		<colspec colnum='2' colwidth='2*'/>
		<thead>
		<row>
			<?dbfo bgcolor="#333" ?>
			<?dbfo color="#fff" ?>
			<entry>Flux réseau</entry>
			<entry>VLAN</entry>
		</row>
		</thead>
		<tbody>
		<row>
			<entry>Management</entry>
			<entry>25</entry>
		</row>
		<row>
			<entry>Data</entry>
			<entry>26</entry>
		</row>
		<row>
			<entry>Voice</entry>
			<entry>27</entry>
		</row>
		<row>
			<entry>Video</entry>
			<entry>28</entry>
		</row>
		</tbody>
		</tgroup>
		</informaltable>
	</listitem>
	<listitem>
		<para>Pour les accès à l'Internet, le routeur de cœur de réseau à
		utiliser est <citetitle>Casper</citetitle>. Les adresses de passerelle
		par défaut des routeurs <wordasword>Hub</wordasword> dans le
		<acronym>VLAN</acronym> <option>4</option> sont :</para>

		<itemizedlist>
		<listitem>
			<para>172.16.16.2/20</para>
		</listitem>
		<listitem>
			<para>2001:678:3fc:4::2/64</para>
		</listitem>
		</itemizedlist>
	</listitem>
	</itemizedlist>
  
<?custom-pagebreak?>
<sect2 xml:id='interco.pppoe.qa.ppp-protocol.addressing'>
	<title>Plan d'adressage pour les groupes de 3 routeurs</title>

	<table xml:id='interco.pppoe.qa.ppp-protocol.211.addressing' frame='all' pgwide='1'>
		<title>Affectation des rôles, des numéros de VLANs et des adresses pour
		la salle 211</title>
	<tgroup cols='6' align='left' colsep='1' rowsep='1'>
	<colspec colnum='1' colwidth='1*'/>
	<colspec colnum='2' colwidth='2*'/>
	<colspec colnum='3' colwidth='1*'/>
	<colspec colnum='4' colwidth='1*'/>
	<colspec colnum='5' colwidth='2*'/>
	<colspec colnum='6' colwidth='3*'/>
	<thead>
	<row>
		<?dbfo bgcolor="#333" ?>
		<?dbfo color="#fff" ?>
		<entry>Groupe</entry>
		<entry>Poste</entry>
		<entry>Rôle</entry>
		<entry>VLAN</entry>
		<entry>Flux</entry>
		<entry>Réseau/Authentification</entry>
	</row>
	</thead>
	<tbody>
		<row>
			<entry morerows='10' valign='middle'>1</entry>
			<entry morerows='6' valign='middle'>christophsis</entry>
			<entry morerows='6' valign='middle'>Hub</entry>
			<entry morerows='1' valign='middle'>4</entry>
			<entry morerows='1' valign='middle'>Internet</entry>
			<entry><systemitem class='ipaddress'>172.16.17.10/20</systemitem></entry>
		</row>
		<row>
			<entry><systemitem class='ipaddress'>2001:678:3fc:4::3a/64</systemitem></entry>
		</row>
		<row>
			<entry>400</entry>
			<entry>Management</entry>
			<entry><systemitem class='ipaddress'>fe80:190::3/64</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>401</entry>
			<entry morerows='1' valign='middle'>Data</entry>
			<entry><systemitem class='ipaddress'>192.168.1.141:192.168.1.142</systemitem></entry>
		</row>
		<row>
			<entry><systemitem class='ipaddress'>2001:678:3fc:191::1/64</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>402</entry>
			<entry morerows='1' valign='middle'>Data</entry>
			<entry><systemitem class='ipaddress'>192.168.1.145:192.168.1.146</systemitem></entry>
		</row>
		<row>
			<entry><systemitem class='ipaddress'>2001:678:3fc:192::1/64</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>corellia</entry>
			<entry morerows='1' valign='middle'>Spoke 1</entry>
			<entry>400</entry>
			<entry>Management</entry>
			<entry><systemitem class='ipaddress'>fe80:190::1/64</systemitem></entry>
		</row>
		<row>
			<entry>401</entry>
			<entry>Data</entry>
			<entry align='center'><systemitem>etu_s1 / Sp0k3.1</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>delaya</entry>
			<entry morerows='1' valign='middle'>Spoke 2</entry>
			<entry>400</entry>
			<entry>Management</entry>
			<entry><systemitem class='ipaddress'>fe80:190::2/64</systemitem></entry>
		</row>
		<row>
			<entry>402</entry>
			<entry>Data</entry>
			<entry align='center'><systemitem>etu_s2 / Sp0k3.2</systemitem></entry>
		</row>
		<row>
			<entry morerows='10' valign='middle'>2</entry>
			<entry morerows='6' valign='middle'>kashyyyk</entry>
			<entry morerows='6' valign='middle'>Hub</entry>
			<entry morerows='1' valign='middle'>4</entry>
			<entry morerows='1' valign='middle'>Internet</entry>
			<entry><systemitem class='ipaddress'>172.16.17.13/20</systemitem></entry>
		</row>
		<row>
			<entry><systemitem class='ipaddress'>2001:678:3fc:4::3d/64</systemitem></entry>
		</row>
		<row>
			<entry>405</entry>
			<entry>Management</entry>
			<entry><systemitem class='ipaddress'>fe80:195::3/64</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>406</entry>
			<entry morerows='1' valign='middle'>Data</entry>
			<entry><systemitem class='ipaddress'>192.168.1.149:192.168.1.150</systemitem></entry>
		</row>
		<row>
			<entry><systemitem class='ipaddress'>2001:678:3fc:196::1/64</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>407</entry>
			<entry morerows='1' valign='middle'>Data</entry>
			<entry><systemitem class='ipaddress'>192.168.1.153:192.168.1.154</systemitem></entry>
		</row>
		<row>
			<entry><systemitem class='ipaddress'>2001:678:3fc:197::1/64</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>korriban</entry>
			<entry morerows='1' valign='middle'>Spoke 1</entry>
			<entry>405</entry>
			<entry>Management</entry>
			<entry><systemitem class='ipaddress'>fe80:195::1/64</systemitem></entry>
		</row>
		<row>
			<entry>406</entry>
			<entry>Data</entry>
			<entry align='center'><systemitem>etu_s1 / Sp0k3.1</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>kessel</entry>
			<entry morerows='1' valign='middle'>Spoke 2</entry>
			<entry>405</entry>
			<entry>Management</entry>
			<entry><systemitem class='ipaddress'>fe80:195::2/64</systemitem></entry>
		</row>
		<row>
			<entry>407</entry>
			<entry>Data</entry>
			<entry align='center'><systemitem>etu_s2 / Sp0k3.2</systemitem></entry>
		</row>
		<row>
			<entry morerows='10' valign='middle'>3</entry>
			<entry morerows='6' valign='middle'>mygeeto</entry>
			<entry morerows='6' valign='middle'>Hub</entry>
			<entry morerows='1' valign='middle'>4</entry>
			<entry morerows='1' valign='middle'>Internet</entry>
			<entry><systemitem class='ipaddress'>172.16.17.16/20</systemitem></entry>
		</row>
		<row>
			<entry><systemitem class='ipaddress'>2001:678:3fc:4::40/64</systemitem></entry>
		</row>
		<row>
			<entry>410</entry>
			<entry>Management</entry>
			<entry><systemitem class='ipaddress'>fe80:19a::3/64</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>411</entry>
			<entry morerows='1' valign='middle'>Data</entry>
			<entry><systemitem class='ipaddress'>192.168.1.157:192.168.1.158</systemitem></entry>
		</row>
		<row>
			<entry><systemitem class='ipaddress'>2001:678:3fc:19b::1/64</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>412</entry>
			<entry morerows='1' valign='middle'>Data</entry>
			<entry><systemitem class='ipaddress'>192.168.1.161:192.168.1.162</systemitem></entry>
		</row>
		<row>
			<entry><systemitem class='ipaddress'>2001:678:3fc:19c::1/64</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>nelvaan</entry>
			<entry morerows='1' valign='middle'>Spoke 1</entry>
			<entry>410</entry>
			<entry>Management</entry>
			<entry><systemitem class='ipaddress'>fe80:19a::1/64</systemitem></entry>
		</row>
		<row>
			<entry>411</entry>
			<entry>Data</entry>
			<entry align='center'><systemitem>etu_s1 / Sp0k3.1</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>rattatak</entry>
			<entry morerows='1' valign='middle'>Spoke 2</entry>
			<entry>410</entry>
			<entry>Management</entry>
			<entry><systemitem class='ipaddress'>fe80:19a::2/64</systemitem></entry>
		</row>
		<row>
			<entry>412</entry>
			<entry>Data</entry>
			<entry align='center'><systemitem>etu_s2 / Sp0k3.2</systemitem></entry>
		</row>
		<row>
			<entry morerows='10' valign='middle'>4</entry>
			<entry morerows='6' valign='middle'>saleucami</entry>
			<entry morerows='6' valign='middle'>Hub</entry>
			<entry morerows='1' valign='middle'>4</entry>
			<entry morerows='1' valign='middle'>Internet</entry>
			<entry><systemitem class='ipaddress'>172.16.17.19/20</systemitem></entry>
		</row>
		<row>
			<entry><systemitem class='ipaddress'>2001:678:3fc:4::43/64</systemitem></entry>
		</row>
		<row>
			<entry>415</entry>
			<entry>Management</entry>
			<entry><systemitem class='ipaddress'>fe80:19f::3/64</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>416</entry>
			<entry morerows='1' valign='middle'>Data</entry>
			<entry><systemitem class='ipaddress'>192.168.1.165:192.168.1.166</systemitem></entry>
		</row>
		<row>
			<entry><systemitem class='ipaddress'>2001:678:3fc:1a0::1/64</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>417</entry>
			<entry morerows='1' valign='middle'>Data</entry>
			<entry><systemitem class='ipaddress'>192.168.1.169:192.168.1.170</systemitem></entry>
		</row>
		<row>
			<entry><systemitem class='ipaddress'>2001:678:3fc:1a1::1/64</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>taris</entry>
			<entry morerows='1' valign='middle'>Spoke 1</entry>
			<entry>415</entry>
			<entry>Management</entry>
			<entry><systemitem class='ipaddress'>fe80:19f::1/64</systemitem></entry>
		</row>
		<row>
			<entry>416</entry>
			<entry>Data</entry>
			<entry align='center'><systemitem>etu_s1 / Sp0k3.1</systemitem></entry>
		</row>
		<row>
			<entry morerows='1' valign='middle'>teth</entry>
			<entry morerows='1' valign='middle'>Spoke 2</entry>
			<entry>415</entry>
			<entry>Management</entry>
			<entry><systemitem class='ipaddress'>fe80:19f::2/64</systemitem></entry>
		</row>
		<row>
			<entry>417</entry>
			<entry>Data</entry>
			<entry align='center'><systemitem>etu_s2 / Sp0k3.2</systemitem></entry>
		</row>
	</tbody>
	</tgroup>
	</table>
</sect2>

<sect2 xml:id='interco.pppoe.qa.ppp-protocol.management'>
	<title>Communications dans le VLAN Management</title>

	<para>Sachant que les routeurs sont reliés entre eux par des
	<wordasword>trunks</wordasword>, il faut commencer par s'assurer que les
	échanges réseau sont possible au sein du <acronym>VLAN</acronym> de gestion
	opérateur : <option>Management</option>.</para>

	<qandaset defaultlabel='number'>
	<qandaentry>
	<question>
		<para><phrase>Comment créer et configurer une sous-interface dédiée au
		<acronym>VLAN</acronym> <option>Management</option> sur chaque routeur
		?</phrase></para>

		<para>Consulter les pages de manuels <command>man ip-link</command> et
		rechercher les options du type <option>vlan</option>.</para>

		<para>Il est aussi possible de consulter l'&url.cheatsheet;.</para>
	</question>
	<answer>
		<para>La syntaxe de création d'une sous-interface de l'interface
		physique <option>eth0</option> est la suivante :</para>

<screen><prompt>$</prompt> sudo ip link add link eth0 name eth0.25 type vlan id 25</screen>

		<para>La syntaxe d'activation de l'interface est la suivante :</para>

<screen><prompt>$</prompt> sudo ip link set dev eth0.25 up</screen>

		<para>Dès cette étape il est possible de faire un recensement du
		voisinage réseau <acronym>IPv6</acronym>.</para> 

<screen><prompt>$</prompt> ping -c2 ff02::1%eth0.25
PING ff02::1%eth0.25(ff02::1%eth0.25) 56 data bytes
64 bytes from fe80::baca:3aff:fe9e:8556%eth0.25: icmp_seq=1 ttl=64 time=0.055 ms
64 bytes from fe80::c0da:e2ff:feec:6ac0%eth0.25: icmp_seq=1 ttl=64 time=2.83 ms (DUP!)
64 bytes from fe80::baca:3aff:fe9e:8556%eth0.25: icmp_seq=2 ttl=64 time=0.069 ms

--- ff02::1%eth0.25 ping statistics ---
2 packets transmitted, 2 received, +1 duplicates, 0% packet loss, time 2ms
rtt min/avg/max/mdev = 0.055/0.985/2.831/1.305 ms

<prompt>$</prompt> ip neigh ls dev eth0.25
fe80::c0da:e2ff:feec:6ac0 lladdr c2:da:e2:ec:6a:c0 REACHABLE</screen>

		<para>La dernière commande de la copie d'écran ci-dessus indique qu'au
		moins un voisin est joignable dans le domaine de diffusion
		correspondant au <acronym>VLAN</acronym>
		<option>Management</option>.</para>

		<para>La syntaxe d'affectation d'une nouvelle adresse
		<acronym>IPv6</acronym> à l'interface est la suivante :</para>

<screen><prompt>$</prompt> sudo ip -6 addr add fe80:19::3/64 dev eth0.25

<prompt>$</prompt> ip addr ls dev eth0.25
3: eth0.25@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether b8:ca:3a:9e:85:56 brd ff:ff:ff:ff:ff:ff
    <emphasis>inet6 fe80:19::3/64 scope link</emphasis>
       valid_lft forever preferred_lft forever
    inet6 fe80::baca:3aff:fe9e:8556/64 scope link
       valid_lft forever preferred_lft forever</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment qualifier les échanges réseau dans le
		<acronym>VLAN</acronym> <option>Management</option> ?</phrase></para>

		<para>Il faut, au minimum, que le routeur <wordasword>Hub</wordasword>
		et les deux routeurs <wordasword>Spoke</wordasword> puissent se
		contacter via le protocole <acronym>ICMP</acronym>. Cette opération
		sert à valider le raccordement physique entre les 3 routeurs ainsi que
		la configuration des ports de commutation Ethernet.</para>
	</question>
	<answer>
		<para>Voici un exemple de commande <command>ping</command> dans le
		<acronym>VLAN</acronym> <option>Management</option>.</para>

<screen><prompt>$</prompt> ping -c2 fe80:19::1%eth0.25
PING fe80:19::1%eth0.25(fe80:19::1%eth0.25) 56 data bytes
64 bytes from fe80:19::1%eth0.25: icmp_seq=1 ttl=64 time=1.42 ms
64 bytes from fe80:19::1%eth0.25: icmp_seq=2 ttl=64 time=0.827 ms

--- fe80:19::1%eth0.25 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 3ms
rtt min/avg/max/mdev = 0.827/1.124/1.422/0.299 ms</screen>
	</answer>
	</qandaentry>
	</qandaset>
</sect2>

<sect2 xml:id='interco.pppoe.qa.ppp-protocol.forward'>
	<title>Activation du routage dans le noyau Linux</title>

	<para>Quelque soit le rôle joué par le routeur, il est essentiel que la
	fonction de routage des paquets <acronym>IPv4</acronym> et
	<acronym>IPv6</acronym> soit activée dans le noyau Linux.</para>

	<qandaset defaultlabel='number'>
	<qandaentry>
	<question>
		<para><phrase>Quel est l'outil qui permet de modifier dynamiquement les
		paramètres de fonctionnement du noyau Linux ?</phrase></para>

		<para>Les paramètres du noyau Linux apparaissent dans l'arborescence du
		système de fichiers virtuel <filename
		class='directory'>/proc</filename>. Il faut rechercher le paquet
		contenant les outils qui travaillent avec cette arborescence.</para> 
	</question>
	<answer>
		<para>Le paquet qui fournit les outils de manipulation des paramètres
		du noyau Linux est <application>procps</application>. Il contient
		l'outil <command>sysctl</command> qui nous permet de configurer la
		fonction de routage dans le noyau Linux.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quels sont les fichiers ou répertoires qui contiennent
		les paramètres de configuration et leurs valeurs dans l'arborescence de
		configuration du système ?</phrase></para>

		<para>Rechercher dans l'arborescence les références à l'outil de la
		question précédente.</para>
	</question>
	<answer>
<screen><prompt>$</prompt> sudo find /etc/ -name "*sysctl*"
/etc/sysctl.conf
/etc/sysctl.d
/etc/sysctl.d/README.sysctl
/etc/sysctl.d/99-sysctl.conf</screen>

		<para>C'est le fichier <filename>/etc/sysctl.conf</filename> qui
		contient les paramètres intéressants dans le contexte de ces travaux
		pratiques.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quels sont les paramètres à modifier pour que le routage
		des paquets <acronym>IPv4</acronym> et <acronym>IPv6</acronym> soit
		effectif ?</phrase></para>

		<para>La consultation du fichier fait apparaître directement les
		paramètres de routage. Il suffit alors de décommenter les lignes
		intéressantes.</para>
	</question>
	<answer>
		<para>Voici le contenu du fichier <filename>/etc/sysctl.conf</filename>
		après modification des paramètres et après filtrage des lignes de
		commentaires et des lignes vides.</para>
		
<screen><prompt>$</prompt> egrep -v '(^#|^$)' /etc/sysctl.conf
net.ipv4.conf.default.rp_filter=1
net.ipv4.conf.all.rp_filter=1
<emphasis>net.ipv4.ip_forward=1</emphasis>
<emphasis>net.ipv6.conf.all.forwarding=1</emphasis>
net.ipv4.conf.all.secure_redirects = 1
net.ipv4.conf.all.log_martians = 1</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment activer les paramètres définis dans les fichiers
		de configuration des paramètres du noyau Linux ?</phrase></para>

		<para>Consulter les pages de manuels de la commande
		<command>sysctl</command>.</para>
	</question>
	<answer>
		<para>L'option <option>--system</option> de la commande
		<command>sysctl</command> permet de (re)parcourir tous les paramètres
		de tous les fichiers et répertoires de l'arborescence de
		configuration.</para>

<screen><prompt>$</prompt> sudo sysctl --system
* Applying /etc/sysctl.d/99-sysctl.conf ...
net.ipv4.conf.default.rp_filter = 1
net.ipv4.conf.all.rp_filter = 1
net.ipv4.ip_forward = 1
net.ipv6.conf.all.forwarding = 1
net.ipv4.conf.all.secure_redirects = 1
net.ipv4.conf.all.log_martians = 1
* Applying /etc/sysctl.d/bindv6only.conf ...
net.ipv6.bindv6only = 1
* Applying /etc/sysctl.d/protect-links.conf ...
fs.protected_hardlinks = 1
fs.protected_symlinks = 1
* Applying /etc/sysctl.conf ...
net.ipv4.conf.default.rp_filter = 1
net.ipv4.conf.all.rp_filter = 1
net.ipv4.ip_forward = 1
net.ipv6.conf.all.forwarding = 1
net.ipv4.conf.all.secure_redirects = 1
net.ipv4.conf.all.log_martians = 1</screen>
	</answer>
	</qandaentry>
	</qandaset>
</sect2>

<sect2 xml:id='interco.pppoe.qa.ppp-protocol.hub'>
	<title>Configuration PPPoE d'un routeur Hub</title>

	<qandaset defaultlabel='number'>
		<qandaentry>
		<question>
			<para><phrase>Quel paquet spécifique à la gestion du dialogue <acronym>PPPoE</acronym> 
			gestionnaire de connexion pour ce mode de fonctionnement
			?</phrase></para>

			<para>Consulter les pages de manuels du démon
			<command>ipppd</command>.</para>
			</question>
			<answer>
			<para>Le protocole <acronym>PPP</acronym> n'a pas été conçu suivant le
			modèle Client/Serveur. Il suppose que deux processus pairs échangent des
			informations. Pour cette question c'est l'option <option>auth</option>
			qui définit si un hôte requiert une authentification de l'hôte pair.
			Cette authentification peut être requise par chacune des extrémités en
			communication. Pour désactiver l'authentification à chaque extrémité, on
			ajoute le préfixe <option>no</option> à l'option
			<option>auth</option>.</para>
			</answer>
		</qandaentry>
		
		<qandaentry>
			<question>
			<para><phrase>Quelles sont les options qui permettent de visualiser en
			détails le dialogue <acronym>PPP</acronym> dans les journaux systèmes
			?</phrase></para>

			<para>C'est à nouveau dans les pages de manuels que la réponse se
			trouve.</para>
			</question>
			<answer>
			<para>C'est l'option <option>debug</option> qui permet l'affichage des
			informations relatives aux différentes étapes de l'établissement de la
			connexion <acronym>PPP</acronym>.</para>
			</answer>
		</qandaentry>

		<qandaentry>
			<question>
			<para><phrase>Quels sont les noms des deux sous-couches du protocole
			<acronym>PPP</acronym> qui apparaissent dans les journaux systèmes
			?</phrase> Quels sont les rôles respectifs de ces deux sous-couches
			?</para>

			<para>Consulter la page &url.ppp-wikipedia;.</para>
			</question>
			<answer>
			<para>La consultation des journaux système fait apparaître les
			informations suivantes.</para>

<screen>pppd[3262]: sent [LCP ConfReq id=0x1 &lt;mru 1492> &lt;magic 0x46010ac>]
kernel: [  895.700115] NET: Registered protocol family 24
pppd[3262]: rcvd [LCP ConfReq id=0x1 &lt;magic 0xcab9fecc>] <co xml:id='lcp'/>
pppd[3262]: sent [LCP ConfAck id=0x1 &lt;magic 0xcab9fecc>]
pppd[3262]: sent [LCP ConfReq id=0x1 &lt;mru 1492> &lt;magic 0x46010ac>]
pppd[3262]: rcvd [LCP ConfAck id=0x1 &lt;mru 1492> &lt;magic 0x46010ac>]
pppd[3262]: sent [LCP EchoReq id=0x0 magic=0x46010ac]
pppd[3262]: peer from calling number 52:54:00:12:34:05 authorized
pppd[3262]: sent [IPCP ConfReq id=0x1 &lt;addr 0.0.0.0>] <co xml:id='ncp'/>
pppd[3262]: rcvd [LCP EchoReq id=0x0 magic=0xcab9fecc]
pppd[3262]: sent [LCP EchoRep id=0x0 magic=0x46010ac]
pppd[3262]: rcvd [IPCP ConfReq id=0x1 &lt;addr 10.0.0.1>]
pppd[3262]: sent [IPCP ConfAck id=0x1 &lt;addr 10.0.0.1>]
pppd[3262]: rcvd [LCP EchoRep id=0x0 magic=0xcab9fecc]
pppd[3262]: rcvd [IPCP ConfNak id=0x1 &lt;addr 10.67.15.1>]
pppd[3262]: sent [IPCP ConfReq id=0x2 &lt;addr 10.67.15.1>]
pppd[3262]: rcvd [IPCP ConfAck id=0x2 &lt;addr 10.67.15.1>]
pppd[3262]: local  IP address 10.67.15.1
pppd[3262]: remote IP address 10.0.0.1</screen>

      <calloutlist>
        <callout arearefs='lcp'>
	<para>La sous-couche <wordasword>Link Control Protocol</wordasword>
	(<acronym>LCP</acronym>) assure la configuration automatique des
	interfaces à chaque extrémité. Les paramètres négociés entre les deux
	hôtes en communication sont multiples : l'adaptation de la taille de
	datagramme, les caractères d'échappement, les numéros magiques et la
	sélection des options d'authentification.</para>
	</callout>
	<callout arearefs='ncp'>
	<para>La sous-couche <wordasword>Network Control Protocol</wordasword>
	(<acronym>NCP</acronym>) assure l'encapsulation de multiples protocoles
	de la couche réseau. Dans l'exemple donné, c'est le protocole
	<acronym>IP</acronym> qui est utilisé ; d'où l'acronyme
	<acronym>IPCP</acronym>.</para>
	</callout>
      </calloutlist>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Quels sont les en-têtes du dialogue qui identifient les
      requêtes (émises|reçues), les rejets et les acquittements
      ?</phrase></para>

      <para>Consulter les journaux système contenant les traces d'une connexion
      <acronym>PPP</acronym>.</para>
      </question>
      <answer>
      <para>La copie d'écran donnée ci-dessus fait apparaître les directives
      <literal>Conf*</literal> pour chaque paramètre négocié.</para>
      <itemizedlist>
      <listitem>
      <para><literal>ConfReq</literal> indique une requête.</para>
      </listitem>
      <listitem>
      <para><literal>ConfAck</literal> indique un acquittement.</para>
      </listitem>
      <listitem>
      <para><literal>ConfNak</literal> indique un rejet.</para>
      </listitem>
      </itemizedlist>
      </answer>
    </qandaentry>
  </qandaset>
  </sect2>

  <sect2 xml:id='interco.pppoe.qa.protocol.client.authpap'>
    <title>Avec authentification PAP</title>

  <para>Relativement à la section précédente, on ajoute ici le volet
  authentification au dialogue <acronym>PPP</acronym> en utilisant le protocole
  <acronym>PAP</acronym>.</para>

  <para>Pour l'ensemble des postes de travaux pratiques les paramètres
  d'authentification <wordasword>login/password</wordasword> sont :
  <option>etu/stri</option>.</para>

  <note>
    <title>Journalisation des échanges de mots de passe</title>
    <para>Il existe une option spécifique du gestionnaire de connexion
    <acronym>PPP</acronym> <application>ipppd</application> qui permet de
    journaliser les échanges sur les mots de passe :
    <option>+pwlog</option>. En ajoutant cette option à celles déjà utilisées
    lors de l'appel à <application>ipppd</application> sur la ligne de
    commande, on peut observer l'état des transactions
    d'authentification.</para>
  </note>

  <qandaset defaultlabel='number'>
    <qandaentry>
      <question>
      <para><phrase>Quelles sont les options de configuration spécifiques à
      l'authentification <acronym>PAP</acronym> à fournir au démon
      <acronym>PPP</acronym> ?</phrase></para>

      <para>Consulter les pages de manuels du démon
      <command>ipppd</command>.</para>
      </question>
      <answer>
      <para>C'est l'option <option>pap</option> qui permet de spécifier ce type
      d'authentification.</para>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Dans quel fichier sont stockés les paramètres
      d'authentification <wordasword>login/password</wordasword> utilisés par
      le protocole <acronym>PAP</acronym> ?</phrase></para>

      <para>Consulter les pages de manuels du démon
      <command>ipppd</command>.</para>
      </question>
      <answer>
      <para>C'est le fichier <filename>/etc/ppp/pap-secrets</filename> qui
      contient les couples <wordasword>login/password</wordasword> utilisés
      lors de l'authentification.</para>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Quels sont les en-têtes du dialogue de la couche
      <acronym>LCP</acronym> qui identifient les requêtes d'authentification
      échangées entre les deux processus pairs ?</phrase></para>
      </question>
      <answer>
      <para>Voici une copie d'écran de connexion qui fait apparaître les
      directives <literal>Conf*</literal> relatives à la partie
      authentification.</para>

<screen>pppd[5259]: sent [LCP ConfReq id=0x1 &lt;auth pap> &lt;magic 0x53c04a36>]
pppd[5259]: rcvd [LCP ConfAck id=0x1 &lt;auth pap> &lt;magic 0x53c04a36>]
pppd[5259]: rcvd [LCP ConfReq id=0x1 &lt;mru 1492> &lt;magic 0x3f810ce9>]
pppd[5259]: sent [LCP ConfAck id=0x1 &lt;mru 1492> &lt;magic 0x3f810ce9>]
pppd[5259]: sent [LCP EchoReq id=0x0 magic=0x53c04a36]
pppd[5259]: rcvd [LCP EchoReq id=0x0 magic=0x3f810ce9]
pppd[5259]: sent [LCP EchoRep id=0x0 magic=0x53c04a36]
pppd[5259]: rcvd [PAP AuthReq id=0x1 user="etu" password=&lt;hidden>]</screen>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Quelles sont les informations échangées sur les mots de
      passe avec le protocole <acronym>PAP</acronym> ?</phrase> Est-il possible
      de relever le mot de passe avec ce protocole ?</para>
      </question>
      <answer>
      <para>L'utilisation de la méthode d'authentification
      <acronym>PAP</acronym> implique que le mot de passe circule en clair. Une
      simple capture du trafic permet de «relever» le mot de passe.</para>

      <para>Voici un extrait de capture réseau effectué avec le démon
      <systemitem>pppd</systemitem> à l'aide de la commande
      <userinput><prompt>#</prompt> tshark -V -i eth0 -R "ppp" >
      grepMyPassword.txt</userinput>.</para>

<screen>Type: PPPoE Session (0x8864)
PPP-over-Ethernet Session
    0001 .... = Version: 1
    .... 0001 = Type: 1
    Code: Session Data (0x00)
    Session ID: 0x0003
    Payload Length: 16
Point-to-Point Protocol
    Protocol: Password Authentication Protocol (0xc023)
PPP Password Authentication Protocol
    Code: Authenticate-Request (1)
    Identifier: 1
    Length: 14
    Data
        Peer-ID-Length: 3
        Peer-ID: etu
        Password-Length: 5
        <emphasis>Password: stri</emphasis></screen>
      </answer>
    </qandaentry>
  </qandaset>
  </sect2>

  <sect2 xml:id='interco.pppoe.qa.protocol.client.authchap'>
    <title>Avec authentification CHAP</title>

  <para>On reprend exactement le cas précédent en changeant le protocole
  d'authentification. On utilise maintenant le protocole <acronym>CHAP</acronym>
  qui est nettement plus intéressant que <acronym>PAP</acronym>. Nous allons
  voir pourquoi !</para>

  <para>Les paramètres d'authentification
  <wordasword>login/password</wordasword> ne changent pas :
  <option>etu/stri</option>.</para>

  <qandaset defaultlabel='number'>
    <qandaentry>
      <question>
      <para><phrase>Quelles sont les options de configuration spécifiques à
      l'authentification <acronym>CHAP</acronym> à fournir au démon PPP
      ?</phrase></para>

      <para>Consulter les pages de manuels du démon
      <command>ipppd</command>.</para>
      </question>
      <answer>
      <para>C'est l'option <option>chap</option> qui permet de spécifier ce
      type d'authentification.</para>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Dans quel fichier sont stockés les paramètres
      d'authentification <wordasword>login/password</wordasword> utilisés par
      le protocole <acronym>CHAP</acronym> ?</phrase></para>

      <para>Consulter les pages de manuels du démon
      <command>ipppd</command>.</para>
      </question>
      <answer>
      <para>C'est le fichier <filename>/etc/ppp/chap-secrets</filename> qui
      contient les couples <wordasword>login/password</wordasword> utilisés
      lors de l'authentification.</para>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Quels sont les en-têtes du dialogue de la couche
      <acronym>LCP</acronym> qui identifient les requêtes d'authentification
      échangées entre les deux processus pairs ?</phrase></para>
      </question>
      <answer>
      <para>Voici une copie d'écran de connexion qui fait apparaître les
      directives <literal>Conf*</literal> relatives à la partie
      authentification.</para>

<screen>pppd[6037]: pppd 2.4.5 started by root, uid 0
pppd[6037]: using channel 28
pppd[6037]: Using interface ppp0
pppd[6037]: Connect: ppp0 &lt; /dev/pts/1
pppd[6037]: sent [LCP ConfReq id=0x1 &lt;auth chap MD5> &lt;magic 0x46c97184>]
pppd[6037]: rcvd [LCP ConfAck id=0x1 &lt;auth chap MD5> &lt;magic 0x46c97184>]
pppd[6037]: rcvd [LCP ConfReq id=0x1 &lt;mru 1492> &lt;auth chap MD5> &lt;magic 0x1f157ebf>]
pppd[6037]: sent [LCP ConfAck id=0x1 &lt;mru 1492> &lt;auth chap MD5> &lt;magic 0x1f157ebf>]
pppd[6037]: sent [LCP EchoReq id=0x0 magic=0x46c97184]
pppd[6037]: sent [CHAP Challenge id=0x86 &lt;ed6d9c0c022dbe008b2d3332fb275f5af1ca499393>,\
					name = "ppp-hub"]
pppd[6037]: rcvd [LCP EchoReq id=0x0 magic=0x1f157ebf]
pppd[6037]: sent [LCP EchoRep id=0x0 magic=0x46c97184]
pppd[6037]: rcvd [CHAP Challenge id=0x4f &lt;29b6227da7da53d7ee2b4f6f7ec9a1900d5c9ac33f14>,\
					name = "etu"]
pppd[6037]: sent [CHAP Response id=0x4f &lt;cb5bf4fbb0f9afd98a477f1f8a2e4c1f>,\
					name = "etu"]
pppd[6037]: rcvd [LCP EchoRep id=0x0 magic=0x1f157ebf]
pppd[6037]: rcvd [CHAP Response id=0x86 &lt;de265c472d38a441fdbd2228314e0d86>,\
					name = "etu"]
pppd[6037]: sent [CHAP Success id=0x86 "Access granted"]
pppd[6037]: rcvd [CHAP Success id=0x4f "Access granted"]
pppd[6037]: CHAP authentication succeeded: Access granted
pppd[6037]: CHAP authentication succeeded</screen>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Quelles sont les informations échangées sur les mots de
      passe avec le protocole <acronym>CHAP</acronym> ?</phrase> Est-il
      possible de relever le mot de passe avec ce protocole ?</para>
      </question>
      <answer>
      <para>Les éléments donnés dans le copie d'écran ci-dessus montrent qu'il
      n'y a pas d'échange de mot de passe entre les deux systèmes en
      communication. Seuls des <wordasword>Challenges</wordasword> sont
      échangés.</para>
      </answer>
    </qandaentry>
  </qandaset>
  </sect2>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.pppoe.qa.hub-and-spoke'>
	<title>Topologie Hub &amp; Spoke</title>

	<para>La topologie dite <wordasword>Hub &amp; Spoke</wordasword> est une
		forme de topologie étoile dans laquelle tous les liens sont de type
		point à point. Le rôle du <wordasword>Hub</wordasword> est de
		concentrer tous les accès depuis les sites distants ou les
		<wordasword>Spokes</wordasword>. Du point de vue routage le
		<wordasword>Hub</wordasword> détient la totalité du plan d'adressage
		alors que les <wordasword>Spokes</wordasword> ne disposent que d'un
		accès unique vers les autres réseaux.</para>

  <mediaobject>
  <imageobject>
    <imagedata fileref='images/interco.ppp.topology1.png' format='PNG' width='12cm' scalefit='1'/>
  </imageobject>
  <textobject>
    <phrase>Topologie Hub &amp; Spoke</phrase>
  </textobject>
  <caption>
    <para><link xlink:href='images/interco.ppp.topology1.png'>Topologie Hub
    &amp; Spoke</link></para>
  </caption>
  </mediaobject>

  <para>Dans le contexte de ces travaux pratiques, le routeur
  <wordasword>Hub</wordasword> dispose d'un accès au réseau local
  (<acronym>LAN</acronym>) via son interface Ethernet et doit fournir un accès
  à Internet par ses interfaces d'accès au réseau étendu
  (<acronym>WAN</acronym>). Ce réseau étendu est modélisé par les deux canaux B
  de l'interface <acronym>RNIS</acronym> du <wordasword>Hub</wordasword>. Côté
  <wordasword>Spokes</wordasword>, les interfaces Ethernet sont provisoirement
  inutilisées et le seul accès aux autres réseau se fait par un canal B de
  l'interface <acronym>RNIS</acronym>.</para>
  
<?custom-pagebreak?>
<sect2 xml:id='interco.pppoe.qa.hub-and-spoke.addressing'>
	<title>Plan d'adressage</title>

	<para>Pour mettre en œuvre la topologie voulue, on distingue 4 groupes de 3
		postes de travaux pratiques. Le rôle de chaque poste est défini dans le
		tableau ci-dessous.</para>

  <table xml:id='interco.pppoe.qa.hub-and-spoke.lab.addressing' frame='all' pgwide='1'>
    <title>Affectation des rôles, des numéros de bus S0 et des adresses
    IP</title>
    <tgroup cols='7' align='left' colsep='1' rowsep='1'>
    <colspec colnum='1' colwidth='1*'/>
    <colspec colnum='2' colwidth='1.5*'/>
    <colspec colnum='3' colwidth='1*'/>
    <colspec colnum='4' colwidth='1*'/>
    <colspec colnum='5' colwidth='1*'/>
    <colspec colnum='6' colwidth='1*'/>
    <colspec colnum='7' colwidth='3*'/>
    <thead>
      <row>
      <entry>Groupe</entry>
      <entry>Poste</entry>
      <entry>Rôle</entry>
      <entry>Bus S0</entry>
      <entry>N° Tél.</entry>
      <entry>Interface</entry>
      <entry>Réseau/Authentification</entry>
      </row>
    </thead>
    <tbody>
      <row>
      <entry morerows='5' valign='middle'>1</entry>
      <entry morerows='1' valign='middle'>centares</entry>
      <entry morerows='1' valign='middle'>Hub</entry>
      <entry align='right'>S0.1</entry>
      <entry>104</entry>
      <entry>ippp0</entry>
      <entry><systemitem class='ipaddress'>192.168.104.1:192.168.104.2</systemitem></entry>
      </row>
      <row>
      <entry align='right'>S0.1</entry>
      <entry>105</entry>
      <entry>ippp1</entry>
      <entry><systemitem class='ipaddress'>192.168.105.1:192.168.105.2</systemitem></entry>
      </row>
      <row>
      <entry morerows='1' valign='middle'>bespin</entry>
      <entry morerows='1' valign='middle'>Spoke 1</entry>
      <entry align='right'>S0.2</entry>
      <entry>106</entry>
      <entry>ippp0</entry>
      <entry align='center'><systemitem>etu_s1 / Sp0k3.1</systemitem></entry>
      </row>
      <row>
      <entry>-</entry>
      <entry>-</entry>
      <entry>dummy0</entry>
      <entry><systemitem class='ipaddress'>10.106.0.1/29</systemitem></entry>
      </row>
      <row>
      <entry morerows='1' valign='middle'>alderaan</entry>
      <entry morerows='1' valign='middle'>Spoke 2</entry>
      <entry align='right'>S0.2</entry>
      <entry>107</entry>
      <entry>ippp0</entry>
      <entry align='center'><systemitem>etu_s2 / Sp0k3.2</systemitem></entry>
      </row>
      <row>
      <entry>-</entry>
      <entry>-</entry>
      <entry>dummy0</entry>
      <entry><systemitem class='ipaddress'>10.107.0.1/29</systemitem></entry>
      </row>
      <row>
      <entry morerows='5' valign='middle'>2</entry>
      <entry morerows='1' valign='middle'>endor</entry>
      <entry morerows='1' valign='middle'>Hub</entry>
      <entry align='right'>S0.3</entry>
      <entry>108</entry>
      <entry>ippp0</entry>
      <entry><systemitem class='ipaddress'>192.168.107.1:192.168.107.2</systemitem></entry>
      </row>
      <row>
      <entry align='right'>S0.3</entry>
      <entry>109</entry>
      <entry>ippp1</entry>
      <entry><systemitem class='ipaddress'>192.168.108.1:192.168.108.2</systemitem></entry>
      </row>
      <row>
      <entry morerows='1' valign='middle'>dagobah</entry>
      <entry morerows='1' valign='middle'>Spoke 1</entry>
      <entry align='right'>S0.4</entry>
      <entry>110</entry>
      <entry>ippp0</entry>
      <entry align='center'><systemitem>etu_s1 / Sp0k3.1</systemitem></entry>
      </row>
      <row>
      <entry>-</entry>
      <entry>-</entry>
      <entry>dummy0</entry>
      <entry><systemitem class='ipaddress'>10.109.0.1/29</systemitem></entry>
      </row>
      <row>
      <entry morerows='1' valign='middle'>coruscant</entry>
      <entry morerows='1' valign='middle'>Spoke 2</entry>
      <entry align='right'>S0.4</entry>
      <entry>111</entry>
      <entry>ippp0</entry>
      <entry align='center'><systemitem>etu_s2 / Sp0k3.2</systemitem></entry>
      </row>
      <row>
      <entry>-</entry>
      <entry>-</entry>
      <entry>dummy0</entry>
      <entry><systemitem class='ipaddress'>10.110.0.1/29</systemitem></entry>
      </row>
      <row>
      <entry morerows='5' valign='middle'>3</entry>
      <entry morerows='1' valign='middle'>hoth</entry>
      <entry morerows='1' valign='middle'>Hub</entry>
      <entry align='right'>S0.5</entry>
      <entry>112</entry>
      <entry>ippp0</entry>
      <entry><systemitem class='ipaddress'>192.168.111.1:192.168.111.2</systemitem></entry>
      </row>
      <row>
      <entry align='right'>S0.5</entry>
      <entry>113</entry>
      <entry>ippp1</entry>
      <entry><systemitem class='ipaddress'>192.168.112.1:192.168.112.2</systemitem></entry>
      </row>
      <row>
      <entry morerows='1' valign='middle'>geonosis</entry>
      <entry morerows='1' valign='middle'>Spoke 1</entry>
      <entry align='right'>S0.6</entry>
      <entry>114</entry>
      <entry>ippp0</entry>
      <entry align='center'><systemitem>etu_s1 / Sp0k3.1</systemitem></entry>
      </row>
      <row>
      <entry>-</entry>
      <entry>-</entry>
      <entry>dummy0</entry>
      <entry><systemitem class='ipaddress'>10.113.0.1/29</systemitem></entry>
      </row>
      <row>
      <entry morerows='1' valign='middle'>felucia</entry>
      <entry morerows='1' valign='middle'>Spoke 2</entry>
      <entry align='right'>S0.6</entry>
      <entry>115</entry>
      <entry>ippp0</entry>
      <entry align='center'><systemitem>etu_s2 / Sp0k3.2</systemitem></entry>
      </row>
      <row>
      <entry>-</entry>
      <entry>-</entry>
      <entry>dummy0</entry>
      <entry><systemitem class='ipaddress'>10.114.0.1/29</systemitem></entry>
      </row>
      <row>
      <entry morerows='5' valign='middle'>4</entry>
      <entry morerows='1' valign='middle'>naboo</entry>
      <entry morerows='1' valign='middle'>Hub</entry>
      <entry align='right'>S0.7</entry>
      <entry>116</entry>
      <entry>ippp0</entry>
      <entry><systemitem class='ipaddress'>192.168.115.1:192.168.115.2</systemitem></entry>
      </row>
      <row>
      <entry align='right'>S0.7</entry>
      <entry>117</entry>
      <entry>ippp1</entry>
      <entry><systemitem class='ipaddress'>192.168.116.1:192.168.116.2</systemitem></entry>
      </row>
      <row>
      <entry morerows='1' valign='middle'>mustafar</entry>
      <entry morerows='1' valign='middle'>Spoke 1</entry>
      <entry align='right'>S0.8</entry>
      <entry>118</entry>
      <entry>ippp0</entry>
      <entry align='center'><systemitem>etu_s1 / Sp0k3.1</systemitem></entry>
      </row>
      <row>
      <entry>-</entry>
      <entry>-</entry>
      <entry>dummy0</entry>
      <entry><systemitem class='ipaddress'>10.117.0.1/29</systemitem></entry>
      </row>
      <row>
      <entry morerows='1' valign='middle'>tatooine</entry>
      <entry morerows='1' valign='middle'>Spoke 2</entry>
      <entry align='right'>S0.8</entry>
      <entry>119</entry>
      <entry>ippp0</entry>
      <entry align='center'><systemitem>etu_s2 / Sp0k3.2</systemitem></entry>
      </row>
      <row>
      <entry>-</entry>
      <entry>-</entry>
      <entry>dummy0</entry>
      <entry><systemitem class='ipaddress'>10.118.0.1/29</systemitem></entry>
      </row>
    </tbody>
    </tgroup>
  </table>

  <para>Comme dans le tableau d'adressage précédent, les adresses données
  ci-dessus étant utilisées par des liens point à point, le masque réseau
  occupe les 32 bits de l'espace d'adressage.</para>

  <warning>
  <para>Les connexions <acronym>RNIS</acronym> des routeurs
  (<wordasword>Hubs</wordasword> doivent se faire directement sur les ports de
  l'autocommutateur <acronym>RNIS</acronym>. En effet, ces connexions utilisent
  les deux canaux B du port <acronym>BRI</acronym>.</para>
  </warning>
  </sect2>
</sect1>


<sect1 xml:id='interco.pppoe.qa.hub'>
  <title>Configuration d'un routeur Hub</title>

  <para>Compte tenu de la topologie définie dans la section précédente, on doit
  configurer les interfaces <acronym>LAN</acronym> et <acronym>WAN</acronym> du
  <wordasword>Hub</wordasword>. Ce routeur doit fournir l'accès Internet via
  son interface <acronym>LAN</acronym> et attribuer les adresses
  <acronym>IP</acronym> aux <wordasword>Spokes</wordasword> via ses interfaces
  <acronym>WAN</acronym>.</para>

  <sect2 xml:id='interco.pppoe.qa.hub.lan'>
    <title>Connexion au réseau local</title>

  <para>Le routeur <wordasword>Hub</wordasword> accède à l'Internet via son
  interface <acronym>LAN</acronym>. Cet accès doit être permanent et
  indépendant de l'état des interfaces <wordasword>WAN</wordasword>.</para>

  <qandaset defaultlabel='number'>
    <qandaentry>
      <question>
      <para><phrase>Comment activer le routage au niveau dans le noyau du
      routeur ?</phrase></para>
      
      <para>Consulter les documentations &url.config.interface.lan; et
      &url.nat-howto;.</para>
      </question>
      <answer>
      <para>Les paramètres de réglage des fonctions réseau du noyau Linux sont
      situés dans l'arborescence <filename class='directory'>/proc</filename>.
      Le paramètre qui nous intéresse est <option>ip_forward.</option>. Par
      défaut, sa valeur est à <option>0</option> et le routage est désactivé
      dans le noyau. On doit donc passer cette valeur à <option>1</option> pour
      activer le routage.</para>
 
<screen><prompt>#</prompt> echo 1 > /proc/sys/net/ipv4/ip_forward</screen>

      <para>Pour rendre ce réglage permanent, il est possible d'éditer le
      fichier <filename>/etc/sysctl.conf</filename>. De cette façon, le routage
      sera activé à chaque redémarrage du système. Dans le cadre des travaux
      pratiques, ce n'est pas nécessaire.</para>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Quelles sont les opérations nécessaires à la configuration
      de la traduction des adresses sources des paquets sortant par
      l'interface LAN ?</phrase></para>
      
      <para>Consulter la documentation &url.nat-howto;.</para>
      </question>
      <answer>
      <para>On utilise ici la méthode de traduction d'adresses sources la plus
      simple. Elle est connue sous le nom de
      <wordasword>masquerading</wordasword>.</para>
 
<screen><prompt>#</prompt> iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</screen>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Quels sont les tests à réaliser pour s'assurer du
      fonctionnement de l'accès Internet ?</phrase></para>

      <para>Consulter la documentation &url.config.interface.lan;.</para>
      </question>
      <answer>
      <para>Les tests peuvent se décomposer en deux parties : l'utilisation du
      protocole <acronym>ICMP</acronym> et l'analyse réseau.</para>

      <para>Avec <acronym>ICMP</acronym>, il faut reprendre la séquence
      «rituelle» des requêtes <wordasword>echo</wordasword> en allant de la
      destination la plus proche à la plus éloignée. On débute avec l'interface
      de boucle locale (<wordasword>loopback</wordasword>), puis l'interface
      locale, puis la passerelle par défaut et enfin une adresse
      <acronym>IP</acronym> située sur un autre réseau. Ce n'est qu'en dernier
      lieu que l'on doit effectuer un test avec le service de noms de domaines
      à l'aide des commandes <command>host</command> ou
      <command>dig</command>. Enfin, si le protocole <acronym>ICMP</acronym>
      n'est pas disponible au delà du réseau local, on peut utiliser un outil
      du type <command>tcptraceroute</command> pour tester la connectivité
      inter réseau.</para>

      <para>Pour la partie analyse réseau, <application>tshark</application>
      permet d'analyser à la console le trafic passant par chacune des
      interfaces d'un routeur. Il permet notamment de caractériser le
      fonctionnement de la traduction d'adresses entre les interfaces
      <acronym>LAN</acronym> et <acronym>WAN</acronym>.</para>
      </answer>
    </qandaentry>
  </qandaset>
  </sect2>

  <sect2 xml:id='interco.pppoe.qa.hub.wan'>
    <title>Connexion au réseau étendu</title>

  <para>Chaque routeur <wordasword>Hub</wordasword> utilise les deux canaux B
  d'un bus S0. On doit donc configurer deux interfaces <literal>ipppX</literal>
  pour établir les connexions point à point avec les deux
  <wordasword>Spokes</wordasword>.</para>

  <qandaset defaultlabel='number'>
    <qandaentry>
      <question>
      <para><phrase>Donner la liste des options de la commande
      <command>isdnctrl</command> pour la configuration des deux interfaces du
      <wordasword>Hub</wordasword> ?</phrase></para>

      <para>Reprendre les instructions vues dans le support &url.interco.rawip;
      et la <xref linkend='interco.pppoe.qa.ppp-protocol' />.</para>
      </question>
      <answer>
      <para>Comme dans les questions précédentes du même type, on doit
      effectuer les opérations suivantes pour chacune des deux interfaces
      <systemitem>/dev/ippp0</systemitem> et
      <systemitem>/dev/ippp1</systemitem>.</para>

      <orderedlist>
        <listitem>
	<para>Créer l'interface.</para>
	</listitem>
	<listitem>
	<para>Attribuer le numéro de téléphone entrant.</para>
	</listitem>
	<listitem>
	<para>Attribuer l'identifiant <acronym>MSN/EAZ</acronym>
	(<wordasword>Multiple Subscriber Number</wordasword>) à partir du
	numéro de téléphone entrant.</para>
	</listitem>
	<listitem>
	<para>Attribuer le numéro de téléphone du correspondant.</para>
	</listitem>
	<listitem>
	<para>Choisir le protocole HDLC pour la couche liaison.</para>
	</listitem>
	<listitem>
	<para>Choisir l'encapsulation <systemitem>syncppp</systemitem>.</para>
	</listitem>
	<listitem>
	<para>Fixer le mode de connexion automatique.</para>
	</listitem>
      </orderedlist>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Quelles sont les opérations supplémentaires nécessaires à
      la configuration des interfaces <acronym>RNIS</acronym> du routeur
      <wordasword>Hub</wordasword> ?</phrase></para>

      <para>Consulter les pages de manuels de la commande
      <command>isdnctrl</command> en effectuant une recherche avec la
      clé : <literal>pppbind</literal>.</para>
      </question>
      <answer>
      <para>De façon à éviter les «croisements» entre les affectations
      d'adresses <acronym>IP</acronym> des deux
      <wordasword>Spokes</wordasword>, il est nécessaire de lier les interfaces
      réseau avec le plan de numérotation téléphonique. Par exemple, sur le
      <wordasword>Hub</wordasword> <citetitle>Centares</citetitle>, on peut
      exécuter les commandes suivantes.</para>

<screen><prompt>#</prompt> isdnctrl pppbind ippp0 0
<prompt>#</prompt> isdnctrl pppbind ippp1 1</screen>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Quelle est l'option de la commande
      <command>isdnctrl</command> qui permet de sauvegarder/restituer la
      configuration de l'interface <acronym>RNIS</acronym> ?</phrase></para>

      <para>Utiliser les pages de manuel de l'outil
      <command>isdnctrl</command>. Sauvegarder le fichier de configuration de
      l'interface pour les utilisations ultérieures.</para>
      </question>
      <answer>
      <para>Ce sont les options <option>readconf</option> et
      <option>writeconf</option> de la commande <command>isdnctrl</command>
      quit permettent respectivement de lire et d'écrire dans un fichier de
      configuration l'ensemble des paramètres d'une ou plusieurs interfaces
      <acronym>RNIS</acronym>.</para>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Quelles sont les opérations à effectuer pour mettre en
      œuvre le protocole <acronym>PPP</acronym> avec une authentification
      <acronym>CHAP</acronym> ?</phrase></para>

      <para>Reprendre les questions de la <xref
      linkend='interco.pppoe.qa.ppp-protocol' /> pour chacune des deux
      interfaces. Les couples d'authentification
      <wordasword>login/password</wordasword> sont donnés dans le <xref
      linkend='interco.pppoe.qa.hub-and-spoke.addressing'/>.</para>
      </question>
    </qandaentry>
  </qandaset>
  </sect2>

  <sect2 xml:id='interco.pppoe.qa.hub.static'>
    <title>Routage statique</title>

  <para>Pour que les réseaux desservis par les routeurs
  <wordasword>Spokes</wordasword> soient accessibles depuis toutes les
  extrémités en communication, le routeur <wordasword>Hub</wordasword> doit
  disposer d'une table de routage complète. Comme le nombre des réseaux de
  chaque <wordasword>Spoke</wordasword> est limité, on utilise des entrées
  statiques dans la table de routage du <wordasword>Hub</wordasword>.</para>

  <qandaset defaultlabel='number'>
    <qandaentry>
      <question>
      <para><phrase>Comment ajouter une entrée statique dans la table de
      routage du <wordasword>Hub</wordasword> ?</phrase></para>

      <para>Rechercher les options de la commande <command>ip</command> dans le
      &url.debian-reference.networking;.</para>
      </question>
      <answer>
      <para>C'est l'instruction <userinput><prompt>#</prompt> ip route add
      ...</userinput> qui permet l'ajout de routes statiques. Par exemple, dans
      le cas du routeur <wordasword>Hub</wordasword>
      <systemitem>centares</systemitem>, les deux instructions suivantes
      permettent d'ajouter les deux routes correspondant aux deux réseaux des
      routeurs <wordasword>Spokes</wordasword>
      <systemitem>alderaan</systemitem> et
      <systemitem>bespin</systemitem>.</para>

<screen><prompt>#</prompt> ip route add 10.106.0.0/29 dev ippp0
<prompt>#</prompt> ip route add 10.107.0.0/29 dev ippp1</screen>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Comment tester la disponibilité des différents réseaux
      interconnectés ?</phrase></para>

      <para>Reprendre les séquences de tests <acronym>ICMP</acronym> entre les
      différents hôtes.</para>
      </question>
    </qandaentry>
  </qandaset>
  </sect2>
</sect1>

<sect1 xml:id='interco.pppoe.qa.spoke'>
  <title>Configuration d'un routeur Spoke</title>

  <para>Dans ce scénario, le routeur accède à Internet par son interface
  <acronym>WAN</acronym> et redistribue cet accès sur un réseau local. Ce genre
  de routeur est appelé «routeur d'agence».</para>

  <sect2 xml:id='interco.pppoe.qa.spoke.lan'>
    <title>Connexion au réseau local</title>

  <para>Compte tenu de la topologie définie dans la <xref
  linkend='interco.pppoe.qa.hub-and-spoke'/>, l'interface <acronym>LAN</acronym>
  du routeur <wordasword>Spoke</wordasword> n'est pas utilisée. Il faut donc
  désactiver cette interface.</para>

  <qandaset defaultlabel='number'>
    <qandaentry>
      <question>
      <para><phrase>Comment supprimer la configuration d'une interface réseau
      au niveau système ?</phrase></para>

      <para>Rechercher les outils systèmes proposés dans le
      &url.debian-reference.networking;.</para>
      </question>
      <answer>
      <para>Le paquet <systemitem>ifupdown</systemitem> propose deux scripts
      baptisés <command>ifup</command> et <command>ifdown</command> qui
      assurent un contrôle d'état sur la configuration des interfaces listées
      dans le fichier de configuration système
      <filename>/etc/network/interfaces</filename>.</para>

      <para>Dans le cas de l'interface <acronym>LAN</acronym> du poste de
      travaux pratiques, <systemitem>eth0</systemitem> est configurée via le
      protocole <acronym>DHCP</acronym>. Pour résilier le bail
      <acronym>DHCP</acronym> et désactiver l'interface, on utilise
      l'instruction suivante.</para>

<screen><prompt>#</prompt> ifdown eth0</screen>
      </answer>
    </qandaentry>
  </qandaset>
  </sect2>
  
  <sect2 xml:id='interco.pppoe.qa.spoke.wan'>
    <title>Connexion au réseau étendu</title>

  <para>Chaque routeur <wordasword>Spoke</wordasword> utilise un canal B
  d'un bus S0. On doit donc configurer une interface <literal>ippp0</literal>
  pour établir la connexion point à point avec le
  <wordasword>Hub</wordasword>.</para>

  <qandaset defaultlabel='number'>
    <qandaentry>
      <question>
      <para><phrase>Donner la liste des options de la commande
      <command>isdnctrl</command> pour la configuration de l'interface du
      <wordasword>Spoke</wordasword> ?</phrase></para>

      <para>Reprendre les instructions vues dans le support &url.interco.rawip;
      et la <xref linkend='interco.pppoe.qa.ppp-protocol' />.</para>
      </question>
      <answer>
      <para>Comme dans les questions précédentes du même type, on doit
      effectuer les opérations suivantes pour l'interface
      <systemitem>/dev/ippp0</systemitem>.</para>

      <orderedlist>
        <listitem>
	<para>Créer l'interface.</para>
	</listitem>
	<listitem>
	<para>Attribuer le numéro de téléphone entrant.</para>
	</listitem>
	<listitem>
	<para>Attribuer l'identifiant <acronym>MSN/EAZ</acronym>
	(<wordasword>Multiple Subscriber Number</wordasword>) à partir du
	numéro de téléphone entrant.</para>
	</listitem>
	<listitem>
	<para>Attribuer le numéro de téléphone du correspondant.</para>
	</listitem>
	<listitem>
	<para>Choisir le protocole HDLC pour la couche liaison.</para>
	</listitem>
	<listitem>
	<para>Choisir l'encapsulation <systemitem>syncppp</systemitem>.</para>
	</listitem>
	<listitem>
	<para>Fixer le mode de connexion automatique.</para>
	</listitem>
      </orderedlist>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Quelle est l'option de la commande
      <command>isdnctrl</command> qui permet de sauvegarder/restituer la
      configuration de l'interface <acronym>RNIS</acronym> ?</phrase></para>

      <para>Utiliser les pages de manuel de l'outil
      <command>isdnctrl</command>. Sauvegarder le fichier de configuration de
      l'interface pour les utilisations ultérieures.</para>
      </question>
      <answer>
      <para>Ce sont les options <option>readconf</option> et
      <option>writeconf</option> de la commande <command>isdnctrl</command>
      quit permettent respectivement de lire et d'écrire dans un fichier de
      configuration l'ensemble des paramètres d'une ou plusieurs interfaces
      <acronym>RNIS</acronym>.</para>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Quelles sont les opérations à effectuer pour mettre en
      œuvre le protocole <acronym>PPP</acronym> avec une authentification
      <acronym>CHAP</acronym> ?</phrase></para>

      <para>Reprendre les questions de la <xref
      linkend='interco.pppoe.qa.ppp-protocol' />. Les couples d'authentification
      <wordasword>login/password</wordasword> sont donnés dans le <xref
      linkend='interco.pppoe.qa.hub-and-spoke.addressing'/>.</para>
      </question>
    </qandaentry>
  </qandaset>
  </sect2>

  <sect2 xml:id='interco.pppoe.qa.spoke.dummy'>
    <title>Ajout d'un réseau fictif</title>

  <para>L'ajout de nouvelles entrées fictives dans les tables de routage est
  une pratique très répandue. Elle permet de qualifier le bon fonctionnement
  d'un service ou d'un filtrage sans ajouter de matériel. Dans le cas de ces
  travaux pratiques, c'est le service Web qui est utilisé pour valider la
  disponibilité d'un réseau au niveau application.</para>

  <qandaset>
    <qandaentry>
      <question>
      <para><phrase>Quelles sont les opérations à effectuer pour pouvoir
      utiliser des interfaces réseau virtuelles de type boucle locale sur un
      système GNU/Linux ?</phrase></para>

      <para>Avec le noyau Linux, il est conseillé d'utiliser des interfaces
      baptisées <wordasword>dummy</wordasword> pour ce genre d'usage.
      Rechercher le module correspondant à charger en mémoire.</para>
      </question>
      <answer>
      <para>On charge le module <systemitem>dummy</systemitem> suivi de
      l'option <option>numdummies</option> pour créer les interfaces. Il suffit
      ensuite d'appliquer une nouvelle configuration <acronym>IP</acronym> pour
      ajouter un ou plusieurs nouveaux réseaux.</para>

<screen><prompt>#</prompt> modprobe -v dummy numdummies=2
insmod /lib/modules/3.16-2-amd64/kernel/drivers/net/dummy.ko numdummies=2
<prompt>#</prompt> ip addr ls | grep dummy
3: dummy0: &lt;BROADCAST,NOARP> mtu 1500 qdisc noop state DOWN group default 
4: dummy1: &lt;BROADCAST,NOARP> mtu 1500 qdisc noop state DOWN group default</screen>

      <para>En prenant l'exemple du <wordasword>Spoke</wordasword>
      <systemitem>bespin</systemitem>, on ajoute le réseau <systemitem
      class='ipaddress'>10.106.0.0/29</systemitem> en configurant l'interface
      <systemitem>dummy0</systemitem>.</para>

<screen><prompt>#</prompt> ip link set dev dummy0 up
<prompt>#</prompt> ip addr add 10.106.0.1/29 brd + dev dummy0
<prompt>#</prompt> ip route ls
default via 192.0.2.1 dev eth0 
<emphasis>10.106.0.0/29 dev dummy0  proto kernel  scope link  src 10.106.0.1</emphasis> 
192.0.2.0/26 dev eth0  proto kernel  scope link  src 192.0.2.10</screen>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Quelles sont les opérations à effectuer pour installer un
      service Web en écoute exclusivement sur l'adresse <acronym>IP</acronym>
      de l'interface <option>dummy0</option> ?</phrase></para>

      <para>Installer le paquet <systemitem>apache2</systemitem> et modifier sa
      configuration pour que le service ne soit accessible que sur une adresse
      <acronym>IP</acronym>.</para>
      </question>
      <answer>
<screen><prompt>#</prompt> aptitude install apache2
&lt;snipped/>
Paramétrage de apache2-mpm-worker (2.2.21-2) ...
Starting web server: apache2apache2: Could not reliably determine the server's
fully qualified domain name, using 127.0.1.1 for ServerName
.
Paramétrage de apache2 (2.2.21-2) ...
&lt;snipped/></screen>

      <para>On modifie ensuite le fichier de configuration
      <filename>/etc/apache2/ports.conf</filename> de façon à limiter l'accès à
      l'adresse <acronym>IP</acronym> voulue.</para>

<screen><prompt>#</prompt> cd /etc/apache2/
<prompt>#</prompt> diff -uBb ports.conf.orig ports.conf
--- ports.conf.orig     2011-10-31 20:37:09.000000000 +0100
+++ ports.conf  2011-10-31 20:37:39.000000000 +0100
@@ -6,7 +6,7 @@
 # README.Debian.gz

 NameVirtualHost *:80
-Listen 80
+Listen 10.106.0.1:80

 &lt;IfModule mod_ssl.c>
     # If you add NameVirtualHost *:443 here, you will also have to change</screen>

      <para>On redémarre le service et on affiche le liste des
      <wordasword>sockets inet</wordasword> ouverts sur le système pour
      confirmer que l'adresse <acronym>IP</acronym> choisie est bien
      affectée.</para>

<screen><prompt>#</prompt> /etc/init.d/apache2 restart
&lt;snipped/>
<prompt>#</prompt> lsof -i | grep apache2
apache2  22206        root    3u  IPv4  30721      0t0  TCP 10.106.0.1:www (LISTEN)
apache2  22211    www-data    3u  IPv4  30721      0t0  TCP 10.106.0.1:www (LISTEN)
apache2  22212    www-data    3u  IPv4  30721      0t0  TCP 10.106.0.1:www (LISTEN)</screen>
      </answer>
    </qandaentry>

    <qandaentry>
      <question>
      <para><phrase>Comment valider l'accès à ce service Web depuis les autres
      routeurs ?</phrase></para>

      <para>Si la table de routage du routeur <wordasword>Hub</wordasword> est
      complète, on décrit les couches de la modélisation en partant de la
      couche réseau vers la couche application. Les tests
      <acronym>ICMP</acronym> valident le niveau réseau. Les tests
      <command>traceroute</command> valident le fonctionnement des protocoles
      de la couche transport. Enfin, le navigateur web permet de tester la
      couche application.</para>
      </question>
      <answer>
      <para>Voici trois exemples de tests.</para>

      <itemizedlist>
      <listitem>
      <para>Test <acronym>ICMP</acronym>.</para>

<screen><prompt>$</prompt> ping -c 2 10.106.0.1
PING 10.106.0.1 (10.106.0.1) 56(84) bytes of data.
64 bytes from 10.106.0.1: icmp_req=1 ttl=64 time=0.435 ms
64 bytes from 10.106.0.1: icmp_req=2 ttl=64 time=0.360 ms

--- 10.106.0.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1000ms
rtt min/avg/max/mdev = 0.360/0.397/0.435/0.042 ms</screen>
      </listitem>
      <listitem>
      <para>Test <command>traceroute</command>.</para>

<screen><prompt>$</prompt> traceroute 10.106.0.1
traceroute to 10.106.0.1 (10.106.0.1), 30 hops max, 60 byte packets
 1  10.106.0.1 (10.106.0.1)  0.467 ms  0.256 ms  0.262 ms</screen>
      </listitem>
      <listitem>
      <para>Test <acronym>HTTP</acronym>.</para>

  <mediaobject>
  <imageobject>
    <imagedata fileref='images/lynx-spoke.png' format='PNG' width='7cm' scalefit='1'/>
  </imageobject>
  <textobject>
    <phrase>Copie d'écran navigateur Web</phrase>
  </textobject>
  <caption>
    <para><link xlink:href='images/lynx-spoke.png'>Copie d'écran navigateur Web</link></para>
  </caption>
  </mediaobject>
      </listitem>
      </itemizedlist>
      </answer>
    </qandaentry>
  </qandaset>
  </sect2>
</sect1>

<sect1 xml:id='interco.pppoe.qa.refdocs'>
  <title>Documents de référence</title>

  <variablelist>
    <varlistentry xml:id='interco.pppoe.qa.rfc1661'>
      <term><citetitle>The Point-to-Point Protocol (PPP)</citetitle></term>
      <listitem>
      <para>&url.rfc1661; : Le protocole point-à-point
      <acronym>PPP</acronym> fournit une méthode standard de transport de
      datagrammes multi-protocoles sur des liaisons point à point.
      <acronym>PPP</acronym> comprend 3 composants principaux :</para>
      <orderedlist>
        <listitem>
	<para>Une méthode d'encapsulation des datagrammes
	multi-protocoles.</para>
	</listitem>
	<listitem>
	<para>Un protocole de contrôle de niveau liaison ou <wordasword>Link
	Control Protocol</wordasword> (<acronym>LCP</acronym>) pour établir,
	configurer et tester une connexion de données à ce niveau.</para>
	</listitem>
	<listitem>
	<para>Une famille de protocoles de contrôle de niveau réseau pour
	établir et configurer différents protocoles de niveau réseau.</para>
	</listitem>
      </orderedlist>
      <para>Dans la plupart des cas, on retrouve des trames
      <acronym>HDLC</acronym> au niveau liaison et <acronym>IP</acronym> est le
      seul protocole réseau utilisé.</para>
      </listitem>
    </varlistentry>

    <varlistentry xml:id='interco.pppoe.qa.rawip'>
      <term><citetitle>Configuration d'une interface RNIS en mode
      rawip</citetitle></term>
      <listitem>
      <para>&url.interco.rawip; : support de travaux pratiques utilisant la
      connexion directe sur le réseau téléphonique.</para>
      </listitem>
    </varlistentry>

    <varlistentry xml:id='interco.pppoe.qa.config.interface.lan'>
      <term><citetitle>Configuration d'une interface de réseau local</citetitle></term>
      <listitem>
      <para>&url.config.interface.lan; : identification du type d'interface,
      de ses caractéristiques et manipulations des paramètres. Ce support
      fournit une méthodologie de dépannage simple d'une connexion
      réseau.</para>
      </listitem>
    </varlistentry>
    
    <varlistentry xml:id='interco.pppoe.qa.debian-reference.networking'>
      <term><citetitle>Debian Reference Chapter 10 - Network
      configuration</citetitle></term>
      <listitem>
	<para>&url.debian-reference.networking; : chapitre du manuel de
	référence <citetitle>Debian</citetitle> consacré à la configuration
	réseau.</para>
      </listitem>
    </varlistentry>

    <varlistentry xml:id='interco.pppoe.qa.fonctions.noyau'>
      <term><citetitle>Fonctions réseau du noyau Linux</citetitle></term>
      <listitem>
      <para>&url.interco.kernel; : présentation et configuration des
      fonctions réseau du noyau LINUX</para>
      </listitem>
    </varlistentry>

    <varlistentry xml:id='interco.pppoe.qa.nat-howto'>
      <term><citetitle>Guide Pratique du NAT sous Linux 2.4</citetitle></term>
      <listitem>
      <para>&url.nat-howto; : Ce document décrit comment réaliser du
      camouflage d'adresse <acronym>IP</acronym>, un serveur mandataire
      transparent, de la redirection de ports ou d'autres formes de traduction
      d'adresse réseau (<wordasword>Network Address Translation</wordasword> ou
      <acronym>NAT</acronym>) avec le noyau Linux 2.4.</para>
      </listitem>
    </varlistentry>

    <varlistentry xml:id='interco.pppoe.qa.ppp-howto'>
      <term><citetitle>Linux PPP HOWTO</citetitle></term>
      <listitem>
      <para>&url.ppp-howto; : Ce guide est relativement ancien. On y
      trouve cependant des exemples utiles sur le paramétrage de
      l'authentification avec la protocole <acronym>PPP</acronym>.</para>
      </listitem>
    </varlistentry>
  </variablelist>
</sect1>
</article>
